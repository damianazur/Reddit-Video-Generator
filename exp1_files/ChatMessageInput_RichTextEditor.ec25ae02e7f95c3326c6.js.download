(window.webpackJsonp=window.webpackJsonp||[]).push([["ChatMessageInput~RichTextEditor"],{"./src/lib/forEachGroup/index.ts":function(t,e,n){"use strict";n.d(e,"a",function(){return i});var o=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],o=!0,r=!1,i=void 0;try{for(var s,c=t[Symbol.iterator]();!(o=(s=c.next()).done)&&(n.push(s.value),!e||n.length!==e);o=!0);}catch(a){r=!0,i=a}finally{try{!o&&c.return&&c.return()}finally{if(r)throw i}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();const r=t=>t;function i(t,e,n){var i=Array.isArray(t)?[t.length,e=>t[e]]:[t.size,e=>t.get(e)],s=o(i,2);const c=s[0],a=s[1];var l=(e||{}).keyFn;const d=void 0===l?r:l;var u=e||{},p=u.start;let h=void 0===p?0:p;var g=u.end;let m=void 0===g?c:g;if((h=h<0?0:h)>=(m=m>c?c:m))return;let f=a(h),b=d(f,h),y=h;for(let o=h+1;o<m;o++){const t=a(o),e=d(t,o);if(e!==b){if(!1===n(f,b,y,o))return;b=e,y=o,f=t}}n(f,b,y,m)}},"./src/reddit/actions/postCreation/mediaUpload.ts":function(t,e,n){"use strict";var o=n("./node_modules/uuid/v4.js"),r=n.n(o),i=n("./src/app/strings/index.ts"),s=n("./src/lib/constants/index.ts"),c=n("./src/lib/formatApiError/index.ts"),a=n("./src/lib/makeActionCreator/index.ts"),l=n("./src/reddit/actions/toaster.ts"),d=n("./src/reddit/actions/upload.ts"),u=n("./src/lib/makeApiRequest/index.ts"),p=n("./src/lib/omitHeaders/index.ts"),h=n("./src/reddit/constants/headers.ts");var g=n("./src/reddit/helpers/correlationIdTracker.ts"),m=n("./src/reddit/helpers/imagePreview/index.ts"),f=n("./src/reddit/helpers/media/index.ts"),b=n("./src/reddit/models/Upload/index.ts"),y=n("./src/reddit/selectors/telemetry.ts"),E=n("./src/telemetry/index.ts");const O=async({state:t,uploadKey:e,assetId:n,isCanceled:o,fileSource:r,uploadDuration:i,correlationId:s})=>{const c=t.uploads[e],a=o||c.status===b.a.CANCELED,l=c.file,d=c.url,u=c.metadata,p=c.error,h=u.mimetype||l.type,g=h.startsWith("video/"),m=c.status===b.a.SUCCESS;let f="";p?f=JSON.stringify(p):a&&(f="canceled");const O={width:u.width,height:u.height,duration:u.videoDuration&&Math.round(1e3*u.videoDuration)};Object(E.a)(Object.assign({source:g?"videoupload":"imageupload",action:"upload",correlationId:s,noun:g?"video":"image"},(t=>Object.assign({},y.defaults(t),{screen:y.screen(t),profile:y.profile(t),subreddit:y.subreddit(t)}))(t),{actionInfo:Object.assign({},y.actionInfo(t),{success:m},f?{reason:f}:{}),media:Object.assign({mimetype:h,uploadDuration:i,source:r,fileName:l.name,size:l.size,type:g?"video":"image"},n?{id:n}:{},d?{url:d}:{},O)}))};var x=n("./src/reddit/helpers/trackers/postComposer.ts"),S=n("./src/reddit/models/Toast/index.ts"),C=n("./src/reddit/selectors/postCreations.ts"),v=n("./src/reddit/selectors/user.ts"),k=n("./src/reddit/actions/postCreation/constants.ts");n.d(e,"d",function(){return I}),n.d(e,"c",function(){return A}),n.d(e,"a",function(){return B}),n.d(e,"b",function(){return K});const j=Object(a.a)(k.v),w=Object(a.a)(k.w),T=Object(a.a)(k.u),I=t=>async(e,n)=>{e(j());const o=t.map(({url:t,uploadKey:n})=>{const o=Object(f.a)(Object(f.c)(t),"poster.png");return e(A(o,n))});await Promise.all(o);const r=n().uploads,i=t.map(({uploadKey:t})=>r[t]).find(t=>t.status!==b.a.SUCCESS);e(i?T(i.error):w())},R=(t,e)=>({error:e?{type:t,fields:[{field:"",msg:e}]}:{type:t}});const A=(t,e,n,o)=>async(r,c,{apiContext:a})=>{const l=Object(C.f)(c()),y=Date.now();let E=null,S=!1,k=!1,j=!1;const w=t=>{if(!j&&n&&S){j=!0;const o=c(),r=Date.now()-y,i=Object(g.c)(g.a.PostComposer);k?O({state:o,uploadKey:e,assetId:E,isCanceled:t,fileSource:n,uploadDuration:r,correlationId:i}):x.p(o,e)}};e.startsWith(b.b.RTE_MEDIA);await r(Object(d.k)(t,e,async g=>{S=!0,Object(d.j)(g.id,()=>{w(!0)});var b=await async function(t,e,n,o){const r=Object(v.Q)(t),c=n&&n.allowedPostTypes,a=n&&n.name,l=await Object(f.g)(e)||e.type,d=Object(f.b)(e)||void 0;if(!d)return R("UNSUPPORTED_BROWSER");const u={localUrl:d,mimetype:l};if(!l||!Object(f.i)(l))return{error:{type:s.N}};if(l.startsWith("image/")){if(c&&!c.images){const t=Object(i.a)(r,"postCreation.mediaInput.imagesAreNotAllowed",{subredditName:a});return R(s.N,t)}if("image/gif"===l){if(e.size>s.S)return R(s.I)}else if(e.size>s.U)return R(s.L);const t=await Object(m.a)(d);u.width=t.width,u.height=t.height}else if(l.startsWith("video/")){if(e.size>s.Y)return R(s.Ub);let t;try{t=await Object(f.h)(d,!0)}catch(p){return R(s.N)}if(c){const e=c.videos,n=c.images;if(n&&!e&&t.duration>s.Z){const t=Object(i.a)(r,"postCreation.mediaInput.videoTooLongForImageOnlySubreddit",{subredditName:a});return R(s.N,t)}if(!n&&!e){const t=Object(i.a)(r,"postCreation.mediaInput.videosAreNotAllowed",{subredditName:a});return R(s.N,t)}}if(t.duration>s.X){const t=Object(i.a)(r,"postCreation.mediaInput.videoTooLongInGeneral");return R(s.N,t)}u.height=t.height,u.width=t.width,u.videoDuration=t.duration,u.videoFirstFrameUrl=t.firstFrame.dataUrl}return{metadata:u}}(c(),t,l);const y=b.error,O=b.metadata;if(y||!O)return{error:y};r(Object(d.l)({key:e,metadata:Object.assign({fileSource:n},O)})),k=!0,o&&o();const x=t.name,C=await(async(t,e,n)=>Object(u.b)(Object(p.a)(t,[h.a]),{endpoint:`${t.apiUrl}/api/media/asset.json`,method:s.bb.POST,data:{filepath:e,mimetype:n}}))(a(),x,O.mimetype);return C.ok?(E=C.body.asset.asset_id,{uploadLease:C.body.args}):{error:C.error||void 0}},!0)),w(!1)},B=t=>async(e,n,{apiContext:o})=>{const r=n().uploads[t];r&&!Object(b.d)(r)&&await e(A(r.file,r.key,r.metadata.fileSource))},K=(t,e,n)=>async(o,s)=>{const a=t.map((t,i)=>new Promise(async i=>{const s=Object(b.e)(b.b.RTE_MEDIA,`${n}-${r()().slice(-6)}`);await o(A(t,s,e,()=>i(s))),i(s)})),d=await Promise.all(a);o(((t,e=3)=>async(n,o)=>{var r=o();const s=r.uploads,a=r.user.language,d=t.map(t=>s[t]).filter(t=>t.status===b.a.FAILED&&!t.metadata.mimetype).map(t=>t.error),u=d.length>e?e-1:d.length,p=d.length-u;d.slice(0,u).forEach(t=>n(Object(l.e)({duration:l.a,kind:S.b.Error,text:Object(c.a)(a,t)}))),p>0&&n(Object(l.e)({duration:l.a,kind:S.b.Error,text:Object(i.c)(a,"postCreation.cannotAddFiles",p)}))})(d))}},"./src/reddit/components/MakeGifToggle/index.tsx":function(t,e,n){"use strict";var o=n("./node_modules/react/index.js"),r=n.n(o),i=n("./bundled-modules/styled-components/styled-components.min.js"),s=n.n(i),c=n("./src/app/strings/index.ts"),a=n("./src/reddit/components/RichTextEditor/HoverTooltip/index.tsx"),l=n("./src/reddit/controls/ToggleSwitch/index.tsx"),d=n("./src/reddit/helpers/styles/mixins/fonts.tsx"),u=n("./src/reddit/layout/row/Inline/index.tsx"),p=n("./src/reddit/models/Theme/NewColorSystem/index.ts");const h=Object(c.e)("postCreation.mediaInput.makeGif.label"),g=s()(l.a).withConfig({componentId:"s1o254ng-0"})(["width: ","px;"],t=>t.toggleWidth||27),m=s.a.label.withConfig({componentId:"s1o254ng-1"})(["","color: ",";padding: 0 7px;"],d.titleFontH5,t=>Object(p.c)(t).bodyText),f=s()(a.b).withConfig({componentId:"s1o254ng-2"})(["user-select: none;"," {max-width: 400px;min-width: 250px;white-space: normal;}"],a.a);e.a=s()(t=>r.a.createElement(u.a,{className:t.className,onMouseDown:t=>t.preventDefault(),onClick:e=>{e.stopPropagation(),!t.disabled&&t.onClick()}},r.a.createElement(u.a,null,r.a.createElement(g,{toggleWidth:t.toggleWidth,on:t.on}),r.a.createElement(m,null,h(t.language))),t.tooltip?r.a.createElement(f,{text:t.tooltip}):null)).withConfig({componentId:"s1o254ng-3"})(["position: relative;padding: 4px;"," {opacity: ",";}"],u.a,t=>t.disabled?".25;":"1")},"./src/reddit/components/PostCreationForm/DivButton/index.m.less":function(t,e,n){t.exports={button:"ypAk-GyDXsczk_xkC7Eq_",disabled:"_3hBIa9WhGl-wxARDDgBvSE"}},"./src/reddit/components/PostCreationForm/DivButton/index.tsx":function(t,e,n){"use strict";var o=n("./node_modules/react/index.js"),r=n.n(o),i=n("./src/lib/classNames/index.ts"),s=n("./src/reddit/constants/keycodes.ts"),c=n("./src/reddit/components/PostCreationForm/DivButton/index.m.less"),a=n.n(c),l=function(t,e){var n={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(n[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(t);r<o.length;r++)e.indexOf(o[r])<0&&(n[o[r]]=t[o[r]])}return n};const d=(t,e,n)=>{!e&&n&&n(t)},u=(t,e,n)=>{e||(n&&n(t),t.defaultPrevented||t.which!==s.a.Enter&&t.which!==s.a.Space||t.currentTarget.click())};e.a=(t=>{var e=t.className,n=t.disabled,o=t.onClick,s=t.onKeyPress,c=t.setRef,p=t.tabIndex,h=l(t,["className","disabled","onClick","onKeyPress","setRef","tabIndex"]);return r.a.createElement("div",Object.assign({"aria-disabled":!!n,className:Object(i.a)(e,a.a.button,n?a.a.disabled:null),onClick:t=>d(t,n,o),onKeyPress:t=>u(t,n,s),role:"button",ref:c,tabIndex:p||0},h))})},"./src/reddit/components/ProgressBar/index.tsx":function(t,e,n){"use strict";n.d(e,"a",function(){return a});var o=n("./node_modules/react/index.js"),r=n.n(o),i=n("./bundled-modules/styled-components/styled-components.min.js"),s=n.n(i),c=n("./src/reddit/models/Theme/NewColorSystem/index.ts");const a=s.a.div.withConfig({componentId:"g6tkyo-0"})(["height: 100%;background: ",";transition: width .5s;border-radius: 2px;"],t=>Object(c.c)(t).lightText);e.b=s()(t=>r.a.createElement("div",{className:t.className},r.a.createElement(a,{style:{width:`${t.percent.toFixed(2)}%`}}))).withConfig({componentId:"g6tkyo-1"})(["height: 2px;border-radius: 2px;background: rgba(255, 255, 255, .2);"])},"./src/reddit/components/RichTextEditor/DragController/helpers.ts":function(t,e,n){"use strict";var o=n("./node_modules/lodash/includes.js"),r=n.n(o);var i=n("./src/reddit/helpers/dom/index.ts"),s=n("./src/reddit/components/RichTextEditor/styleAndBlockTypes.ts");n.d(e,"b",function(){return h}),n.d(e,"c",function(){return g}),n.d(e,"a",function(){return m});const c=t=>t.className.indexOf("public-DraftEditor-content")>=0,a=t=>!!t.parentElement&&!!t.parentElement.parentElement&&c(t.parentElement.parentElement),l=t=>!(!t.dataset.block||!t.dataset.offsetKey),d=t=>{const e=t.dataset.offsetKey;return e?(t=>t.split("-")[0])(e):""},u=(t,e)=>{return((t,e)=>{const n=function(t,e){let n=0,o=t.length-1;for(;n<=o;){const r=o+n>>1,i=e(t[r]);if(i>0)n=r+1;else{if(!(i<0))return r;o=r-1}}return n}(t,t=>{const n=t.getBoundingClientRect();return e<n.top?-1:e>n.bottom?1:0});return t[Math.min(n,t.length-1)]})(t.querySelectorAll("[data-block][data-offset-key]"),e)},p=(t,e)=>{const n=Object(i.b)(t,l,c);return n||u(t,e)},h=(t,e)=>{const n=(t=>{const e=t.target;if(!(e instanceof HTMLElement))return;const n=Object(i.b)(e,c);if(!n)return;const o=p(e,t.clientY);if(!o)return;const r=Object(i.b)(o,a);return r?{editorContentElement:n,topLevelElement:r,blockElement:o}:void 0})(e);if(!n)return;const o=n.topLevelElement,r=n.blockElement,l=d(r),u=t.getCurrentContent().getBlockForKey(l);if(!u)return;var h=((t,e,n)=>{let o=n,r=n;return t.getType()===s.b.UNSTYLED?o=r=e:Object(s.o)(t.getType())?(o=e,r=n.nextElementSibling):Object(s.u)(t.getType())&&(o=n.previousElementSibling,r=e),{upperElement:o,lowerElement:r}})(u,r,o);const g=h.upperElement,m=h.lowerElement;var f=((t,e,n)=>{const o=t.getBoundingClientRect(),r=e.getBoundingClientRect();let s,a;if(n>(o.top+r.bottom)/2){s=r.bottom,a=!1;const t=Object(i.b)(e,t=>!!t.nextElementSibling,c);t&&(s=(t.nextElementSibling.getBoundingClientRect().top+r.bottom)/2)}else{s=o.top,a=!0;const e=Object(i.b)(t,t=>!!t.previousElementSibling,c);e&&(s=(e.previousElementSibling.getBoundingClientRect().bottom+o.top)/2)}return{clientY:s,isBefore:a}})(g,m,e.clientY);const b=f.clientY,y=f.isBefore;let E=l;if(u.getType()!==s.b.UNSTYLED){const t=p(y?g:m,b);t&&(E=d(t))}return{clientY:b,isBefore:y,blockKey:E}},g=t=>t.items?!!Array.from(t.items).find(t=>"file"===t.kind):!(!t.files||!t.files.length)||r()(t.types,"Files"),m=t=>t.items?Array.from(t.items).map(t=>"file"===t.kind?t.getAsFile():null).filter(Boolean):t.files?Array.from(t.files):[]},"./src/reddit/components/RichTextEditor/HoverTooltip/index.tsx":function(t,e,n){"use strict";n.d(e,"a",function(){return u});var o=n("./node_modules/react/index.js"),r=n.n(o),i=n("./bundled-modules/styled-components/styled-components.min.js"),s=n.n(i),c=n("./src/reddit/constants/colors.ts"),a=n("./src/reddit/helpers/styles/mixins/fonts.tsx"),l=n("./src/reddit/models/Theme/NewColorSystem/index.ts"),d=function(t,e){var n={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(n[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(t);r<o.length;r++)e.indexOf(o[r])<0&&(n[o[r]]=t[o[r]])}return n};const u=s.a.div.withConfig({componentId:"s1mjhccz-0"})(["","position: absolute;bottom: 100%;left: 50%;transform: translateX(-50%);margin-bottom: 5px;padding: 5px 16px;border-radius: 5px;background-color: ",";color: ",';text-align: center;pointer-events: none;white-space: pre;z-index: 99999;&::after {content: "";position: absolute;top: 100%;left: 50%;margin-left: -5px;width: 0;border-top: 5px solid ',";border-right: 5px solid transparent;border-left: 5px solid transparent;}"],a.titleFontH6,c.a.black,t=>Object(l.c)(t).lightText,c.a.black);e.b=s()(t=>{const e=t.text,n=t.children,o=d(t,["text","children"]);return r.a.createElement("div",Object.assign({},o),e?r.a.createElement(u,null,e):null,n)}).withConfig({componentId:"s1mjhccz-1"})(["position: absolute;top: 0;left: 0;right: 0;bottom: 0;"," {opacity: 0;visibility: hidden;transition: opacity 0s 0.5s;}&:hover "," {visibility: visible;opacity: 1;}"],u,u)},"./src/reddit/components/RichTextEditor/Toolbar/FormatterButton/index.tsx":function(t,e,n){"use strict";var o=n("./node_modules/react/index.js"),r=n.n(o),i=n("./bundled-modules/styled-components/styled-components.min.js"),s=n.n(i),c=n("./src/reddit/models/Theme/NewColorSystem/index.ts"),a=n("./src/reddit/components/RichTextEditor/HoverTooltip/index.tsx");const l=t=>{t.preventDefault(),t.stopPropagation()};e.a=s()(t=>{const e=t.active,n=t.className;var o=t.enabled;const i=void 0===o||o,s=t.tooltip,c=t.Icon,d=t.onClick,u=t.children;return r.a.createElement("div",{"aria-label":s,"aria-selected":e,className:n,onMouseDown:l,onClick:function(t){l(t),i&&d&&d(t)},role:"button",tabIndex:-1},r.a.createElement(a.b,{text:i?s:""}),c?r.a.createElement(c,null):null,u)}).withConfig({componentId:"c8hvcq-0"})(["align-items: center;border-radius: 2px;box-sizing: border-box;display: flex;line-height: 0px;outline: none;padding:  4px;position: relative;transition: background-color 0.1s;color: ",";&:hover, &:focus {// TODO STYLE (theme colors)\n","}"],t=>{var e=t.active;const n=void 0!==e&&e;var o=t.enabled;return void 0===o||o?n?Object(c.c)(t).navIcon:Object(c.c)(t).actionIcon:Object(c.c)(t).inactive},({enabled:t=!0})=>t?"background-color: rgba(150, 150, 150, 0.05);":"")},"./src/reddit/components/RichTextEditor/Toolbar/MarkdownButton/index.tsx":function(t,e,n){"use strict";var o=n("./node_modules/react/index.js"),r=n.n(o),i=n("./node_modules/react-redux/es/index.js"),s=n("./node_modules/reselect/es/index.js"),c=n("./bundled-modules/styled-components/styled-components.min.js"),a=n.n(c),l=n("./src/app/strings/index.ts"),d=n("./src/reddit/components/PostCreationForm/DivButton/index.tsx"),u=n("./src/reddit/controls/LoadingIcon/index.tsx"),p=n("./src/reddit/helpers/styles/mixins/fonts.tsx"),h=n("./src/reddit/models/Theme/NewColorSystem/index.ts"),g=n("./src/reddit/selectors/editorContent.ts"),m=n("./src/reddit/components/RichTextEditor/HoverTooltip/index.tsx");const f=Object(l.e)("postCreation.toolbar.markdownMode"),b=Object(l.e)("postCreation.toolbar.switchToMarkdown"),y=a()(u.a).withConfig({componentId:"k55st9-0"})(["display: inline-block;margin-right: 4px;margin-bottom: -4px;border-top: .6em solid rgba(192, 192, 192, 0.7);border-right: .6em solid rgba(192, 192, 192, 0.7);border-bottom: .6em solid rgba(192, 192, 192, 0.7);border-left: .6em solid rgba(192, 192, 192, 0);"]),E=a.a.span.withConfig({componentId:"k55st9-1"})(["","color: ",";"],p.bodyFontSmall,t=>Object(h.c)(t).linkText),O=a()(d.a).withConfig({componentId:"k55st9-2"})(["border-radius: 2px;color: ",";line-height: 20px;outline: none;padding: 4px;position: relative;vertical-align: bottom;&:hover, &:focus {background-color: rgba(150, 150, 150, 0.05);}"],t=>Object(h.c)(t).actionIcon),x=Object(s.c)({isConverting:(t,e)=>Object(g.a)(t,e.draftKey)}),S=Object(i.b)(x);e.a=S(t=>{const e=f(t.language);return r.a.createElement(O,{"aria-label":e,tabIndex:-1,className:t.className,onClick:t.onClick},t.isConverting&&r.a.createElement(y,{sizePx:12}),!t.shouldHideTooltip&&r.a.createElement(m.b,{text:e}),r.a.createElement(E,null,b(t.language)))})},"./src/reddit/components/RichTextEditor/Toolbar/formatterConfigs.ts":function(t,e,n){"use strict";var o=n("./bundled-modules/styled-components/styled-components.min.js"),r=n.n(o),i=n("./src/app/strings/index.ts"),s=n("./src/reddit/components/RichTextEditor/styleAndBlockTypes.ts"),c=n("./node_modules/react/index.js"),a=n.n(c),l=n("./src/reddit/models/Theme/NewColorSystem/index.ts");var d=r()(t=>a.a.createElement("svg",{className:t.className,viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},a.a.createElement("polygon",{points:"8.63 4 5.36 4 2 9.8 2 16 9.2 16 9.2 9.24 6.75 9.24 8.63 4"}),a.a.createElement("polygon",{points:"15.56 9.24 17.39 4 14.16 4 10.8 9.8 10.8 16 18 16 18 9.24 15.56 9.24"}))).withConfig({componentId:"s1f36h4b-0"})(["fill: ",";"],t=>Object(l.c)(t).actionIcon);var u=r()(t=>a.a.createElement("svg",{className:t.className,viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},a.a.createElement("path",{d:"M12.44,9.72v0a3.07,3.07,0,0,0,2.67-3.22c0-2.84-2.42-3.46-5-3.46H4.51V17H10.4c2.61,0,5.09-1,5.09-3.86C15.49,10.91,14.14,10,12.44,9.72ZM7.54,5.38H9.85c1.65,0,2.31.61,2.31,1.7s-.74,1.68-2.35,1.68H7.54ZM10,14.65H7.54V10.95H9.89c1.7,0,2.59.61,2.59,1.83S11.72,14.65,10,14.65Z"}))).withConfig({componentId:"s2jt2t2-0"})(["fill: ",";"],t=>Object(l.c)(t).actionIcon);var p=r()(t=>a.a.createElement("svg",{className:t.className,viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},a.a.createElement("path",{d:"M15,2H13a1,1,0,0,0,0,2h2a1,1,0,0,1,1,1V15a1,1,0,0,1-1,1H5a1,1,0,0,1-1-1V13a1,1,0,0,0-2,0v2a3,3,0,0,0,3,3H15a3,3,0,0,0,3-3V5A3,3,0,0,0,15,2Z"}),a.a.createElement("path",{d:"M2.79,5a.71.71,0,0,0,.53-.2.74.74,0,0,0,.19-.54V4.08l0-.48H5.07V8.4H4.9a1,1,0,0,0-.69.18A.79.79,0,0,0,4,9.2a.79.79,0,0,0,.21.61A1,1,0,0,0,4.9,10H7.1a1,1,0,0,0,.69-.19A.79.79,0,0,0,8,9.2a.78.78,0,0,0-.21-.61A1,1,0,0,0,7.1,8.4H6.93V3.6H8.44l0,.48a1.19,1.19,0,0,0,.18.72.7.7,0,0,0,.56.2.75.75,0,0,0,.59-.2A1,1,0,0,0,10,4.14V4.08L9.93,2.9q0-.64-.18-.77A1.06,1.06,0,0,0,9.11,2H2.89a1.06,1.06,0,0,0-.63.13q-.16.13-.18.77L2,4.08v.06a.94.94,0,0,0,.19.65A.78.78,0,0,0,2.79,5Z"}))).withConfig({componentId:"cjjh4n-0"})(["fill: ",";"],t=>Object(l.c)(t).actionIcon);var h=r()(t=>a.a.createElement("svg",{className:t.className,viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},a.a.createElement("polygon",{points:"6.57 3 6.57 5.57 10.73 5.57 10.73 17 13.82 17 13.82 5.57 18 5.57 18 3 6.57 3"}),a.a.createElement("polygon",{points:"2 9.65 4.68 9.65 4.68 17 6.66 17 6.66 9.65 9.35 9.65 9.35 8 2 8 2 9.65"}))).withConfig({componentId:"s5qm38p-0"})(["fill: ",";"],t=>Object(l.c)(t).actionIcon);var g=r()(t=>a.a.createElement("svg",{className:t.className,viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},a.a.createElement("polygon",{points:"7.24 17 10.3 17 12.1 6.85 9.05 6.85 7.24 17"}),a.a.createElement("polygon",{points:"9.7 3 9.28 5.46 12.34 5.46 12.76 3 9.7 3"}))).withConfig({componentId:"s1hxddto-0"})(["fill: ",";"],t=>Object(l.c)(t).actionIcon);var m=r()(t=>a.a.createElement("svg",{className:t.className,viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},a.a.createElement("path",{d:"M18.8,9.4l-3-4a1,1,0,1,0-1.6,1.2L16.75,10,14.2,13.4a1,1,0,1,0,1.6,1.2l3-4A1,1,0,0,0,18.8,9.4Z"}),a.a.createElement("path",{d:"M5.6,5.2a1,1,0,0,0-1.4.2l-3,4a1,1,0,0,0,0,1.2l3,4a1,1,0,0,0,1.6-1.2L3.25,10,5.8,6.6A1,1,0,0,0,5.6,5.2Z"}),a.a.createElement("path",{d:"M12.24,1A1,1,0,0,0,11,1.76l-4,16A1,1,0,1,0,9,18.24l4-16A1,1,0,0,0,12.24,1Z"}))).withConfig({componentId:"s14o5nnn-0"})(["fill: ",";"],t=>Object(l.c)(t).actionIcon);var f=r()(t=>a.a.createElement("svg",{className:t.className,viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},a.a.createElement("path",{d:"M4.78,5.15H4.15V2H3.09a1,1,0,0,1-.73.25V3a1.84,1.84,0,0,0,.7-.17V5.15H2.35V6H4.78Z"}),a.a.createElement("path",{d:"M3.62,8.88c.25,0,.39.12.39.35s-.17.41-.77.78c-1,.63-1.15,1.21-1.15,1.78V12H5v-.85H3.31c.06-.16.22-.35.72-.64.81-.43,1-.87,1-1.32C5,8.47,4.58,8,3.65,8A1.76,1.76,0,0,0,2.08,9l.72.52A1.07,1.07,0,0,1,3.62,8.88Z"}),a.a.createElement("path",{d:"M4.43,15.87A.82.82,0,0,0,5,15.05C5,14.4,4.53,14,3.65,14a2.15,2.15,0,0,0-1.51.61l.55.64a1.24,1.24,0,0,1,.88-.39c.27,0,.41.12.41.32s-.15.38-.67.38H3v.72h.31c.53,0,.76.13.76.46s-.15.42-.57.42a1.05,1.05,0,0,1-.85-.5L2,17.21A1.83,1.83,0,0,0,3.57,18c.94,0,1.55-.43,1.55-1.24A.87.87,0,0,0,4.43,15.87Z"}),a.a.createElement("path",{d:"M17,9H8a1,1,0,0,0,0,2h9a1,1,0,0,0,0-2Z"}),a.a.createElement("path",{d:"M17,15H8a1,1,0,0,0,0,2h9a1,1,0,0,0,0-2Z"}),a.a.createElement("path",{d:"M8,5h9a1,1,0,0,0,0-2H8A1,1,0,0,0,8,5Z"}))).withConfig({componentId:"s1wne7hn-0"})(["fill: ",";"],t=>Object(l.c)(t).actionIcon);var b=r()(t=>a.a.createElement("svg",{className:t.className,viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},a.a.createElement("path",{d:"M10,1.5A8.5,8.5,0,1,0,18.5,10,8.51,8.51,0,0,0,10,1.5Zm.71,13-.15.12-.18.1-.18.05a.73.73,0,0,1-.2,0,1,1,0,0,1-.71-.29,1,1,0,0,1-.21-.32A1,1,0,0,1,9,13.83a1,1,0,0,1,.08-.38,1,1,0,0,1,.21-.32,1,1,0,0,1,.91-.28l.18.06.18.09.15.13a1,1,0,0,1,.29.7A1,1,0,0,1,10.71,14.54Zm-.22-3.6a.5.5,0,0,1-1,0l-1-4.67A.5.5,0,0,1,9,5.67h2a.5.5,0,0,1,.49.6Z"}))).withConfig({componentId:"rctfde-0"})(["fill: ",";"],t=>Object(l.c)(t).actionIcon);var y=r()(t=>a.a.createElement("svg",{className:t.className,viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},a.a.createElement("path",{d:"M11.86,12a1.36,1.36,0,0,1,.7,1.19c0,1.07-1,1.59-2.42,1.59a4.12,4.12,0,0,1-3.75-2.36L4.08,13.79A6.21,6.21,0,0,0,10,17.2c3.86,0,5.55-2,5.55-4.22a4,4,0,0,0-.12-1Z"}),a.a.createElement("path",{d:"M17,9H11.61l-1.09-.31c-1.82-.51-2.85-.9-2.85-2,0-.82.71-1.39,2-1.39a4.13,4.13,0,0,1,3.41,2L15.2,5.65A6.23,6.23,0,0,0,9.69,2.8c-3,0-5,1.56-5,4.14A3.31,3.31,0,0,0,5.31,9H3a1,1,0,0,0,0,2H17a1,1,0,0,0,0-2Z"}))).withConfig({componentId:"cxa32h-0"})(["fill: ",";"],t=>Object(l.c)(t).actionIcon);var E=r()(t=>a.a.createElement("svg",{className:t.className,viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},a.a.createElement("path",{d:"M6.94,3,2,17H4.83L5.9,13.89h4.75l1,3.11h3.11L9.86,3Zm-.28,8.67L8.29,6.92h0l1.6,4.75Z"}),a.a.createElement("path",{d:"M16.06,3H14.92L13,8.49h1.11l.42-1.22h1.86l.41,1.22H18ZM14.81,6.4l.64-1.86h0l.63,1.86Z"}))).withConfig({componentId:"s1ikz1p7-0"})(["fill: ",";"],t=>Object(l.c)(t).actionIcon);var O=r()(t=>a.a.createElement("svg",{className:t.className,viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},a.a.createElement("path",{d:"M17,9H8a1,1,0,0,0,0,2h9a1,1,0,0,0,0-2Z"}),a.a.createElement("path",{d:"M17,15H8a1,1,0,0,0,0,2h9a1,1,0,0,0,0-2Z"}),a.a.createElement("path",{d:"M8,5h9a1,1,0,0,0,0-2H8A1,1,0,0,0,8,5Z"}),a.a.createElement("path",{d:"M4.88,9.43a1.29,1.29,0,0,0-.13-.26,2.17,2.17,0,0,0-.19-.23,1.55,1.55,0,0,0-2.12,0,2.16,2.16,0,0,0-.19.23,2.2,2.2,0,0,0-.14.26A2.3,2.3,0,0,0,2,9.71,1.32,1.32,0,0,0,2,10a1.5,1.5,0,0,0,1.5,1.5,1.55,1.55,0,0,0,.57-.11A1.52,1.52,0,0,0,5,10a1.32,1.32,0,0,0,0-.29A1.27,1.27,0,0,0,4.88,9.43Z"}),a.a.createElement("path",{d:"M4.33,14.75l-.26-.14-.28-.08a1.42,1.42,0,0,0-.58,0l-.28.08-.26.14a2.16,2.16,0,0,0-.23.19A1.52,1.52,0,0,0,2,16a1.47,1.47,0,0,0,.44,1.06,1.52,1.52,0,0,0,.49.33,1.53,1.53,0,0,0,1.14,0,1.61,1.61,0,0,0,.49-.33A1.52,1.52,0,0,0,5,16a1.5,1.5,0,0,0-.44-1.06A2.06,2.06,0,0,0,4.33,14.75Z"}),a.a.createElement("path",{d:"M2.44,2.94A1.52,1.52,0,0,0,2,4a1.47,1.47,0,0,0,.44,1.06,1.59,1.59,0,0,0,.48.33,1.65,1.65,0,0,0,.58.11,1.55,1.55,0,0,0,.57-.11,1.5,1.5,0,0,0,.49-.33,1.5,1.5,0,0,0,0-2.12A1.55,1.55,0,0,0,2.44,2.94Z"}))).withConfig({componentId:"s1wsr5qw-0"})(["fill: ",";"],t=>Object(l.c)(t).actionIcon);n.d(e,"f",function(){return x}),n.d(e,"b",function(){return K}),n.d(e,"e",function(){return M}),n.d(e,"j",function(){return L}),n.d(e,"g",function(){return D}),n.d(e,"i",function(){return N}),n.d(e,"k",function(){return F}),n.d(e,"d",function(){return P}),n.d(e,"l",function(){return _}),n.d(e,"h",function(){return U}),n.d(e,"a",function(){return H}),n.d(e,"c",function(){return z});const x=(t,e=0)=>r()(t).withConfig({componentId:"atffc4-0"})(["fill: currentColor;width: 20px;height: 20px;box-sizing: border-box;",""],e?`padding: ${e}px;`:""),S=x(d),C=x(u),v=x(p),k=x(h),j=x(g),w=x(m),T=x(f),I=x(b,1),R=x(y),A=x(E),B=x(O),K={type:"style",name:"bold",Icon:C,style:s.k.BOLD,tooltipTranslation:Object(i.e)("postCreation.toolbar.bold")},M={type:"style",name:"italics",Icon:j,style:s.k.ITALIC,tooltipTranslation:Object(i.e)("postCreation.toolbar.italics")},L={type:"style",name:"strikethrough",Icon:R,style:s.k.STRIKETHROUGH,tooltipTranslation:Object(i.e)("postCreation.toolbar.strikethrough")},D={type:"style",name:"inline_code",Icon:w,style:s.k.MONOSPACE,tooltipTranslation:Object(i.e)("postCreation.toolbar.monospace")},N={type:"style",name:"spoiler",Icon:I,style:s.k.SPOILER,tooltipTranslation:Object(i.e)("postCreation.toolbar.spoiler")},F={type:"style",name:"superscript",Icon:A,style:s.k.SUPERSCRIPT,tooltipTranslation:Object(i.e)("postCreation.toolbar.superscript")},P={type:"block",name:"heading",Icon:k,block:s.b.H1,tooltipTranslation:Object(i.e)("postCreation.toolbar.heading")},_={type:"block",name:"unordered_list",Icon:B,block:s.i.UNORDERED,tooltipTranslation:Object(i.e)("postCreation.toolbar.unorderedList")},U={type:"block",name:"ordered_list",Icon:T,block:s.i.ORDERED,tooltipTranslation:Object(i.e)("postCreation.toolbar.orderedList")},H={type:"block",name:"block_quote",Icon:S,block:s.e,tooltipTranslation:Object(i.e)("postCreation.toolbar.blockQuote")},z={type:"block",name:"code_block",Icon:v,block:s.f,tooltipTranslation:Object(i.e)("postCreation.toolbar.codeBlock")}},"./src/reddit/components/RichTextEditor/Toolbar/index.tsx":function(t,e,n){"use strict";var o=n("./node_modules/draft-js/lib/Draft.js"),r=n("./node_modules/react/index.js"),i=n.n(r),s=n("./bundled-modules/styled-components/styled-components.min.js"),c=n.n(s),a=n("./src/app/strings/index.ts"),l=n("./src/reddit/constants/componentSizes.ts"),d=n("./src/reddit/constants/zIndex.ts"),u=n("./src/reddit/icons/svgs/FormattingHyperlink/index.tsx"),p=n("./src/reddit/models/Theme/NewColorSystem/index.ts");var h=c()(t=>i.a.createElement("svg",{className:t.className,viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},i.a.createElement("path",{d:"M17,2H3A1,1,0,0,0,2,3V17a1,1,0,0,0,1,1H17a1,1,0,0,0,1-1V3A1,1,0,0,0,17,2ZM4,6H9V9.8H4Zm7,0h5V9.8H11ZM4,11.8H9V16H4ZM11,16V11.8h5V16Z"}))).withConfig({componentId:"y6wwrz-0"})(["fill: ",";"],t=>Object(p.c)(t).actionIcon),g=n("./src/reddit/components/RichTextEditor/editorStateTransforms.ts"),m=n("./src/reddit/components/RichTextEditor/helpers/controlsState.ts"),f=n("./src/reddit/components/RichTextEditor/HoverTooltip/index.tsx"),b=n("./src/reddit/components/RichTextEditor/styleAndBlockTypes.ts"),y=n("./src/reddit/components/RichTextEditor/constants/editorChangeTypes.ts"),E=n("./src/reddit/components/RichTextEditor/helpers/common.ts"),O=n("./src/reddit/components/RichTextEditor/table/helpers.ts");var x=(t,e,n)=>{if(Object(b.v)(o.RichUtils.getCurrentBlockType(t)))return t;const r=t.getCurrentContent(),i=t.getSelection().getEndKey(),s=Object(O.l)(e,n),c=Object(E.f)(r,i,s,E.a.after,!0),a=o.EditorState.push(t,c,y.d);return o.EditorState.forceSelection(a,o.SelectionState.createEmpty(s[0].getKey()))},S=n("./src/reddit/components/RichTextEditor/Toolbar/FormatterButton/index.tsx"),C=n("./src/reddit/components/RichTextEditor/Toolbar/formatterConfigs.ts"),v=n("./src/reddit/components/RichTextEditor/Toolbar/MarkdownButton/index.tsx"),k=n("./src/lib/constants/index.ts"),j=n("./src/reddit/icons/svgs/ImagePost/index.tsx"),w=n("./src/reddit/icons/svgs/Video/index.tsx");const T=Object(a.e)("postCreation.toolbar.image"),I=Object(a.e)("postCreation.toolbar.video"),R="\n  fill: currentColor;\n  width: 20px;\n  height: 20px;\n  box-sizing: border-box;\n",A=c()(j.a).withConfig({componentId:"s16ayv6a-0"})(["",""],R),B=c()(w.a).withConfig({componentId:"s16ayv6a-1"})(["",""],R),K=c.a.input.withConfig({componentId:"s16ayv6a-2"})(["display: none;"]);class M extends r.Component{constructor(){super(...arguments),this.hiddenInputEl=null,this.onFileInputChange=(t=>{t.stopPropagation();const e=this.hiddenInputEl;e.files&&e.files.length&&(this.props.onFilesInput(Array.from(e.files)),e.value="")}),this.onButtonClick=(()=>{this.hiddenInputEl&&this.hiddenInputEl.click(),this.props.onClick()}),this.onHiddenInputClick=(t=>t.stopPropagation())}render(){var t=this.props;const e=t.controlsState,n=t.destSubreddit,o=t.language,r="image"===t.type,s=e.blocks[b.a];let c=!0;if(n&&n.allowedPostTypes){var a=n.allowedPostTypes;const t=a.images,e=a.videos;c=r?t:e}return i.a.createElement(S.a,{Icon:r?A:B,active:s.isActive,enabled:s.isEnabled&&c,tooltip:(r?T:I)(o),onClick:this.onButtonClick},i.a.createElement(K,{multiple:!0,innerRef:t=>this.hiddenInputEl=t,onChange:this.onFileInputChange,onClick:this.onHiddenInputClick,type:"file",accept:Array.from(r?k.a:k.b).join()}))}}n.d(e,"c",function(){return _}),n.d(e,"g",function(){return z}),n.d(e,"f",function(){return V}),n.d(e,"h",function(){return W}),n.d(e,"e",function(){return $}),n.d(e,"a",function(){return q}),n.d(e,"d",function(){return Z}),n.d(e,"b",function(){return G});const L=Object(a.e)("postCreation.toolbar.table"),D=Object(a.e)("postCreation.toolbar.link"),N=Object(C.f)(u.a),F=Object(C.f)(h),P=c.a.div.withConfig({componentId:"s1h8kynx-0"})(["display: flex;align-items: center;background-color: ",";border-radius: 3px 3px 0 0;box-sizing: border-box;height: ","px;padding: 4px;border-radius: 4px;",'// Don\'t use "position: sticky" for MS Edge\n@supports (-ms-ime-align: auto) {position: static;}// This is needed for removing tooltip delay when user moves mouse pointer\n// from one toolbar icon to other\n&:hover '," "," {opacity: 1;}flex-wrap: wrap;"],t=>Object(p.c)(t).field,l.D,t=>t.isSticky?`\n        position: sticky;\n        top: ${l.j}px;\n        z-index: ${d.g-2};`:"",f.b,f.a),_=c.a.div.withConfig({componentId:"s1h8kynx-1"})(["box-sizing: border-box;height: 14px;width: 1px;margin: 0 6px;border-right: 1px solid ",";"],t=>Object(p.c)(t).line),U=c.a.div.withConfig({componentId:"s1h8kynx-2"})(["display: flex;flex-grow: 1;"]),H=(t,e,n,r,s,c)=>{const a=t.name,l=t.Icon,d=(0,t.tooltipTranslation)(c);if("style"===t.type){const o=t.style;return i.a.createElement(S.a,{Icon:l,active:e.styles[o].isActive,enabled:e.styles[o].isEnabled,key:a,tooltip:d,onClick:()=>{const t=Object(g.c)(o,n);r(t),s(a,((t,e)=>t.getCurrentInlineStyle().contains(e))(t,o))}})}{const c=t.block;return i.a.createElement(S.a,{Icon:l,active:e.blocks[c].isActive,enabled:e.blocks[c].isEnabled,key:a,tooltip:d,onClick:()=>{const t=Object(g.i)(c,n);r(t),s(a,((t,e)=>o.RichUtils.getCurrentBlockType(t)===e)(t,c))}})}},z=(t,e,n,o,r,i)=>t.map(t=>H(t,e,n,o,r,i)),V=[C.b,C.e],W=[C.j,C.g,C.k,C.i],$=[C.d,C.l,C.h,C.a,C.c],q=t=>i.a.createElement(S.a,{Icon:N,active:t.controlsState.link.isActive,enabled:t.controlsState.link.isEnabled,tooltip:D(t.language),onClick:()=>{t.onLinkButtonClick(),t.trackOnClick("link",!0)}}),Z=t=>i.a.createElement(S.a,{Icon:F,active:t.controlsState.blocks[b.l].isActive,enabled:t.controlsState.blocks[b.l].isEnabled,tooltip:L(t.language),onClick:()=>{t.onChange(x(t.editorState,3,2)),t.trackOnClick("table",!0)}}),G=t=>{const e=t.className;var n=t.allowMedia;const o=void 0!==n&&n,r=t.destSubreddit,s=t.editorState,c=t.isOverlay,a=t.language,l=t.onChange,d=t.onFilesSelect,u=t.readOnly,p=t.trackOnClick,h=t.onLinkButtonClick,g=t.onMarkdownButtonClick,f=Object(m.a)(s);return u&&Object(m.b)(f),i.a.createElement(P,{className:e,isSticky:!c},z(V,f,s,l,p,a),i.a.createElement(q,{language:a,controlsState:f,trackOnClick:p,onLinkButtonClick:h}),z(W,f,s,l,p,a),i.a.createElement(_,null),z($,f,s,l,p,a),i.a.createElement(_,null),i.a.createElement(Z,{language:a,controlsState:f,editorState:s,trackOnClick:p,onChange:l}),o&&i.a.createElement(M,{destSubreddit:r,language:a,controlsState:f,onClick:()=>p("image_upload"),onFilesInput:d,type:"image"}),o&&i.a.createElement(M,{destSubreddit:r,language:a,controlsState:f,onClick:()=>p("video_upload"),onFilesInput:d,type:"video"}),i.a.createElement(U,null),i.a.createElement(v.a,{language:a,onClick:g}))}},"./src/reddit/components/RichTextEditor/Tooltip/index.m.less":function(t,e,n){t.exports={tooltipBox:"tVQ1dB4n0mAWdcQNxFq-K",triangle:"_2O2U-Vhc1mg9O7DOwp50Aa",triangleBack:"_3IfYYXUMUzn2OvoiMUNcaQ",triangleFront:"_3CtwSTtkmKXvzDo3TmCp9C",triangleBelow:"_1churYJpAwcb-tf0k1c46F"}},"./src/reddit/components/RichTextEditor/Tooltip/index.tsx":function(t,e,n){"use strict";n.d(e,"a",function(){return p}),n.d(e,"b",function(){return g});var o=n("./node_modules/react/index.js"),r=n.n(o),i=n("./src/lib/classNames/index.ts"),s=n("./src/reddit/helpers/dom/index.ts"),c=n("./src/reddit/components/RichTextEditor/Tooltip/index.m.less"),a=n.n(c);const l=8,d=16,u=12+d/2;var p;!function(t){t[t.None=0]="None",t[t.Above=1]="Above",t[t.Below=2]="Below"}(p||(p={}));const h=({isBelow:t=!1,style:e})=>r.a.createElement("div",{className:Object(i.a)(a.a.triangle,{[a.a.triangleBelow]:t}),style:e},r.a.createElement("div",{className:a.a.triangleBack}),r.a.createElement("div",{className:a.a.triangleFront}));class g extends o.Component{constructor(t){super(t),this.containerRef=null,this.updateContainerRef=(t=>this.containerRef=t),this.setTargetPosition=(t=>{t?this.updatePositioning(t):this.setState({positioning:null})}),this.state={positioning:null}}updatePositioning(t){if(!this.containerRef)return;const e=this.containerRef.offsetWidth,n=this.containerRef.offsetHeight,o=this.state.positioning;if(!t){if(!o)return;if(o.tooltipWidth===e&&o.tooltipHeight===n)return}const r=t?t.top:o.target.top,i=t?t.left:o.target.left,c=Object(s.e)(this.containerRef);let a,l;if(c){const t=c.getBoundingClientRect();a=i-t.left+c.scrollLeft,l=r-t.top+c.scrollTop}else{const t=document.documentElement,e=window.pageYOffset||t.scrollTop;a=i+(window.pageXOffset||t.scrollLeft),l=r+e}const d={target:{top:r,left:i},tooltipWidth:e,tooltipHeight:n,tooltip:{top:l,left:a}};this.adjustPositionForTriangle(d,c),this.setState({positioning:d})}adjustPositionForTriangle(t,e){const n=this.props.trianglePlacement;if(!n)return;const o=e?e.offsetWidth:document.documentElement.offsetWidth,r=o?Math.max(t.tooltip.left+t.tooltipWidth-o,0):0;t.tooltip.left-=r+u;const i=r+u-d/2;let s;n===p.Above?(t.tooltip.top+=l,s=-l):(t.tooltip.top-=t.tooltipHeight+l,s=t.tooltipHeight),t.triangle={top:s,left:i}}componentDidUpdate(t,e){t.targetPosition!==this.props.targetPosition?this.setTargetPosition(this.props.targetPosition||null):this.updatePositioning()}componentDidMount(){this.setTargetPosition(this.props.targetPosition||null),this.props.onSetPositionUpdater&&this.props.onSetPositionUpdater(this.setTargetPosition)}componentWillUnmount(){this.props.onSetPositionUpdater&&this.props.onSetPositionUpdater(null)}render(){const t=this.props.trianglePlacement,e=this.state.positioning,n=e&&void 0!==e.triangle&&r.a.createElement(h,{isBelow:t===p.Below,style:{top:e.triangle.top+"px",left:e.triangle.left+"px"}});return r.a.createElement("div",{className:Object(i.a)(a.a.tooltipBox,this.props.className),style:e?{left:e.tooltip.left,top:e.tooltip.top}:{},ref:this.updateContainerRef},e&&this.props.children&&r.a.createElement(r.a.Fragment,null,n,this.props.children))}}},"./src/reddit/components/RichTextEditor/constants/draftEditorCommands.ts":function(t,e,n){"use strict";n.d(e,"c",function(){return o}),n.d(e,"e",function(){return r}),n.d(e,"g",function(){return i}),n.d(e,"h",function(){return s}),n.d(e,"b",function(){return c}),n.d(e,"d",function(){return a}),n.d(e,"f",function(){return l}),n.d(e,"a",function(){return d});const o="bold",r="italic",i="underline",s="undo",c="backspace",a="delete",l="split-block",d="adjust-depth"},"./src/reddit/components/RichTextEditor/constants/editorChangeTypes.ts":function(t,e,n){"use strict";n.d(e,"d",function(){return o}),n.d(e,"c",function(){return r}),n.d(e,"a",function(){return i}),n.d(e,"b",function(){return s}),n.d(e,"e",function(){return c});const o="insert-fragment",r="insert-characters",i="change-block-data",s="change-block-type",c="remove-range"},"./src/reddit/components/RichTextEditor/editorStateTransforms.ts":function(t,e,n){"use strict";n.d(e,"c",function(){return u}),n.d(e,"i",function(){return p}),n.d(e,"b",function(){return m}),n.d(e,"f",function(){return f}),n.d(e,"h",function(){return b}),n.d(e,"g",function(){return y}),n.d(e,"d",function(){return E}),n.d(e,"e",function(){return O}),n.d(e,"a",function(){return x});var o=n("./node_modules/draft-js/lib/Draft.js"),r=n("./node_modules/immutable/dist/immutable.js"),i=n("./src/reddit/components/RichTextEditor/constants/draftEditorCommands.ts"),s=n("./src/reddit/components/RichTextEditor/constants/editorChangeTypes.ts"),c=n("./src/reddit/components/RichTextEditor/emotes/helpers.ts"),a=n("./src/reddit/components/RichTextEditor/helpers/modifiers.ts"),l=n("./src/reddit/components/RichTextEditor/helpers/styles.ts"),d=n("./src/reddit/components/RichTextEditor/styleAndBlockTypes.ts");const u=(t,e)=>{return e.getSelection().isCollapsed()?Object(l.a)(t,e):Object(l.b)(t,e)},p=(t,e)=>{const n=e.getCurrentContent(),r=e.getSelection(),i=r.getEndKey(),a=o.RichUtils.getCurrentBlockType(e)===t?d.n:t;let u=e,p=o.Modifier.setBlockType(n,r,a);const h=n.getBlockForKey(i).getLength();if(Object(d.r)(a)||Object(d.q)(a)){const t=o.SelectionState.createEmpty(r.getStartKey()).merge({focusKey:r.getEndKey(),focusOffset:h});u=Object(l.c)(u),p=((t,e)=>{const n=Object.keys(d.k).reduce((t,n)=>o.Modifier.removeInlineStyle(t,e,d.k[n]),t);return Object(c.c)(n,e)})(p,t)}if(Object(d.q)(a)||Object(d.p)(a)){const t=p.getBlockAfter(i);if(!t||t.getType()!==a&&t.getType()!==d.n){const t=o.SelectionState.createEmpty(i).merge({anchorOffset:h,focusOffset:h});p=o.Modifier.splitBlock(p,t),p=o.Modifier.setBlockType(p,p.getSelectionAfter(),d.n)}}return p=p.merge({selectionAfter:r}),o.EditorState.push(u,p,s.b)},h=(t,e)=>{const n=o.Modifier.setBlockType(t,e,d.n);return o.Modifier.replaceText(n,e,"",Object(r.OrderedSet)([]))},g=(t,e)=>o.EditorState.forceSelection(t,o.SelectionState.createEmpty(e)),m=t=>{const e=t.getCurrentContent(),n=t.getSelection(),i=a.d(e,n),c=i.getBlockAfter(n.getEndKey()),l=o.SelectionState.createEmpty(c.getKey()),u=o.Modifier.replaceText(o.Modifier.setBlockType(i,l,d.n),l,"",Object(r.OrderedSet)([])),p=o.EditorState.push(t,u,s.c);return g(p,c.getKey())},f=t=>{const e=t.getCurrentContent(),n=t.getSelection(),r=e.getBlockForKey(n.getEndKey()),s=r.set("depth",Math.max(r.getDepth()-1,0)),c=e.merge({blockMap:e.getBlockMap().merge({[r.getKey()]:s})});return o.EditorState.push(t,c,i.a)},b=t=>{const e=t.getCurrentContent(),n=t.getSelection(),r=e.getBlockForKey(n.getEndKey()).getKey(),i=o.EditorState.push(t,h(e,n),s.b);return g(i,r)},y=t=>{const e=t.getCurrentContent(),n=t.getSelection(),r=e.getBlockForKey(n.getEndKey()),i=r.getKey(),c=e.getBlockBefore(i).getKey(),a=o.SelectionState.createEmpty(i).merge({focusOffset:r.getText().length}),l=o.EditorState.push(t,h(((t,e)=>{const n=t.getBlockMap().remove(e);return t.merge({blockMap:n})})(e,c),a),s.b);return g(l,i)},E=t=>{const e=a.d(t.getCurrentContent(),t.getSelection());return o.EditorState.push(t,e,i.f)},O=t=>{const e=a.a(t.getCurrentContent(),t.getSelection(),"\n");return o.EditorState.push(t,e,s.c)},x=t=>{const e=t.getSelection(),n=a.a(t.getCurrentContent(),e," ");return o.EditorState.push(t,n,s.c)}},"./src/reddit/components/RichTextEditor/emotes/decorator.m.less":function(t,e,n){t.exports={emote:"Q7hqnjoPSXm7QyvW8qf57"}},"./src/reddit/components/RichTextEditor/emotes/helpers.ts":function(t,e,n){"use strict";n.d(e,"b",function(){return d}),n.d(e,"a",function(){return u}),n.d(e,"c",function(){return p});var o=n("./node_modules/draft-js/lib/Draft.js"),r=n("./src/reddit/components/RichTextEditor/constants/editorChangeTypes.ts"),i=n("./src/reddit/components/RichTextEditor/entity/entityTypes.ts"),s=n("./src/reddit/components/RichTextEditor/entity/getAllEntitiesInSelection.ts"),c=n("./src/reddit/components/RichTextEditor/helpers/modifiers.ts"),a=n("./src/reddit/components/RichTextEditor/styleAndBlockTypes.ts");const l="⬛";function d(t,e){let n=e.getCurrentContent();const s=(n=n.createEntity(i.a.EMOTE,"IMMUTABLE",t)).getLastCreatedEntityKey();n=Object(c.b)(n,e.getSelection(),l,void 0,s);const a=o.EditorState.push(e,n,r.c);return o.EditorState.forceSelection(a,a.getSelection())}function u(t,e){if(e.getStartKey()!==e.getEndKey())return!1;const n=t.getBlockForKey(e.getEndKey()).getType();return!(Object(a.q)(n)||Object(a.r)(n)||Object(a.t)(n))}function p(t,e){const n=Object(s.a)(t,e,e=>{const n=e.getEntity();return!!n&&t.getEntity(n).getType()===i.a.EMOTE});let r;for(;r=n.pop();){const e=o.SelectionState.createEmpty(r.blockKey).merge({anchorOffset:r.start,focusOffset:r.end});t=o.Modifier.removeRange(t,e,"backward")}return t}},"./src/reddit/components/RichTextEditor/entity/applyEntityToContentBlock.ts":function(t,e,n){"use strict";n.d(e,"a",function(){return r});var o=n("./node_modules/draft-js/lib/Draft.js");function r(t,e,n,r){let i=t.getCharacterList();return i=i.withMutations(t=>{for(let i=e;i<n;i++)t.set(i,o.CharacterMetadata.applyEntity(t.get(i),r))}),t.set("characterList",i)}},"./src/reddit/components/RichTextEditor/entity/cloneEntitiesInFragment.ts":function(t,e,n){"use strict";n.d(e,"a",function(){return i}),n.d(e,"b",function(){return s});var o=n("./src/reddit/components/RichTextEditor/entity/applyEntityToContentBlock.ts"),r=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],o=!0,r=!1,i=void 0;try{for(var s,c=t[Symbol.iterator]();!(o=(s=c.next()).done)&&(n.push(s.value),!e||n.length!==e);o=!0);}catch(a){r=!0,i=a}finally{try{!o&&c.return&&c.return()}finally{if(r)throw i}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();function i(t,e,n,r,i){const s=t.createEntity(n.getType(),n.getMutability(),n.getData()),c=t.getLastCreatedEntityKey();return[s,Object(o.a)(e,r,i,c)]}function s(t,e,n=!1){const o=new Map;let s=e,c=t;return e.forEach((t,e)=>{t&&e&&t.findEntityRanges(t=>!!t.getEntity(),(n,r)=>{const i=t.getEntityAt(n),s=o.get(i)||[];s.push({start:n,end:r,blockKey:e}),o.set(i,s)})}),o.forEach((e,o)=>{const a=t.getEntity(o);(n?e.slice(1):e).forEach(({start:t,end:e,blockKey:n})=>{const o=s.get(n);var l=i(c,o,a,t,e),d=r(l,2);const u=d[0],p=d[1];c=u,s=s.set(n,p)})}),[c,s]}},"./src/reddit/components/RichTextEditor/entity/entityTypes.ts":function(t,e,n){"use strict";n.d(e,"a",function(){return o}),n.d(e,"b",function(){return i});const o={COMMENT_LINK:"COMMENT_LINK",EMOTE:"EMOTE",LINK:"LINK",POST_LINK:"POST_LINK",SUBREDDIT_LINK:"SUBREDDIT_LINK",USER_LINK:"USER_LINK"},r=new Set([o.COMMENT_LINK,o.LINK,o.POST_LINK,o.SUBREDDIT_LINK,o.USER_LINK]),i=(t,e)=>{const n=t&&e.getEntity(t);return!!n&&(t=>r.has(t))(n.getType())}},"./src/reddit/components/RichTextEditor/entity/getAllEntitiesInSelection.ts":function(t,e,n){"use strict";n.d(e,"a",function(){return r});var o=n("./src/reddit/components/RichTextEditor/helpers/forEachBlock.ts");function r(t,e,n){const r=[];return Object(o.a)(t,e,(t,o)=>{const i=e.getStartKey()===o?e.getStartOffset():0,s=e.getEndKey()===o?e.getEndOffset():t.getLength();t.findEntityRanges(n,(e,n)=>{i<=n&&s>=e&&r.push({blockKey:o,entityKey:t.getEntityAt(e),start:e,end:n})})}),r}},"./src/reddit/components/RichTextEditor/entity/getSelectionEntityInfo.ts":function(t,e,n){"use strict";n.d(e,"a",function(){return r});var o=n("./node_modules/draft-js/lib/Draft.js");function r(t,e){const n=e.getFocusKey();if(n!==e.getAnchorKey())return;const r=t.getBlockForKey(n),i=e.getStartOffset(),s=e.getEndOffset(),c=r.getEntityAt(s)||(s>0?r.getEntityAt(s-1):null);if(!c)return;let a,l;if(r.findEntityRanges(t=>t.getEntity()===c,(t,e)=>{t<=i&&s<=e&&(a=t,l=e)}),"number"!=typeof a||"number"!=typeof l)return;const d=r.getText().slice(a,l);return{entitySelection:o.SelectionState.createEmpty(n).merge({anchorOffset:a,focusOffset:l}),entityKey:c,entityText:d}}},"./src/reddit/components/RichTextEditor/entity/link/helpers.tsx":function(t,e,n){"use strict";n.d(e,"a",function(){return h}),n.d(e,"d",function(){return g}),n.d(e,"f",function(){return m}),n.d(e,"b",function(){return f}),n.d(e,"c",function(){return b}),n.d(e,"h",function(){return y}),n.d(e,"g",function(){return E}),n.d(e,"e",function(){return O});var o=n("./node_modules/draft-js/lib/Draft.js"),r=n("./src/lib/linkMatchers/index.ts"),i=n("./src/lib/linkMatchers/customLinks.ts"),s=n("./src/lib/memoizeByReference/index.ts"),c=n("./src/reddit/components/RichTextEditor/spoiler/helpers.ts"),a=n("./src/reddit/components/RichTextEditor/styleAndBlockTypes.ts"),l=n("./src/reddit/components/RichTextEditor/entity/entityTypes.ts"),d=n("./src/reddit/components/RichTextEditor/entity/getAllEntitiesInSelection.ts"),u=n("./src/reddit/components/RichTextEditor/entity/getSelectionEntityInfo.ts");const p=t=>`/r/${t}/`;function h(t,e,n){t.findEntityRanges(t=>{const e=t.getEntity();if(!e)return!1;const o=n.getEntity(e).getType();return o===l.a.LINK||o===l.a.SUBREDDIT_LINK||o===l.a.USER_LINK},e)}const g=Object(s.a)(function(t){const e=t.getCurrentContent(),n=t.getSelection();if(!n.isCollapsed())return;if(Object(a.q)(e.getBlockForKey(n.getStartKey()).getType()))return;const i=n.getFocusKey(),s=e.getBlockForKey(i),l=n.getFocusOffset(),d=s.getText(),u=d.lastIndexOf(" ",l-1)+1,p=d.slice(u,l);if(!p)return;const h=r.c.match(p);if(!h)return;const g=h[h.length-1],m=u+g.index,f=u+g.lastIndex;let b=-1;if(s.findEntityRanges(t=>!!t.getEntity(),(t,e)=>{t<l&&(b=e)}),b>=m)return;return s.getCharacterList().slice(m,f).find(c.b)?void 0:{selection:o.SelectionState.createEmpty(i).merge({anchorOffset:m,focusOffset:f}),url:g.url}});function m(t,e,n){const r=t.getSelection();let i=t.getCurrentContent();const s=(i=i.createEntity(l.a.LINK,"MUTABLE",{url:n})).getLastCreatedEntityKey();return i=(i=o.Modifier.applyEntity(i,e,s)).merge({selectionAfter:r}),o.EditorState.push(t,i,"apply-entity")}const f=Object(s.a)(function(t){const e=t.getCurrentContent(),n=Object(u.a)(e,t.getSelection());if(!n)return;const o=e.getEntity(n.entityKey);if(o.getType()!==l.a.LINK)return;const r=o.getData().url;return Object.assign({url:r},n)});const b=Object(s.a)(function(t){const e=t.getCurrentContent(),n=t.getSelection(),o=Object(u.a)(e,n);if(!o)return;const r=n.getFocusOffset(),s=e.getEntity(o.entityKey),c=("/"===o.entityText[0]?"/":"")+i.e;if(s.getType()!==l.a.SUBREDDIT_LINK||!o.entityText.startsWith(c)||r-o.entitySelection.getStartOffset()<c.length)return;const a=o.entityText.slice(c.length);return Object.assign({subredditName:a},o)});function y(t,e,n,r){let i="apply-entity",s=t.getCurrentContent(),c=t;const a=Object(u.a)(s,e);if(n)if(a){s.getEntity(a.entityKey).getData().url!==n&&(s=s.mergeEntityData(a.entityKey,{url:n})),void 0!==r&&a.entityText!==r&&(s=o.Modifier.replaceText(s,a.entitySelection,r,void 0,a.entityKey),i="insert-characters")}else{if(void 0===r)throw new Error("New link display text must be provided!");const t=(s=s.createEntity(l.a.LINK,"MUTABLE",{url:n})).getLastCreatedEntityKey();s=o.Modifier.replaceText(s,e,r,void 0,t),i="insert-characters"}else s=(s=o.Modifier.applyEntity(s,e,"")).merge({selectionAfter:t.getSelection()});return s===t.getCurrentContent()?t:c=o.EditorState.push(c,s,i)}function E(t,e){const n=b(t);if(!n)return t;const r=`${"/"===n.entityText[0]?"/":""}${i.e}${e}`,s=p(e),c=n.entitySelection.getStartOffset()+r.length;let a=y(t,n.entitySelection,s,r);return a=o.EditorState.forceSelection(a,n.entitySelection.merge({anchorOffset:c,focusOffset:c}))}function O(t,e){if(e.getStartKey()!==e.getEndKey())return!1;const n=t.getBlockForKey(e.getEndKey()).getType();return!Object(a.q)(n)&&!Object(a.t)(n)&&!Object(d.a)(t,e,e=>{const n=e.getEntity();return!!n&&t.getEntity(n).getType()!==l.a.LINK}).length}},"./src/reddit/components/RichTextEditor/helpers/common.ts":function(t,e,n){"use strict";n.d(e,"a",function(){return o}),n.d(e,"g",function(){return c}),n.d(e,"e",function(){return a}),n.d(e,"c",function(){return l}),n.d(e,"f",function(){return d}),n.d(e,"b",function(){return u}),n.d(e,"h",function(){return p}),n.d(e,"d",function(){return h});var o,r=n("./node_modules/draft-js/lib/Draft.js"),i=n("./node_modules/immutable/dist/immutable.js"),s=n("./src/reddit/components/RichTextEditor/styleAndBlockTypes.ts");!function(t){t.before="before",t.after="after"}(o||(o={}));const c=(t,e)=>new r.ContentBlock(Object.assign({key:t||Object(r.genKey)()},e?{text:e,characterList:Object(i.List)(Object(i.Repeat)(r.CharacterMetadata.create(),e.length))}:{})),a=t=>t.props.children,l=t=>a(t).props.block,d=(t,e,n,i=o.after,a=!1,l=!1)=>{const d=[];let p=-1;if(t.getBlockMap().forEach((t,r)=>{i===o.after&&d.push(t),r===e&&(d.push(...n),p=d.length-1),i===o.before&&d.push(t)}),p>=0){if(a){const t=d[p+1];t&&t.getType()===s.n||d.splice(p+1,0,c())}if(l){const t=p-n.length,e=d[t];e&&e.getType()===s.n||d.splice(t+1,0,c())}}return t.merge({blockMap:r.BlockMapBuilder.createFromArray(d),selectionAfter:u(n[n.length-1],!1,!0)})},u=(t,e=!1,n=!1)=>{let o=r.SelectionState.createEmpty(t.getKey()).merge({hasFocus:n});return e&&(o=o.merge({anchorOffset:t.getLength(),focusOffset:t.getLength()})),o},p=(t,e)=>{let n=t.getBlockBefore(e),o=t.getBlockMap();return o.get(e)?(o=o.size>1?o.remove(e):o.set(e,c(e)),n=n||o.first(),t.merge({blockMap:o,selectionAfter:u(n,!0)})):t},h=(t,e)=>e.querySelector(`[data-block][data-offset-key="${t}-0-0"]`)},"./src/reddit/components/RichTextEditor/helpers/controlsState.ts":function(t,e,n){"use strict";n.d(e,"a",function(){return g}),n.d(e,"b",function(){return m});var o=n("./node_modules/lodash/forEach.js"),r=n.n(o),i=n("./src/lib/forEachGroup/index.ts"),s=n("./src/lib/memoizeByReference/index.ts"),c=n("./src/reddit/components/RichTextEditor/emotes/helpers.ts"),a=n("./src/reddit/components/RichTextEditor/entity/link/helpers.tsx"),l=n("./src/reddit/components/RichTextEditor/styleAndBlockTypes.ts"),d=n("./src/reddit/components/RichTextEditor/table/helpers.ts"),u=n("./src/reddit/components/RichTextEditor/helpers/forEachBlock.ts"),p=n("./src/reddit/components/RichTextEditor/helpers/styles.ts");const h=t=>{const e={};return r()(l.b,n=>e[n]={isActive:!1,isEnabled:t}),e},g=Object(s.a)(t=>{const e=t.getCurrentContent(),n=t.getSelection();return{emote:{isActive:!1,isEnabled:Object(c.a)(e,n)},link:{isActive:!1,isEnabled:Object(a.e)(e,n)},blocks:(t=>{const e=t.getCurrentContent(),n=t.getSelection();let o=h(!0),i=null;if(n.isCollapsed())i=e.getBlockForKey(n.getEndKey()).getType();else{let t=null;Object(u.a)(e,n,(e,n)=>{const r=e.getType();return Object(l.t)(r)?(o=h(!1),!1):(null===t&&(t=r),t!==r?(t=null,!1):void 0)}),i=t}return null!==i&&((Object(l.v)(i)||Object(l.t)(i))&&r()(o,t=>{t.isEnabled=!1}),o[i].isActive=!0),o})(t),styles:(t=>{const e=t.getCurrentContent(),n=t.getSelection(),o={};r()(l.k,t=>o[t]={isActive:!1,isEnabled:!1});const s=new Set(Object.keys(o));if(s.delete(l.k.HIGHLIGHT),n.isCollapsed()){const r=e.getBlockForKey(n.getEndKey()),i=r.getType();Object(l.q)(i)||Object(l.r)(i)||Object(l.t)(i)||s.forEach(t=>o[t].isEnabled=!0),t.getCurrentInlineStyle().forEach(t=>{t&&o[t]&&(o[t].isActive=!0)}),Object(d.i)(r)&&(o[l.k.BOLD]={isEnabled:!1,isActive:!1})}else Object(p.e)(e,n).forEach(t=>{s.delete(t),o[t]&&(o[t].isActive=!0,o[t].isEnabled=!0)}),Object(u.a)(e,n,(t,r)=>{if(!s.size)return!1;const c=n.getStartKey()===r?n.getStartOffset():0,a=n.getEndKey()===r?n.getEndOffset():t.getLength(),d=t.getType(),u=t.getCharacterList();Object(l.q)(d)||Object(l.r)(d)||Object(l.t)(d)||Object(i.a)(u,{start:c,end:a},(n,r,i,c)=>{const a=n.getStyle(),l=n.getEntity(),d=l?e.getEntity(l):null;if(s.forEach(e=>{const n=!o[e].isActive,r=Object(p.f)(a,t,d,e,n);r&&r!==a&&(o[e].isEnabled=!0,s.delete(e))}),!s.size)return!1})});return o})(t)}}),m=t=>{r()(t.blocks,t=>{t.isEnabled=!1}),r()(t.styles,t=>{t.isEnabled=!1}),t.link.isEnabled=!1}},"./src/reddit/components/RichTextEditor/helpers/forEachBlock.ts":function(t,e,n){"use strict";function o(t,e,n){const o=e.getStartKey(),r=e.getEndKey();if(o===r)return void n(t.getBlockForKey(o),o);let i=!1;t.getBlockMap().forEach((t,e)=>{if(e===o&&(i=!0),!i||!t||!e)return;const s=n(t,e);return e!==r&&s})}n.d(e,"a",function(){return o})},"./src/reddit/components/RichTextEditor/helpers/modifiers.ts":function(t,e,n){"use strict";var o=n("./node_modules/draft-js/lib/Draft.js"),r=n("./src/reddit/components/RichTextEditor/entity/cloneEntitiesInFragment.ts"),i=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],o=!0,r=!1,i=void 0;try{for(var s,c=t[Symbol.iterator]();!(o=(s=c.next()).done)&&(n.push(s.value),!e||n.length!==e);o=!0);}catch(a){r=!0,i=a}finally{try{!o&&c.return&&c.return()}finally{if(r)throw i}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();function s(t,e){const n=e.getStartKey();if(n!==e.getEndKey())return;const o=t.getBlockForKey(n),s=e.getStartOffset(),c=e.getEndOffset(),a=s>0?o.getEntityAt(s-1):null,l=o.getEntityAt(c);if(!a||!l||a!==l)return;const d=t.getEntity(l),u=o.getCharacterList().toSeq().skip(c).takeWhile(t=>!!t&&t.getEntity()===l).count();var p=Object(r.a)(t,o,d,c,c+u),h=i(p,2);const g=h[0],m=h[1];return g.merge({blockMap:g.getBlockMap().set(o.getKey(),m)})}function c(t,e,n){const r=s(t,e)||t;return o.Modifier.replaceWithFragment(r,e,n)}function a(t,e,n,r,i){let c=t;return-1!==n.indexOf("\n")&&(c=s(t,e)||c),o.Modifier.replaceText(c,e,n,r,i)}function l(t,e,n,r,i){let c=t;return-1!==n.indexOf("\n")&&(c=s(t,e)||c),o.Modifier.insertText(c,e,n,r,i)}function d(t,e){const n=s(t,e)||t;return o.Modifier.splitBlock(n,e)}n.d(e,"c",function(){return c}),n.d(e,"b",function(){return a}),n.d(e,"a",function(){return l}),n.d(e,"d",function(){return d})},"./src/reddit/components/RichTextEditor/helpers/sliceContiguousBlocks.ts":function(t,e,n){"use strict";var o=n("./node_modules/lodash/forEach.js"),r=n.n(o);e.a=((t,e)=>{const n=t.getBlocksAsArray(),o=e.getKey(),i=e.getType();let s=null,c=null,a=!1;if(r()(n,(t,e)=>{if(a||t.getKey()!==o||(a=!0),t.getType()===i)null===s&&(s=e),c=e;else{if(a)return!1;s=null,c=null}}),a)return c=c||0,{start:s=s||0,blocks:n.slice(s,c+1)}})},"./src/reddit/components/RichTextEditor/helpers/styles.ts":function(t,e,n){"use strict";n.d(e,"f",function(){return u}),n.d(e,"e",function(){return p}),n.d(e,"b",function(){return h}),n.d(e,"a",function(){return g}),n.d(e,"c",function(){return m}),n.d(e,"d",function(){return f});var o=n("./node_modules/draft-js/lib/Draft.js"),r=n("./node_modules/immutable/dist/immutable.js"),i=n("./src/lib/forEachGroup/index.ts"),s=n("./src/reddit/components/RichTextEditor/entity/entityTypes.ts"),c=n("./src/reddit/components/RichTextEditor/styleAndBlockTypes.ts"),a=n("./src/reddit/components/RichTextEditor/table/helpers.ts"),l=n("./src/reddit/components/RichTextEditor/helpers/forEachBlock.ts");const d=Object(r.OrderedSet)([]),u=(t,e,n,o,i=!0)=>{const l=e.getType();if(Object(c.q)(l)||Object(c.r)(l)||Object(c.t)(l))return;if(o===c.k.BOLD&&Object(a.i)(e))return;const u=n?n.getType():null;return(u===s.a.SUBREDDIT_LINK||u===s.a.USER_LINK)&&o!==c.k.SPOILER&&o!==c.k.MONOSPACE||u===s.a.EMOTE?void 0:o===c.k.MONOSPACE||o===c.k.SPOILER?i?Object(r.OrderedSet)([o]):d:(t.has(c.k.MONOSPACE)||t.has(c.k.SPOILER))&&i?Object(r.OrderedSet)([o]):!i||o!==c.k.SUPERSCRIPT&&o!==c.k.SUBSCRIPT?i?t.add(o):t.has(o)?t.delete(o):void 0:t.delete(c.k.SUBSCRIPT).delete(c.k.SUPERSCRIPT).add(o)},p=(t,e)=>{let n=null,o=!0;return Object(l.a)(t,e,(r,l)=>{const d=r.getType(),u=Object(a.i)(r);if(u||(o=!1),Object(c.q)(d)||Object(c.r)(d)||Object(c.t)(d))return!1;const p=e.getStartKey()===l?e.getStartOffset():0,h=e.getEndKey()===l?e.getEndOffset():r.getLength(),g=r.getCharacterList();Object(i.a)(g,{start:p,end:h},e=>{const o=e.getEntity();if(o&&t.getEntity(o).getType()===s.a.SUBREDDIT_LINK)return;let r=e.getStyle();return u&&(r=r.add(c.k.BOLD)),null===n?n=r.asMutable():n.intersect(r),!(n&&!n.size)&&void 0})}),null===n?[]:(o&&n.delete(c.k.BOLD),n.toJS())},h=(t,e)=>{const n=e.getCurrentContent(),r=e.getSelection();let s=n.getBlockMap();const a=-1===p(n,r).indexOf(t);Object(l.a)(n,r,(e,l)=>{if(!e||!l)return!1;const d=r.getStartKey()===l?r.getStartOffset():0,p=r.getEndKey()===l?r.getEndOffset():e.getLength(),h=e.getCharacterList(),g=h.withMutations(r=>{Object(i.a)(h,{start:d,end:p},(i,s,l,d)=>{const p=i.getStyle(),h=i.getEntity(),g=h?n.getEntity(h):null,m=u(p,e,g,t,a);if(m){const t=((t,e)=>o.CharacterMetadata.create({style:e,entity:e.has(c.k.SPOILER)?null:t.getEntity()}))(i,m);for(let e=l;e<d;e++)r.set(e,t)}})});if(g!==h){const t=e.set("characterList",g);s=s.set(l,t)}});const d=n.merge({blockMap:s,selectionAfter:r});return o.EditorState.push(e,d,"change-inline-style")},g=(t,e)=>{const n=e.getCurrentContent(),r=e.getSelection(),i=n.getBlockForKey(r.getStartKey()),s=i.getEntityAt(r.getStartOffset()),c=s?n.getEntity(s):null,a=e.getCurrentInlineStyle(),l=u(a,i,c,t,!a.has(t));let d=e;return l&&(d=o.EditorState.setInlineStyleOverride(d,l)),d},m=t=>o.EditorState.setInlineStyleOverride(t,d),f=(t,e)=>{const n=t.getSelection(),o=e.getSelection();return n.getStartOffset()>0||n.getFocusKey()===o.getFocusKey()||t.getCurrentInlineStyle().isEmpty()?t:m(t)}},"./src/reddit/components/RichTextEditor/index.tsx":function(t,e,n){"use strict";var o=n("./node_modules/draft-js/lib/Draft.js"),r=(n("./node_modules/draft-js/dist/Draft.css"),n("./node_modules/lodash/filter.js")),i=n.n(r),s=n("./node_modules/react/index.js"),c=n.n(s),a=n("./node_modules/react-redux/es/index.js"),l=n("./node_modules/reselect/es/index.js"),d=n("./node_modules/shallowequal/index.js"),u=n.n(d),p=n("./bundled-modules/styled-components/styled-components.min.js"),h=n.n(p),g=n("./src/lib/fastdom/index.ts"),m=n("./src/lib/logs/console.ts"),f=n("./src/telemetry/models/Media.ts"),b=n("./src/reddit/actions/economics/subredditPremium/thunkedActions.ts"),y=n("./src/reddit/actions/postCreation/mediaUpload.ts"),E=n("./src/reddit/featureFlags/index.ts"),O=n("./src/reddit/helpers/styles/mixins/fonts.tsx"),x=n("./src/reddit/helpers/trackers/postComposer.ts"),S=n("./src/reddit/i18n/utils.ts"),C=n("./src/reddit/models/PostCreationForm/index.ts"),v=n("./src/reddit/models/Upload/index.ts"),k=n("./src/reddit/components/RichTextEditor/styleAndBlockTypes.ts");const j={BREAK_HEADER_ENTITY:"BREAK_HEADER_ENTITY",CONVERT_TO_LIST_ON_SPACE:"CONVERT_TO_LIST_ON_SPACE",EXEC_TABLE_ON_ENTER_HANDLER:"EXEC_TABLE_ON_ENTER_HANDLER",INSERT_LINE_BREAK:"INSERT_LINE_BREAK",LINKIFY_ON_ENTER:"LINKIFY_ON_ENTER",LINKIFY_ON_SPACE:"LINKIFY_ON_SPACE",MAKE_PLAIN_BLOCK:"MAKE_PLAIN_BLOCK",OPEN_LINK_TOOLTIP:"OPEN_LINK_TOOLTIP",REDUCE_LIST_INDENT:"REDUCE_LIST_INDENT",REMOVE_EXTRA_LIST_ITEM:"REMOVE_EXTRA_LIST_ITEM",RESET_CURRENT_AND_PREVIOUS_BLOCKS:"RESET_CURRENT_AND_PREVIOUS_BLOCKS",SUBMIT:"SUBMIT"};const w=t=>{const e=t.getCurrentContent().getBlockMap();if(e.size>2||(t=>!!t.reduce((t=0,e)=>t+e.getLength(),0))(e)||(t=>!!t.find(t=>Object(k.o)(t.getType())))(e))return null;{const n=t.getSelection();if(n.isCollapsed()&&n.getFocusKey()===e.first().getKey())return n.getFocusKey()}},T=t=>{const e=t.getCharacterList().map(t=>o.CharacterMetadata.create({entity:t.getEntity()}));return t.set("characterList",e)};var I=n("./src/reddit/components/ConfirmUserActionModal/index.tsx"),R=n("./src/reddit/components/RichTextEditor/constants/draftEditorCommands.ts"),A=n("./node_modules/lodash/escape.js"),B=n.n(A),K=n("./src/reddit/components/RichTextEditor/media/helpers.ts"),M=n("./src/reddit/components/RichTextEditor/helpers/common.ts"),L=n("./src/reddit/components/RichTextEditor/entity/entityTypes.ts"),D=n("./node_modules/immutable/dist/immutable.js"),N=n("./src/reddit/helpers/dom/index.ts"),F=n("./node_modules/lodash/chunk.js"),P=n.n(F),_=n("./node_modules/lodash/flatten.js"),U=n.n(_),H=n("./node_modules/lodash/takeWhile.js"),z=n.n(H),V=n("./src/reddit/components/RichTextEditor/helpers/modifiers.ts"),W=n("./src/reddit/components/RichTextEditor/table/helpers.ts"),$=n("./node_modules/lodash/last.js"),q=n.n($),Z=n("./src/reddit/components/RichTextEditor/constants/editorChangeTypes.ts"),G=n("./src/reddit/components/RichTextEditor/helpers/forEachBlock.ts"),Y=n("./node_modules/lodash/find.js"),J=n.n(Y),X=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],o=!0,r=!1,i=void 0;try{for(var s,c=t[Symbol.iterator]();!(o=(s=c.next()).done)&&(n.push(s.value),!e||n.length!==e);o=!0);}catch(a){r=!0,i=a}finally{try{!o&&c.return&&c.return()}finally{if(r)throw i}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();var Q=(t,e)=>{const n=t.getSelection(),r=t.getCurrentContent(),i=r.getBlockForKey(n.getAnchorKey()),s=r.getBlockForKey(n.getFocusKey());var c=Object(W.e)(r,i,s),a=X(c,2);const l=a[0],d=a[1];if(!l||l!==d)return t;const u=Object(W.g)(i),p=Object(W.g)(s),h=l.blocks,g=l.start,m=p.colCount,f=h.length/m;var b=Object(W.f)(u,p);const y=b.minCol,E=b.minRow,O=b.maxCol,x=b.maxRow,S=h.filter(t=>{var n=Object(W.g)(t);const o=n.rowIndex,r=n.colIndex;return"rows"===e?!(E<=o&&o<=x):!(y<=r&&r<=O)});S.sort(W.b);const C="rows"===e?m:S.length/f,v=U()(Object(W.d)(P()(S,C))),k=r.getBlocksAsArray(),j=[...k.slice(0,g),...v,...k.slice(g+h.length)],w=r.merge({blockMap:o.BlockMapBuilder.createFromArray(j)}),T={colIndex:y,rowIndex:E};let I=J()(v,t=>Object(W.h)(T,Object(W.g)(t)));I||(I=v.length?v[v.length-1]:k[g>0?g-1:0]);const R=o.SelectionState.createEmpty(I.getKey()).merge({focusOffset:I.getLength(),anchorOffset:I.getLength()});let A=o.EditorState.push(t,w,Z.d);return A=o.EditorState.forceSelection(A,R)},tt=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],o=!0,r=!1,i=void 0;try{for(var s,c=t[Symbol.iterator]();!(o=(s=c.next()).done)&&(n.push(s.value),!e||n.length!==e);o=!0);}catch(a){r=!0,i=a}finally{try{!o&&c.return&&c.return()}finally{if(r)throw i}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();var et=(t,e=!1)=>{const n=t.getSelection();if(n.isCollapsed())return;if(n.getStartKey()===n.getEndKey()&&!e)return;const r=t.getCurrentContent(),i=r.getBlockForKey(n.getAnchorKey()),s=r.getBlockForKey(n.getFocusKey());var c=Object(W.e)(r,i,s),a=tt(c,2);const l=a[0],d=a[1];if(!l||l!==d)return;const u={};let p=n;if(i===s){const t=Object(W.n)(s,0,n.getStartOffset()),e=Object(W.n)(s,n.getEndOffset());u[s.getKey()]=Object(W.j)(s,[t,e]),p=n}else{if(l.blocks[0].getKey()===n.getStartKey()&&q()(l.blocks).getKey()===n.getEndKey())return Q(t,"rows");Object(G.a)(r,n,(t,e)=>{u[e]=Object(W.n)(t,0,0)}),p=n.merge({anchorOffset:0,focusOffset:0})}const h=r.merge({blockMap:r.getBlockMap().merge(u),selectionAfter:p});return o.EditorState.push(t,h,Z.e)},nt=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],o=!0,r=!1,i=void 0;try{for(var s,c=t[Symbol.iterator]();!(o=(s=c.next()).done)&&(n.push(s.value),!e||n.length!==e);o=!0);}catch(a){r=!0,i=a}finally{try{!o&&c.return&&c.return()}finally{if(r)throw i}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();const ot=(t,e,n,o)=>{const r=e.htmlParts;t.forEach((t,i)=>{r.push(`<${n} ${o[i]} style="margin: 0px; padding: 4px 9px; border: 1px solid rgb(229, 227, 218);">`),Ot(t,e),r.push(`</${n}>`)})},rt=(t,e)=>{const n=e.editor,o=e.htmlParts,r=n.getEditorKey(),i=t[0].map(t=>{const e=Object(W.g)(t).alignment;return e?`align="${W.a[e]}"`:""});var s=function(t){return Array.isArray(t)?t:Array.from(t)}(t);const c=s[0],a=s.slice(1);o.push(`\n    <table data-editor="${r}">\n      <thead>\n        <tr>`),ot(c,e,"th",i),o.push("\n        </tr>\n      </thead>\n      <tbody>"),a.forEach(t=>{o.push("\n        <tr>"),ot(t,e,"td",i),o.push("\n        </tr>")}),o.push("\n      </tbody>\n    </table>")},it=t=>{const e=t[0],n=t[t.length-1],o=[...t].sort(W.b);var r=Object(W.f)(Object(W.g)(e),Object(W.g)(n));const i=r.minCol,s=r.maxCol-i+1;return Object(W.d)(P()(o,s))},st=(t,e,n)=>{n?e.textParts.push(Ct(t[0],e)):((t,e)=>{const n=e.textParts;t.forEach(t=>{n.push(t.map(t=>Ct(t,e)).join(" "))})})(it(t),e)},ct=t=>{const e=t.processed,n=t.remaining,o=[];for(;n.length;){const t=n[0];if(!Object(k.v)(t.getType()))break;o.push(n.shift())}const r=!n.length&&!e.length,i=1===o.length&&r;((t,e,n)=>{n?Ot(t[0],e):rt(it(t),e)})(o,t,i),st(o,t,i),((t,e,n,o)=>{if(n)if(o){const n=t[0].merge({data:Object(D.Map)(),type:k.n});e.blocksParts=[n]}else e.blocksParts=U()(it(t))})(o,t,r,i),e.push(...o)},at=t=>et(t,!0),lt=(t,e,n)=>{const r=Object(k.v)(n.first().getType()),i=Object(k.v)(n.last().getType()),s=t.getBlockForKey(e.getAnchorKey()),c=t.getBlockForKey(e.getFocusKey());var a=Object(W.e)(t,s,c),l=nt(a,2);const d=l[0],u=l[1];return d&&d===u?((t,e,n,r)=>{const i=Object(k.v)(r.first().getType()),s=t.getBlockForKey(e.getAnchorKey()),c=t.getBlockForKey(e.getFocusKey()),a=n.blocks,l=n.start;a.sort(W.b);let d=Object(W.g)(a[0]).colCount;const u=P()(a,d);let p=u.length;var h=Object(W.f)(Object(W.g)(s),Object(W.g)(c));const g=h.minRow,m=h.minCol,f=r.toArray();if(i){const n=z()(f,t=>Object(k.v)(t.getType()));n.sort(W.b);const r=Object(W.g)(n[0]).colCount,i=P()(n,r),s=i.length,c=g+s-1,h=m+r-1;if(n.length!==s*r)throw new Error("Invalid table fragment!");if(h>=d&&u.forEach(t=>{t.push(...Object(W.l)(h-d+1,1))}),d=u[0].length,c>=p){const t=P()(Object(W.l)(d,c-p+1),d);u.push(...t)}p=u.length;for(let t=0;t<s;t++)for(let e=0;e<r;e++){const n=g+t,o=m+e,r=i[t][e];u[n][o]=r.set("key",u[n][o].getKey())}const b=Object(W.d)(u),y=U()(b),E=t.getBlocksAsArray(),O=[...E.slice(0,l),...y,...E.slice(l+a.length)],x=Object(W.o)(e,u[g][m],u[c][h]);return t.merge({blockMap:o.BlockMapBuilder.createFromArray(O),selectionAfter:x})}{const n=u[g][m],r=Object(W.j)(n,f," ");let i=e;return e.getStartKey()!==e.getEndKey()&&(i=Object(W.o)(e,n,n)),V.c(t,i,o.BlockMapBuilder.createFromArray([r]))}})(t,e,d,n):d||u||!r&&!i?void 0:((t,e,n)=>{const r=Object(k.v)(n.first().getType()),i=Object(k.v)(n.last().getType()),s=n.toArray();r&&s.unshift(Object(M.g)()),i&&s.push(Object(M.g)());const c=o.BlockMapBuilder.createFromArray(s);return V.c(t,e,c)})(t,e,n)};var dt=n("./node_modules/draft-js/lib/removeEntitiesAtEdges.js"),ut=n.n(dt);var pt=(t,e)=>{const n=e.getStartKey(),o=e.getStartOffset(),r=e.getEndKey(),i=e.getEndOffset(),s=ut()(t,e).getBlockMap(),c=s.keySeq(),a=c.indexOf(n),l=c.indexOf(r)+1;return s.slice(a,l).map((t,e)=>{const s=t.getText(),c=t.getCharacterList();return n===r?t.merge({text:s.slice(o,i),characterList:c.slice(o,i)}):e===n?t.merge({text:s.slice(o),characterList:c.slice(o)}):e===r?t.merge({text:s.slice(0,i),characterList:c.slice(0,i)}):t})};const ht=(t,e)=>{const n={children:[],parentItem:e,type:t.getType()},o={block:t,parentList:n};return n.children.push(o),e&&(e.childrenLists=e.childrenLists||[],e.childrenLists.push(n)),{list:n,item:o}},gt=(t,e)=>{const n=t.type,o=t.children,r=e.htmlParts,i=n===k.b.ORDERED_LIST?"ol":"ul";r.push(`<${i}>`),o.forEach(t=>((t,e)=>{const n=t.block,o=t.childrenLists,r=e.htmlParts;r.push("<li>"),Ot(n,e,!0),o&&o.forEach(t=>gt(t,e)),r.push("</li>")})(t,e)),r.push(`</${i}>`)},mt=(t,e)=>{t.children.forEach((t,n)=>ft(t,n,e))},ft=(t,e,n)=>{const o=t.block,r=t.childrenLists,i=n.textParts,s=" ".repeat(o.getDepth()),c=o.getType()===k.b.ORDERED_LIST?`${e+1}.`:"-",a=Ct(o,n);i.push(`${s}${c} ${a}`),r&&r.forEach(t=>mt(t,n))},bt=t=>{const e=t.remaining,n=e.shift(),o=n.getType(),r=[n];for(;e.length;){const t=e[0],n=t.getType();if(!Object(k.s)(n))break;if(t.getDepth()>0||n===k.b.UNORDERED_LIST)r.push(e.shift());else{if(n!==o)break;if(r.some(t=>t.getType()!==k.b.ORDERED_LIST))break;r.push(e.shift())}}const i=(t=>{const e=t[0],n={type:e.getType(),children:[]};let o,r=n,i=e.getDepth();return t.forEach(t=>{const e=t.getType(),n=t.getDepth();if(n>i){const e=ht(t,o);r=e.list,o=e.item,i=n}else{for(;i!==n;)r=r.parentItem?r.parentItem.parentList:r,i--;if(e===r.type)o={block:t,parentList:r},r.children.push(o);else{const e=ht(t,r.parentItem);r=e.list,o=e.item}}}),n})(r);gt(i,t),mt(i,t),t.processed.push(...r)};var yt=(t,e)=>{const n=t.toArray().filter(t=>!Object(k.t)(t.getType()));1===n.length&&n[0].getType()!==k.n&&n.push(new o.ContentBlock({key:Object(o.genKey)(),type:k.n}));const r=o.ContentState.createFromBlockArray(n),i=JSON.stringify(Object(o.convertToRaw)(r));return`<div data-reddit-rtjson="${B()(i)}">${e}</div>`};const Et=()=>!!window.clipboardData,Ot=(t,e,n=!1)=>{const o=e.htmlParts,r=xt(t,e);r&&r.forEach(t=>o.push(n?t.innerHTML:t.outerHTML))},xt=(t,e)=>{const n=e.selection,o=e.editor,r=n.getStartKey(),i=n.getEndKey(),s=t.getKey(),c=o.refs.editor,a=Object(M.d)(s,c);return a?s===r||s===i?Object(N.c)(a):[a]:null};var St=(t,e,n)=>{const r=t.getCurrentContent(),i=t.getSelection(),s=It(t)||pt(r,i);if(!s||!s.count())return;const c=s.toArray(),a={editor:e,editorState:t,selection:i,remaining:c,processed:[],htmlParts:[],textParts:[],blocksParts:[...c]};for(;a.remaining.length;){const t=a.remaining[0].getType();switch(!0){case Object(k.t)(t):Tt(a);break;case Object(k.s)(t):bt(a);break;case Object(k.v)(t):ct(a);break;default:vt(a)}}const l=a.textParts.join("\n"),d=(t=>Object(D.OrderedMap)(t.map(t=>{const e=Object(o.genKey)();return[e,t.set("key",e)]})))(a.blocksParts);return((t,{html:e,text:n})=>{Et()?window.clipboardData.setData("text",n):(e&&t.clipboardData.setData("text/html",e),t.clipboardData.setData("text/plain",n))})(n,{html:yt(d,a.htmlParts.join("")),text:l}),n.stopPropagation(),n.preventDefault(),e.setClipboard(d),d};const Ct=(t,e)=>{const n=t.getText(),o=e.editorState.getCurrentContent(),r=[];let i=-1;return t.getCharacterList().forEach((t,e)=>{const s=t&&t.getEntity();if(s&&void 0!==e){const t=o.getEntity(s);t.getType()===L.a.EMOTE&&(r.push(n.substring(i+1,e)),r.push(`:${t.getData().id}:`),i=e)}}),r.push(n.substring(i+1,n.length)),r.join("")},vt=t=>{const e=t.remaining.shift();((t,e)=>Ot(t,e))(e,t),((t,e)=>{e.textParts.push(Ct(t,e))})(e,t),t.processed.push(e)},kt=t=>{const e=t.first(),n=t.last();let r=t;if(Object(k.u)(e.getType())?r=r.set(r.keySeq().first(),e.merge({type:k.n})):Object(k.o)(e.getType())&&(r=o.BlockMapBuilder.createFromArray([Object(M.g)(),...r.toArray()])),Object(k.u)(n.getType())){const t=Object(M.g)();r=r.set(t.getKey(),t)}else if(Object(k.o)(n.getType())){const t=Object(M.g)().merge({type:k.j});r=r.set(t.getKey(),t)}return r},jt=(t,e,n)=>{const o=t.getBlockForKey(e.getStartKey());if(Object(k.u)(o.getType())){const o=n.first(),r=n.set(n.keySeq().first(),Object(M.g)(o.getKey(),o.getText()).merge({type:k.j}));return V.c(t,e,r)}},wt=(t,e,n)=>{const o=((t,e,n)=>{const o=e.getText();return`<span data-editor="${n}">${B()(o)}</span>`})(0,e,n.editor.getEditorKey());n.htmlParts.push(o)},Tt=t=>{const e=t.remaining,n=e.shift(),o=e.shift();wt(0,o,t),((t,e)=>{const n=Ct(t,e);e.textParts.push(n)})(o,t),t.processed.push(n,o)},It=t=>{const e=t.getSelection(),n=e.getFocusKey();if(n!==e.getAnchorKey())return;const r=t.getCurrentContent(),i=r.getBlockForKey(n);if(Object(k.o)(i.getType())){const t=r.getBlockAfter(i.getKey());return o.ContentState.createFromBlockArray([i,t]).getBlockMap()}},Rt=t=>{const e=It(t);if(e)return Object(K.c)(t,e.first().getKey())},At=t=>{const e=t.getSelection();let n=t.getCurrentContent();const r=n.getBlockForKey(e.getStartKey()),i=n.getBlockForKey(e.getEndKey());if(Object(k.t)(r.getType())||Object(k.t)(i.getType())){if(e.isCollapsed())if(Object(k.u)(r.getType()))n=V.d(n,e),n=o.Modifier.setBlockType(n,n.getSelectionAfter(),k.n);else if(Object(k.o)(r.getType())){const r=n.getBlockAfter(e.getStartKey());return o.EditorState.forceSelection(t,Object(M.b)(r,!0))}return o.EditorState.push(t,n,"split-block")}},Bt=(t,e)=>{const n=t.getSelection(),r=t.getCurrentContent(),i="up"===e?n.getStartKey():n.getEndKey(),s=r.getBlockForKey(i);if(!Object(k.o)(s.getType()))return;const c="up"===e?r.getBlockBefore(i):r.getBlockAfter(i);return c?o.EditorState.forceSelection(t,Object(M.b)(c,!0)):Object(K.b)(t,i,"up"===e?M.a.before:M.a.after)},Kt=(t,e)=>{if(t.shiftKey)return;const n=Bt(e,"up");return n&&t.preventDefault(),n},Mt=(t,e)=>{if(t.shiftKey)return;const n=Bt(e,"down");return n&&t.preventDefault(),n},Lt=(t,e)=>{const n=t.getSelection();return n.isCollapsed()&&0===n.getStartOffset()&&Object(k.o)(t.getCurrentContent().getBlockForKey(n.getStartKey()).getType())};var Dt=t=>{const e=t.getSelection(),n=t.getCurrentContent(),o=n.getBlockForKey(e.getStartKey());if(Object(k.o)(o.getType())){const e=n.getBlockAfter(o.getKey());if(!e||!Object(k.u)(e.getType()))return Object(K.c)(t,o.getKey(),!1)}return t},Nt=n("./src/reddit/actions/modal.ts"),Ft=n("./src/reddit/actions/upload.ts"),Pt=n("./src/reddit/components/ThumbnailSelector/index.tsx"),_t=t=>null,Ut=n("./src/reddit/helpers/media/index.ts"),Ht=n("./src/reddit/selectors/activeModalId.ts"),zt=n("./src/reddit/selectors/user.ts");const Vt="application/x-reddit-rte-block";var Wt=n("./src/reddit/models/Theme/NewColorSystem/index.ts");const $t=h.a.img.withConfig({componentId:"gi3mtk-0"})(["align-self: center;z-index: 0;max-width: 100%;border-radius: 4px;"]);var qt=h()(t=>{const e=t.className,n=t.url;return c.a.createElement("div",{className:e},c.a.createElement($t,{draggable:!1,src:n}))}).withConfig({componentId:"gi3mtk-1"})(["display: flex;justify-content: center;position: relative;overflow: hidden;flex-grow: 0;border-radius: 4px;user-select: all;"]),Zt=n("./src/app/strings/index.ts");const Gt=Object(Zt.e)("postCreation.processingVideo"),Yt=Object(Zt.e)("postCreation.processingImage"),Jt=h.a.div.withConfig({componentId:"s1tmbes5-0"})(["position: absolute;left: 12px;bottom: 6px;"]);var Xt=h()(t=>{const e=t.className,n=t.isImage,o=t.language;return c.a.createElement("div",{className:e},c.a.createElement(Jt,null,(n?Yt:Gt)(o)))}).withConfig({componentId:"s1tmbes5-1"})(["display: flex;flex-grow: 1;justify-content: center;overflow: hidden;border-radius: 4px;position: relative;background: ",";&:after {display: block;content: '';padding-top: ","%;height: 0;}"],t=>Object(Wt.c)(t).body,56.25),Qt=n("./node_modules/polished/dist/polished.es.js"),te=n("./src/lib/formatApiError/index.ts"),ee=n("./src/reddit/components/ProgressBar/index.tsx"),ne=n("./src/reddit/constants/colors.ts"),oe=n("./src/reddit/controls/Button/index.tsx"),re=n("./src/reddit/helpers/styles/components/index.tsx");const ie=Object(Zt.e)("postCreation.cancel"),se=Object(Zt.e)("postCreation.retry"),ce=Object(Zt.e)("postCreation.remove"),ae=Object(Zt.e)("postCreation.uploadStatus.uploadCanceled"),le=Object(Zt.e)("postCreation.uploadStatus.uploadFailed"),de=Object(Zt.e)("postCreation.uploadStatus.success"),ue=Object(Zt.e)("postCreation.uploadStatus.uploading"),pe=h.a.div.withConfig({componentId:"s4beoze-0"})(["width: 100%;display: flex;align-items: center;justify-content: space-between;padding-top: 10px;font-size: 13px;"]),he="\n  padding: 1px 0;\n  margin-left: 8px;\n  line-height: 13px;\n",ge=t=>`\n  color: ${t};\n  &[disabled] {\n    color: ${t};\n  }\n  &:hover {\n    color: ${Object(Qt.g)(t,.7)};\n  }\n`,me=h()(oe.n).withConfig({componentId:"s4beoze-1"})(["","",""],he,t=>ge(ne.a.black)),fe=h()(oe.n).withConfig({componentId:"s4beoze-2"})(["","",""],he,t=>ge(ne.a.warning)),be=h.a.div.withConfig({componentId:"s4beoze-3"})([""]),ye=h()(Object(re.a)()).withConfig({componentId:"s4beoze-4"})(["color: ",";flex: 1;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;"],t=>t.haveError?"#f00":"#000"),Ee=h()(ee.b).withConfig({componentId:"s4beoze-5"})(["background: rgba(0, 0, 0, .2);"," {background: #000;}"],ee.a),Oe=h.a.div.withConfig({componentId:"s4beoze-6"})(["height: 2px;background: #f00;"]),xe=t=>e=>{e.stopPropagation(),t(e)};var Se=h()(t=>{const e=t.language,n=t.upload,o=xe(t.onCancel),r=xe(t.onRetry),i=xe(t.onRemove),s=n.status,a=n.progress,l=a&&a.percent||0,d=s===v.a.FAILED||s===v.a.CANCELED,u=((t,e)=>{const n=t.status,o=t.progress;return n===v.a.CANCELED?ae(e):n===v.a.FAILED?`${le(e)}: ${Object(te.a)(e,t.error)} `:100===(o&&o.percent||0)?de(e):`${ue(e)}: "${t.file.name}"`})(n,e);return c.a.createElement("div",{className:t.className},d?c.a.createElement(Oe,null):c.a.createElement(Ee,{percent:l}),c.a.createElement(pe,null,c.a.createElement(ye,{haveError:d,title:d?u:void 0},u),c.a.createElement(be,null,d?[c.a.createElement(fe,{key:"remove",onClick:i},ce(e)),c.a.createElement(fe,{key:"retry",onClick:r},se(e))]:c.a.createElement(me,{disabled:100===l,onClick:o},ie(e)))))}).withConfig({componentId:"s4beoze-7"})(["height: 64px;box-sizing: border-box;padding: 25px 15px 16px;border-radius: 0 0 4px 4px;background: ",";"],t=>Object(Wt.c)(t).body),Ce=n("./node_modules/react-motion/lib/react-motion.js"),ve=n("./src/reddit/components/HTML5StreamPlayer/index.tsx"),ke=n("./src/reddit/components/PlayButton/index.tsx");const je={stiffness:60,damping:20},we=[{key:"video",style:{opacity:Object(Ce.spring)(1,je)}}],Te="\n  position: absolute;\n  top: 0;\n  bottom: 0;\n  left: 0;\n  right: 0;\n",Ie=h()(t=>{var e=t.autoPlay;const n=void 0!==e&&e,o=t.className,r=t.showControls,i=t.shouldPause,s=t.style,a=t.dashUrl,l=t.hlsUrl,d=t.otherUrl;return c.a.createElement("div",{className:o,style:s},c.a.createElement(ve.b,{autoPlay:n,shouldIgnoreAutoplayPref:!0,shouldLoad:!1,shouldPause:i,isGif:!1,hlsSource:l,mpegDashSource:a,otherSource:d,showSettingsIcon:!1,showControlBar:r,playerClickPlay:!1,hideUntilLoaded:!0}))}).withConfig({componentId:"lyxchp-0"})(["z-index: 1;",""],Te),Re=h.a.img.withConfig({componentId:"lyxchp-1"})(["width: 100%;height: 100%;object-fit: contain;"]),Ae=h()(t=>{const e=t.className,n=t.onPlayButtonClick,o=t.url,r=t.showPlayButton;return c.a.createElement("div",{className:e},c.a.createElement(Re,{draggable:!1,src:o}),r&&c.a.createElement(ke.b,{onClick:n}))}).withConfig({componentId:"lyxchp-2"})(["z-index: 0;","background: #000;"],Te);var Be=h()(class extends c.a.Component{constructor(t){super(t),this.onPlayButtonClick=(()=>{this.setState({showVideo:!0})}),this.willEnter=(()=>({opacity:0})),this.willLeave=(()=>({opacity:Object(Ce.spring)(0,je)})),this.didLeave=(()=>{this.setState({showVideo:!1})}),this.state={showVideo:!1}}renderVideo(){const t=this.props;return c.a.createElement("div",{className:t.className},c.a.createElement(Ie,{dashUrl:t.dashUrl,hlsUrl:t.hlsUrl,showControls:t.isUploaded&&t.isSelected,shouldPause:!t.isSelected||void 0}))}render(){var t=this.props;const e=t.className,n=t.isSelected,o=t.posterUrl,r=t.dashUrl,i=t.hlsUrl,s=t.otherUrl;if(!o)return this.renderVideo();const a=this.state.showVideo,l=!!(r||i||s);return c.a.createElement(Ce.TransitionMotion,{defaultStyles:[],styles:n&&a&&l?we:[],willEnter:this.willEnter,willLeave:this.willLeave,didLeave:this.didLeave},t=>c.a.createElement("div",{className:e},t.map(t=>c.a.createElement(Ie,{key:t.key,autoPlay:!0,style:t.style,otherUrl:s,dashUrl:r,hlsUrl:i,showControls:!0,shouldPause:!n||void 0})),c.a.createElement(Ae,{url:o,showPlayButton:!a||!n,onPlayButtonClick:this.onPlayButtonClick})))}}).withConfig({componentId:"lyxchp-3"})(["flex-grow: 1;border-radius: 4px;overflow: hidden;position: relative;user-select: all;&:after {display: block;content: '';padding-top: ","%;height: 0;}"," {cursor: pointer;}"],56.25,ke.a),Ke=function(t,e){var n={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(n[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(t);r<o.length;r++)e.indexOf(o[r])<0&&(n[o[r]]=t[o[r]])}return n};const Me=h()(Se).withConfig({componentId:"zj0ael-0"})(["position: absolute;bottom: 0;left: 0;right: 0;z-index: 1;"]),Le=h()(t=>{t.compact,t.isUploaded,t.isSelected;var e=Ke(t,["compact","isUploaded","isSelected"]);return c.a.createElement("div",Object.assign({},e))}).withConfig({componentId:"zj0ael-1"})(["position: relative;background: ",";border-radius: 4px;display: flex;justify-content: center;overflow: visible;transition: background 1s, padding .3s 1s, box-shadow .1s;padding: ",";","",", ",", "," {transition: box-shadow .1s;","}&:hover {",", ",", "," {","}}"," {","","}"],t=>Object(Wt.c)(t).body,t=>t.compact?"15px 0 45px":"0",t=>t.isUploaded?"\n    background: transparent;\n    padding: 0;\n    box-shadow: none;\n  ":`\n    ${t.isSelected?`box-shadow: 0 0 0 4px ${Object(Wt.c)(t).button};`:`&:hover { box-shadow: 0 0 0 2px ${Object(Wt.c)(t).button}; }`}\n  `,qt,Be,Xt,t=>t.isUploaded&&t.isSelected?`box-shadow: 0 0 0 4px ${Object(Wt.c)(t).button};`:"",qt,Be,Xt,t=>t.isUploaded&&!t.isSelected?`box-shadow: 0 0 0 2px ${Object(Wt.c)(t).button};`:"",Me,t=>t.compact?" background: transparent;":"",t=>t.isUploaded?"\n      opacity: 0;\n      visibility: hidden;\n      transition: opacity 1s, visibility 0s 1s;\n    ":"");var De=t=>{const e=t.isSelected,n=t.onCancel,o=t.onRetry,r=t.onRemove,i=t.language,s=t.upload,a=t.mediaAsset,l=t.thumbnail,d=Ke(t,["isSelected","onCancel","onRetry","onRemove","language","upload","mediaAsset","thumbnail"]);let u=!1;if(s)u="image"===Object(Ut.f)(s.metadata.mimetype);else{if(!a)return null;u=a.type===K.a.Image||a.type===K.a.AnimatedImage}const p=s?s.metadata.height:a.height,h=!s||s.status===v.a.SUCCESS,g=u&&!!p&&p<104,m=!p;return c.a.createElement(Le,Object.assign({compact:g,isUploaded:h,isSelected:e},d),m?c.a.createElement(Xt,{isImage:u,language:i}):u?c.a.createElement(qt,{url:s?s.metadata.localUrl:a.imageUrl}):c.a.createElement(Be,{isSelected:e,isUploaded:h,dashUrl:a?a.dashUrl:void 0,hlsUrl:a?a.hlsUrl:void 0,otherUrl:s?s.metadata.localUrl:void 0,posterUrl:l?l.url:a.posterUrl}),s&&c.a.createElement(Me,{language:i,upload:s,onCancel:n,onRetry:o,onRemove:r}))},Ne=function(t,e){var n={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(n[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(t);r<o.length;r++)e.indexOf(o[r])<0&&(n[o[r]]=t[o[r]])}return n};const Fe=h.a.div.withConfig({componentId:"s3facf5-0"})(["width: 0px;margin-top: -1px;height: 1px;overflow: hidden;pointer-events: none;"]);var Pe=t=>{var e=t.elementRef,n=Ne(t,["elementRef"]);return c.a.createElement(Fe,Object.assign({},n,{innerRef:e}),c.a.createElement("br",null))},_e=n("./src/reddit/components/MakeGifToggle/index.tsx"),Ue=n("./src/reddit/icons/svgs/ThumbnailSelect/index.tsx"),He=n("./src/reddit/icons/svgs/Trash2/index.tsx"),ze=n("./src/reddit/layout/row/Inline/index.tsx"),Ve=n("./src/reddit/components/RichTextEditor/Toolbar/index.tsx"),We=n("./src/reddit/components/RichTextEditor/Toolbar/FormatterButton/index.tsx"),$e=n("./src/reddit/components/RichTextEditor/Toolbar/formatterConfigs.ts"),qe=n("./src/reddit/components/RichTextEditor/media/MediaBlock/Toolbar/index.m.less"),Ze=n.n(qe);const Ge=Object(Zt.e)("postCreation.remove"),Ye=Object(Zt.e)("postCreation.mediaInput.chooseThumbnail"),Je=h()(We.a).withConfig({componentId:"s14odxoh-0"})(["line-height: 0;padding: 3px;"]),Xe=Object($e.f)(He.b),Qe=Object($e.f)(Ue.a),tn=h()(ze.a).withConfig({componentId:"s14odxoh-1"})(["background-color: ",";box-shadow: 0 0 0 1px ",",0 1px 10px ",";"],t=>Object(Wt.c)(t).field,t=>Object(Wt.c)(t).line,t=>Object(Wt.c)(t).line);var en=t=>{const e=t.block,n=t.editorState,o=t.language,r=t.onChange,i=t.showVideoControls,s=e.getKey();var a=(Object(K.g)(e)||{}).makeGif;const l=void 0!==a&&a;return c.a.createElement("div",{className:Ze.a.container},c.a.createElement(tn,{className:Ze.a.content},i&&c.a.createElement(_e.a,{key:"make-gif",on:l,language:o,onClick:()=>r(Object(K.o)(n,s,{makeGif:!l})),toggleWidth:24}),i&&t.showThumbnailButton&&c.a.createElement(Je,{Icon:Qe,onClick:t.onThumbnailButtonClick,tooltip:Ye(o)}),i&&c.a.createElement(Ve.c,null),c.a.createElement(Je,{Icon:Xe,onClick:()=>r(Object(K.c)(n,s)),tooltip:Ge(o)})))};const nn=t=>`RTE_VIDEO_THUMBNAIL_SELECTOR_${t.getKey()}`,on=Object(l.a)(t=>t.uploads,(t,e)=>{const n=Object(K.g)(e.block);return n&&n.uploadInfo&&n.uploadInfo.uploadKey},(t,e)=>e?t[e]:void 0),rn=Object(a.b)((t,e)=>({upload:on(t,e),language:Object(zt.Q)(t),isThumbnailSelectorOpen:Object(Ht.a)(t)===nn(e.block),isRteVideoPosterEnabled:E.d.rteVideoPoster(t)}),(t,e)=>({onCancelUpload:e=>t(Ft.i(e,!1)),toggleVideoThumbnailsSelector:()=>t(Object(Nt.i)(nn(e.block)))})),sn=h.a.div.withConfig({componentId:"w5r2jc-0"})(["padding: 4px 0;"]),cn=h.a.div.withConfig({componentId:"w5r2jc-1"})(["margin: 8px 0 4px;// In order to override selection style defined for the editor we\n// have to use !important here\n& ::-moz-selection { background: transparent !important; }& ::selection { background: transparent !important; }&::-moz-selection { background: transparent !important; }&::selection { background: transparent !important; }"]);var an=rn(class extends c.a.Component{constructor(t){super(t),this.onNativeSelectionChange=(()=>{const t=window.getSelection();if(0===t.rangeCount)return;const e=t.getRangeAt(0),n=e.commonAncestorContainer;this.state.active?this.rootContainer.contains(n)||this.setState({active:!1}):this.rootContainer&&this.rootContainer.contains(n)&&this.selectBlock(),this.setState({isInSelection:Object(N.h)(e,this.rootContainer)})}),this.selectBlock=(()=>{const t=document.createRange();t.selectNodeContents(this.rootContainer);const e=window.getSelection();e.removeAllRanges(),e.addRange(t),this.setState({active:!0})}),this.isSelected=(()=>{const t=this.props.blockProps.getEditorState().getSelection(),e=this.props.block.getKey();return this.state.active&&Object(K.l)(t,e)}),this.onRetryUpload=(()=>{const t=this.props.upload;t&&this.props.blockProps.onRetryUpload(t.key)}),this.onMediaViewClickCapture=(t=>{this.state.active||this.selectBlock()}),this.onDragStart=(t=>{t.dataTransfer.effectAllowed="move",t.dataTransfer.setData(Vt,this.props.block.getKey())}),this.onRemove=(()=>{const t=this.props.blockProps.getEditorState();this.props.blockProps.onChange(Object(K.c)(t,this.props.block.getKey()))}),this.onCancelUpload=(async()=>{this.props.upload&&(await this.props.onCancelUpload(this.props.upload.key),this.selectBlock())}),this.onToolbarStateChange=(t=>{this.props.blockProps.onChange(t)}),this.toggleVideoThumbnailsSelector=(()=>{this.props.toggleVideoThumbnailsSelector()}),this.onThumbnailSelect=(t=>{const e=this.props.blockProps.getEditorState(),n=this.props.block.getKey();let o=Object(K.o)(e,this.props.block.getKey(),{thumbnail:t});o=Object(K.n)(o,n),this.props.blockProps.onChange(o),this.toggleVideoThumbnailsSelector()}),this.state={active:!1,isInSelection:!1}}shouldComponentUpdate(t,e){return e.active!==this.state.active||e.isInSelection!==this.state.isInSelection||t.block!==this.props.block||t.upload!==this.props.upload||Object(K.l)(t.selection,t.block.getKey())}componentDidMount(){document.addEventListener("selectionchange",this.onNativeSelectionChange);const t=this.props.selection;t.getHasFocus()&&Object(K.l)(t,this.props.block.getKey())&&this.selectBlock(),this.overlayContainer=_t(!0)}componentWillUnmount(){document.removeEventListener("selectionchange",this.onNativeSelectionChange)}componentWillReceiveProps(t){const e=t.block.getKey(),n=this.props.blockProps.getEditorState(),o=n;n!==o&&this.props.blockProps.onChange(o),!this.state.active&&t.selection!==this.props.selection&&t.selection.getHasFocus()&&Object(K.l)(t.selection,e)&&this.selectBlock()}getToolbarOffset(){return this.props.blockProps.rteFocusableContentRef&&this.rootContainer?this.rootContainer.getBoundingClientRect().top-this.props.blockProps.rteFocusableContentRef.getBoundingClientRect().top-30-10:0}render(){var t=this.props;const e=t.block,n=t.blockProps,o=t.isRteVideoPosterEnabled,r=t.language,i=t.offsetKey,s=t.upload,a=Object(K.g)(e),l=a.thumbnail,d=!!s&&Object(Ut.l)(s.metadata.mimetype||"");var u=this.state;const p=u.active,h=u.isInSelection;return c.a.createElement(cn,{innerRef:t=>this.rootContainer=t},p&&c.a.createElement(en,{block:e,editorState:n.getEditorState(),language:r,onChange:this.onToolbarStateChange,onThumbnailButtonClick:this.toggleVideoThumbnailsSelector,showThumbnailButton:o,showVideoControls:d}),c.a.createElement(Pe,null),c.a.createElement("div",{contentEditable:!1,"data-offset-key":i},c.a.createElement(sn,{draggable:!0,onDragStart:this.onDragStart,innerRef:t=>this.mediaContainer=t},c.a.createElement(De,{isSelected:h||p,language:r,thumbnail:l,onCancel:this.onCancelUpload,onClickCapture:this.onMediaViewClickCapture,onRetry:this.onRetryUpload,onRemove:this.onRemove,upload:s,mediaAsset:a.mediaAsset})),s&&d&&c.a.createElement(Pt.a,{language:r,onSelect:this.onThumbnailSelect,onToggleModal:this.toggleVideoThumbnailsSelector,videoSource:s.metadata.localUrl,videoDuration:s.metadata.videoDuration,selected:l,isOpen:this.props.isThumbnailSelectorOpen})),c.a.createElement(Pe,null))}}),ln=n("./src/reddit/constants/elementClassNames.ts");const dn=Object(Zt.e)("postCreation.addCaption"),un=h.a.div.withConfig({componentId:"sp99nr-0"})(["margin: 0 10% 12px;."," {text-align: center;font-size: 13px;line-height: 18px;&::after {content: '","';display: flex;position: absolute;top: 0;right: 0;left: 0;bottom: 0;justify-content: center;pointer-events: none;color: ",";}}"],ln.d,t=>t.placeholderText,t=>Object(Wt.c)(t).actionIcon),pn=Object(a.b)(t=>({language:Object(zt.Q)(t)}))(class extends c.a.PureComponent{constructor(t){super(t);var e=Object(M.e)(t.children[0]).props;const n=e.contentState,o=e.block;this.mediaBlockKey=n.getBlockBefore(o.getKey()).getKey()}render(){const t=this.props.children[0];var e=Object(M.e)(t).props;const n=e.block,o=e.contentState.getBlockForKey(this.mediaBlockKey),r=Object(K.g)(o);if(!r||!(r.mediaAsset||r.uploadInfo&&r.uploadInfo.mediaType))return null;const i=!n.getLength();return c.a.createElement(un,{placeholderText:i?dn(this.props.language):""},t)}}),hn=Object(D.Map)({[k.j]:{element:"div",wrapper:c.a.createElement(pn,null)}});var gn=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],o=!0,r=!1,i=void 0;try{for(var s,c=t[Symbol.iterator]();!(o=(s=c.next()).done)&&(n.push(s.value),!e||n.length!==e);o=!0);}catch(a){r=!0,i=a}finally{try{!o&&c.return&&c.return()}finally{if(r)throw i}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();var mn=(t,e,n)=>{const r=t.getSelection(),i=t.getCurrentContent(),s=i.getBlockForKey(r.getAnchorKey()),c=i.getBlockForKey(r.getFocusKey());var a=Object(W.e)(i,s,c),l=gn(a,2);const d=l[0],u=l[1];if(!d||d!==u)return t;const p=d.blocks,h=d.start,g=Object(W.g)(s),m=Object(W.g)(c),f=m.colCount;p.sort(W.b);const b=P()(p,f);var y=Object(W.f)(g,m);const E=y.minCol,O=y.minRow,x=y.maxCol,S=y.maxRow,C={rowIndex:0,colIndex:0};if("rows"===e){const t="before"===n?O:S+1,e=P()(Object(W.l)(f,S-O+1),f);b.splice(t,0,...e),C.rowIndex=t}else{const t="before"===n?E:x+1;b.forEach(e=>{e.splice(t,0,...Object(W.l)(x-E+1,1))}),C.colIndex=t}const v=Object(W.d)(b),k=i.getBlocksAsArray(),j=U()(v),w=[...k.slice(0,h),...j,...k.slice(h+p.length)],T=i.merge({blockMap:o.BlockMapBuilder.createFromArray(w)}),I=J()(j,t=>Object(W.h)(C,Object(W.g)(t))),R=Object(W.o)(r,I,I);let A=o.EditorState.push(t,T,Z.d);return A=o.EditorState.forceSelection(A,R)},fn=n("./node_modules/lodash/clamp.js"),bn=n.n(fn),yn=n("./src/reddit/components/RichTextEditor/helpers/sliceContiguousBlocks.ts");var En=(t,e,n="preserve")=>{const r=t.getSelection(),i=t.getCurrentContent(),s="up"===e||"left"===e?r.getStartKey():r.getEndKey(),c=i.getBlockForKey(s);if(!Object(k.v)(c.getType()))return;const a=Object(W.g)(c),l=a.colCount,d=a.colIndex,u=a.rowIndex,p=i.getBlocksAsArray(),h=Object(yn.a)(i,c);if(!h)return;let g=u,m=d;switch(e){case"up":g--;break;case"down":g++;break;case"left":--m<0&&(g--,m=l-1);break;case"right":++m>=l&&(g++,m=0)}const f={rowIndex:g,colIndex:m};let b=s;const y=J()(h.blocks,t=>Object(W.h)(Object(W.g)(t),f));if(y)b=y.getKey();else{const t=Object(W.c)(f,a)<0?h.start-1:h.start+h.blocks.length;0<=t&&t<p.length&&(b=p[t].getKey())}const E=i.getBlockForKey(b);let O=0;"preserve"===n?O=bn()(r.getFocusOffset(),0,E.getLength()):"end"===n&&(O=E.getLength());const x=r.merge({anchorKey:b,focusKey:b,focusOffset:O,anchorOffset:O});return r!==x?o.EditorState.forceSelection(t,x):void 0},On=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],o=!0,r=!1,i=void 0;try{for(var s,c=t[Symbol.iterator]();!(o=(s=c.next()).done)&&(n.push(s.value),!e||n.length!==e);o=!0);}catch(a){r=!0,i=a}finally{try{!o&&c.return&&c.return()}finally{if(r)throw i}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();const xn=(t,e)=>{const n=e.getCurrentContent(),o=e.getSelection(),r=n.getBlockForKey(o.getFocusKey());var i=Object(W.e)(n,r,r);const s=On(i,1)[0];if(!s)return;const c=Object(W.g)(r);let a;return(a=c.colIndex===c.colCount-1&&c.rowIndex===s.blocks.length/c.colCount-1&&!t.shiftKey&&o.getFocusKey()===o.getAnchorKey()?mn(e,"rows","after"):En(e,t.shiftKey?"left":"right","end"))?(t.preventDefault(),a):void 0},Sn=(t,e)=>{if(t.shiftKey)return;const n=En(e,"up");return n&&t.preventDefault(),n},Cn=(t,e)=>{if(t.shiftKey)return;const n=En(e,"down");return n&&t.preventDefault(),n};class vn{constructor(){this.lastRowInsertionState=null}undoRowInsertion(t){const e=o.EditorState.undo(t);return En(e,"down","end")||e}isSelectionInLastRow(t){const e=t.getCurrentContent(),n=t.getSelection(),o=e.getBlockForKey(n.getFocusKey());var r=Object(W.e)(e,o,o);const i=On(r,1)[0];if(!i)return!1;const s=Object(W.g)(i.blocks[0]).colCount,c=i.blocks.length/s;return Object(W.g)(o).rowIndex===c-1}insertNewRow(t){const e=t.getSelection();let n=mn(t,"rows","after");return n=o.EditorState.forceSelection(n,e),n=En(n,"down")||n,this.lastRowInsertionState=n,n}handle(t){return t.getSelection().isCollapsed()?t===this.lastRowInsertionState?this.undoRowInsertion(t):this.isSelectionInLastRow(t)?this.insertNewRow(t):En(t,"down")||t:t}}const kn=(t,e)=>{const n=t.getSelection();if(n.isCollapsed()||n.getStartKey()===n.getEndKey())return;const r=t.getCurrentContent(),i=r.getBlockForKey(n.getAnchorKey()),s=r.getBlockForKey(n.getFocusKey());var c=Object(W.e)(r,i,s),a=On(c,2);const l=a[0],d=a[1];if(l&&l===d){const i=Object(W.o)(n,s,s,!1),c=V.b(r,i,e);return o.EditorState.push(t,c,Z.c)}};var jn=n("./node_modules/lodash/forEach.js"),wn=n.n(jn),Tn=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],o=!0,r=!1,i=void 0;try{for(var s,c=t[Symbol.iterator]();!(o=(s=c.next()).done)&&(n.push(s.value),!e||n.length!==e);o=!0);}catch(a){r=!0,i=a}finally{try{!o&&c.return&&c.return()}finally{if(r)throw i}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();const In=(t,e)=>e?t[0]:t[t.length-1];var Rn=(t,e)=>{return t.getSelection().isCollapsed()?((t,e)=>{const n=t.getSelection(),r=e.getSelection();if(!n.isCollapsed()||r.isCollapsed()||0!==r.getStartOffset()||r.getStartKey()!==n.getStartKey())return t;const i=t.getCurrentContent(),s=e.getCurrentContent(),c=i.getBlockForKey(n.getAnchorKey());if(!Object(k.v)(c.getType()))return t;var a=Object(W.g)(c);const l=a.rowIndex,d=a.colIndex;if(0!==l||0!==d)return t;const u=i.getBlockMap(),p=s.getBlockMap();if(u.size>=p.size)return t;const h=i.getBlockAfter(n.getAnchorKey()),g=s.getBlockAfter(r.getEndKey());if(h&&h!==g)return t;const m=c.merge({type:k.n,data:Object(D.Map)({})}),f=i.merge({blockMap:u.set(c.getKey(),m)});return o.EditorState.set(t,{currentContent:f})})(t,e):((t,e)=>{const n=t.getSelection();if(n.isCollapsed())return t;if(e.getSelection()===n)return t;if(n.getFocusKey()===n.getAnchorKey())return t;const r=t.getCurrentContent(),i=r.getBlockForKey(n.getAnchorKey()),s=r.getBlockForKey(n.getFocusKey());var c=Object(W.e)(r,i,s),a=Tn(c,2);const l=a[0],d=a[1];if(!l&&!d)return t;let u=t;if(l!==d){const e=n.getIsBackward(),r=Object(W.o)(n,l?In(l.blocks,!e):null,d?In(d.blocks,e):null,e);n!==r&&(u=o.EditorState.forceSelection(t,r))}else if(l&&d&&l===d){const e=Object(W.g)(i),c=Object(W.g)(s),a=r.getBlocksAsArray(),l=d.start,p=d.blocks,h=p[0],g=Object(W.g)(h);if(0!==g.colIndex||0!==g.rowIndex)throw new Error("First table block must always has [0, 0] coordinate!");const m=Object(W.b)(s,i)<0,f=Object(W.k)(e,c),b=[],y=[];wn()(p,t=>{const e=Object(W.g)(t);f(e.rowIndex,e.colIndex)?b.push(t):t!==h&&y.push(t)});const E=b[0]===h;b.sort(W.b);const O=[...a.slice(0,l),...E?[]:[h],...b,...y,...a.slice(l+p.length)],x=In(b,!m),S=In(b,m),C=Object(W.o)(n,x,S,m),v=r.merge({blockMap:o.BlockMapBuilder.createFromArray(O),selectionAfter:C});u=o.EditorState.set(t,{currentContent:v}),C!==n&&(u=o.EditorState.forceSelection(u,C))}return u})(t,e)};const An=h.a.div.withConfig({componentId:"s6xq7pv-0"})(["display: table-cell;box-sizing: border-box;padding: 8px 9px;position: relative;."," {",'}&[data-selected="true"] {background-color: #7dbcff99;}'],"public-DraftStyleDefault-block",t=>t.alignment?`text-align: ${W.a[t.alignment]}`:""),Bn=h.a.div.withConfig({componentId:"s6xq7pv-1"})(["display: table-row;"]),Kn=h.a.div.withConfig({componentId:"s6xq7pv-2"})(["display: table;table-layout: fixed;width: 100%;box-sizing: border-box;border-radius: 4px;border: 1px solid ",";margin: 5px 0;",":not(:first-child) {border-left: 1px solid ",";}",":not(:last-child) "," {border-bottom: 1px solid ",";}",":first-child "," {font-weight: 500;}",":nth-child(2n) {background-color: rgba(0, 0, 0, 0.01);}",""],t=>Object(Wt.c)(t).line,An,t=>Object(Wt.c)(t).line,Bn,An,t=>Object(Wt.c)(t).line,Bn,An,Bn,t=>t.isFakeSelectionActive?"\n    // In order to override selection style defined for the editor we\n    // have to use !important here\n    & ::selection { background: transparent !important; }\n  ":""),Mn=(t,e)=>{if(!t.contains(e))return;let n=e;for(;n&&n!==t;){if(n instanceof HTMLElement&&n.hasAttribute("data-row"))return n;n.parentElement&&(n=n.parentElement)}},Ln=(t,e=10)=>{let n=t,o=e;for(;n&&o>0;){if(n instanceof HTMLElement&&n.dataset.table)return n;n.parentElement&&(n=n.parentElement),o--}},Dn=t=>{const e=t.dataset;if("string"==typeof e.row&&"string"==typeof e.col)return{rowIndex:+e.row,colIndex:+e.col}},Nn=t=>{const e=window.getSelection(),n=e.focusNode,o=e.anchorNode,r=e.rangeCount;if(n!==o&&r&&t){const n=e.getRangeAt(0);return Object(N.h)(n,t)&&!t.contains(n.commonAncestorContainer)}return!1},Fn=t=>{const e=c.a.Children.toArray(t);var n=Object(M.e)(e[0]).props;const o=n.selection,r=n.contentState,i=n.block;const s=Object(W.g)(i).colCount;e.sort((t,e)=>Object(W.b)(Object(M.c)(t),Object(M.c)(e)));const a=P()(e,s);let l,d,u=!1;if(o.getAnchorKey()!==o.getFocusKey()){const t=r.getBlocksAsArray(),n=r.getBlockForKey(o.getStartKey()),s=r.getBlockForKey(o.getEndKey()),c=t.indexOf(n),a=t.indexOf(s),p=t.indexOf(i),h=p+e.length-1;c<p&&p<a||c<h&&h<a?u=!0:p<=c&&a<=h&&(d=Object(W.g)(o.getIsBackward()?s:n),l=Object(W.g)(o.getIsBackward()?n:s))}return{rows:a,anchorCell:d,focusCell:l,isSelectWholeTable:u}};const Pn=Object(D.Map)({[k.l]:{element:"div",wrapper:c.a.createElement(class extends c.a.Component{constructor(t){super(t),this.tableElem=null,this.onMouseDown=(t=>{if(!this.tableElem||t.nativeEvent.detail<2)return;const e=window.getSelection(),n=e.rangeCount?e.getRangeAt(0):null,o=Mn(this.tableElem,e.focusNode);if(n&&o)if(2===t.nativeEvent.detail&&e.isCollapsed){const r=n.cloneRange();r.setEndAfter(o),r.toString()||(t.preventDefault(),e.selectAllChildren(o))}else t.nativeEvent.detail>=3&&(e.selectAllChildren(o),t.preventDefault())}),this.onNativeSelectionChange=(()=>{const t=this.tableElem;if(!t)return;const e=window.getSelection();if(e.anchorNode===e.focusNode)return void this.resetSelection();const n=Mn(t,e.anchorNode),o=Mn(t,e.focusNode);n&&n===o?this.resetSelection():n&&o?this.setCellsRange(n,o):n||o?this.selectWholeTable():Nn(t)?this.selectWholeTable():this.resetSelection()}),this.resetSelection=(()=>{(this.state.anchorCell||this.state.focusCell||this.state.isSelectWholeTable)&&this.setState({isSelectWholeTable:!1,focusCell:void 0,anchorCell:void 0})}),this.setCellsRange=((t,e)=>{const n=Dn(e),o=Dn(t);Object(W.h)(n,this.state.focusCell)&&Object(W.h)(o,this.state.anchorCell)&&!this.state.isSelectWholeTable||this.setState({focusCell:n,anchorCell:o,isSelectWholeTable:!1})}),this.selectWholeTable=(()=>{!this.state.focusCell&&this.state.isSelectWholeTable||this.setState({focusCell:void 0,isSelectWholeTable:!0})}),this.state=Fn(t.children)}componentDidMount(){document.addEventListener("selectionchange",this.onNativeSelectionChange)}componentWillUnmount(){document.removeEventListener("selectionchange",this.onNativeSelectionChange)}componentWillReceiveProps(t){t.children!==this.props.children&&this.setState(Fn(t.children))}render(){var t=this.state;const e=t.rows,n=t.anchorCell,o=t.focusCell;let r;t.isSelectWholeTable?r=((t,e)=>!0):n&&o&&!Object(W.h)(n,o)&&(r=Object(W.k)(n,o));const i=e[0].map(t=>Object(W.g)(Object(M.e)(t).props.block).alignment),s=e.map((t,e)=>c.a.createElement(Bn,{key:e},t.map((t,n)=>c.a.createElement(An,{alignment:i[n],"data-row":e,"data-col":n,"data-selected":!!r&&r(e,n),key:n},t))));return c.a.createElement(Kn,{innerRef:t=>this.tableElem=t,onMouseDown:this.onMouseDown,isFakeSelectionActive:!!r,"data-table":!0},s)}},null)}});var _n=n("./node_modules/lodash/isEqual.js"),Un=n.n(_n),Hn=n("./src/reddit/components/RichTextEditor/Tooltip/index.tsx");var zn=h()(t=>c.a.createElement("svg",{className:t.className,viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},c.a.createElement("g",{fill:"inherit",fillRule:"nonzero"},c.a.createElement("path",{d:"M3.5 11h13c.55 0 1-.45 1-1s-.45-1-1-1h-13c-.55 0-1 .45-1 1s.45 1 1 1zM7.42 16h5.08c.55 0 1-.45 1-1s-.45-1-1-1H7.42c-.56 0-1 .45-1 1s.44 1 1 1zM3.5 6h13c.55 0 1-.45 1-1s-.45-1-1-1h-13c-.55 0-1 .45-1 1s.45 1 1 1z"})))).withConfig({componentId:"s11q670f-0"})(["fill: ",";"],t=>Object(Wt.c)(t).actionIcon);var Vn=h()(t=>c.a.createElement("svg",{className:t.className,viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},c.a.createElement("g",{fill:"inherit",fillRule:"nonzero"},c.a.createElement("path",{d:"M3.5 11h13c.55 0 1-.45 1-1s-.45-1-1-1h-13c-.55 0-1 .45-1 1s.45 1 1 1zM3.5 16h5.4c.54 0 1-.45 1-1s-.46-1-1-1H3.5c-.55 0-1 .45-1 1s.45 1 1 1zM3.5 6h13c.55 0 1-.45 1-1s-.45-1-1-1h-13c-.55 0-1 .45-1 1s.45 1 1 1z"})))).withConfig({componentId:"l0ha0a-0"})(["fill: ",";"],t=>Object(Wt.c)(t).actionIcon);var Wn=h()(t=>c.a.createElement("svg",{className:t.className,viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},c.a.createElement("g",{fill:"inherit",fillRule:"nonzero"},c.a.createElement("path",{d:"M3.5 11h13c.55 0 1-.45 1-1s-.45-1-1-1h-13c-.55 0-1 .45-1 1s.45 1 1 1zM11.5 16h5c.55 0 1-.45 1-1s-.45-1-1-1h-5c-.55 0-1 .45-1 1s.45 1 1 1zM3.5 6h13c.55 0 1-.45 1-1s-.45-1-1-1h-13c-.55 0-1 .45-1 1s.45 1 1 1z"})))).withConfig({componentId:"s12l9ej0-0"})(["fill: ",";"],t=>Object(Wt.c)(t).actionIcon);var $n=h()(t=>c.a.createElement("svg",{className:t.className,viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},c.a.createElement("g",{fill:"inherit",fillRule:"nonzero",transform:"vertical"===t.orientation?"rotate(90, 10, 10)":""},c.a.createElement("path",{d:"M3 3c0-.55.45-1 1-1h12c.55 0 1 .45 1 1v14c0 .55-.45 1-1 1H4c-.55 0-1-.45-1-1V3zM2 3v14c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V3c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2z"}),c.a.createElement("path",{d:"M2 15h16v1H2M2 4h16v1H2M7.17 11.4l4.24-4.23c.4-.4 1.04-.4 1.43 0 .4.4.4 1.03 0 1.42L8.6 12.82c-.4.4-1.04.4-1.43 0-.4-.4-.4-1.03 0-1.42z"}),c.a.createElement("path",{d:"M8.6 7.17l4.23 4.24c.4.4.4 1.04 0 1.43-.4.4-1.03.4-1.42 0L7.18 8.6c-.4-.4-.4-1.04 0-1.43.4-.4 1.03-.4 1.42 0z"})))).withConfig({componentId:"s6cgka2-0"})(["fill: ",";"],t=>Object(Wt.c)(t).actionIcon);const qn={up:"rotate(180 10 10)",down:"",left:"rotate(90 10 10)",right:"rotate(-90 10 10)"};var Zn=h()(t=>c.a.createElement("svg",{className:t.className,viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},c.a.createElement("g",{fill:"inherit",fillRule:"nonzero",transform:qn[t.orientation||"down"]},c.a.createElement("path",{d:"M17 17c0 .55-.45 1-1 1H4c-.55 0-1-.45-1-1V3c0-.55.45-1 1-1h12c.55 0 1 .45 1 1v14zm1 0V3c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2z"}),c.a.createElement("path",{d:"M18 6H2V5h16M13 13H7c-.55 0-1-.45-1-1s.45-1 1-1h6c.55 0 1 .45 1 1s-.45 1-1 1z"}),c.a.createElement("path",{d:"M9 15V9c0-.55.45-1 1-1s1 .45 1 1v6c0 .55-.45 1-1 1s-1-.45-1-1z"})))).withConfig({componentId:"wdg68u-0"})(["fill: ",";"],t=>Object(Wt.c)(t).actionIcon),Gn=n("./src/reddit/models/RichTextJson/index.ts"),Yn=n("./src/reddit/components/RichTextEditor/HoverTooltip/index.tsx"),Jn=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],o=!0,r=!1,i=void 0;try{for(var s,c=t[Symbol.iterator]();!(o=(s=c.next()).done)&&(n.push(s.value),!e||n.length!==e);o=!0);}catch(a){r=!0,i=a}finally{try{!o&&c.return&&c.return()}finally{if(r)throw i}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();var Xn=(t,e=!1)=>{const n=t.getSelection(),r=t.getCurrentContent(),i=r.getBlockForKey(n.getAnchorKey()),s=r.getBlockForKey(n.getFocusKey());var c=Object(W.e)(r,i,s),a=Jn(c,2);const l=a[0],d=a[1];if(l&&l===d){const e=l.blocks;e.sort(W.b);const r=Object(W.o)(n,e[0],q()(e));return Q(o.EditorState.set(t,{selection:r}),"rows")}},Qn=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],o=!0,r=!1,i=void 0;try{for(var s,c=t[Symbol.iterator]();!(o=(s=c.next()).done)&&(n.push(s.value),!e||n.length!==e);o=!0);}catch(a){r=!0,i=a}finally{try{!o&&c.return&&c.return()}finally{if(r)throw i}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();var to=(t,e)=>{const n=t.getSelection(),r=t.getCurrentContent(),i=r.getBlockForKey(n.getAnchorKey()),s=r.getBlockForKey(n.getFocusKey());var c=Object(W.e)(r,i,s),a=Qn(c,2);const l=a[0],d=a[1];if(!l||l!==d)return t;const u=Object(W.g)(i),p=Object(W.g)(s);var h=Object(W.f)(u,p);const g=h.minCol,m=h.maxCol,f=l.blocks.map(t=>{const n=Object(W.g)(t).colIndex;return g<=n&&n<=m?Object(W.m)(t,{alignment:e}):t}),b=r.getBlockMap(),y=r.merge({blockMap:b.merge(o.BlockMapBuilder.createFromArray(f)),selectionAfter:n,selectionBefore:n});return o.EditorState.push(t,y,Z.a)};const eo=Object(Zt.e)("postCreation.tableToolbar.alignLeft"),no=Object(Zt.e)("postCreation.tableToolbar.alignCenter"),oo=Object(Zt.e)("postCreation.tableToolbar.alignRight"),ro=Object(Zt.e)("postCreation.tableToolbar.insertColumnBefore"),io=Object(Zt.e)("postCreation.tableToolbar.insertColumnAfter"),so=Object(Zt.e)("postCreation.tableToolbar.deleteColumn"),co=Object(Zt.e)("postCreation.tableToolbar.insertRowAbove"),ao=Object(Zt.e)("postCreation.tableToolbar.insertRowBelow"),lo=Object(Zt.e)("postCreation.tableToolbar.deleteRow"),uo=Object(Zt.e)("postCreation.tableToolbar.deleteTable"),po=h()(We.a).withConfig({componentId:"gl04vs-0"})(["line-height: 0;padding: 3px;"]),ho=(t,e)=>n=>c.a.createElement(t,Object.assign({},e,n)),go=Object($e.f)(Zn),mo=ho(go,{orientation:"up"}),fo=ho(go,{orientation:"right"}),bo=ho(go,{orientation:"left"}),yo=Object($e.f)($n),Eo=ho(yo,{orientation:"vertical"}),Oo=Object($e.f)(zn),xo=Object($e.f)(Vn),So=Object($e.f)(Wn),Co=Object($e.f)(He.b),vo=h()(ze.a).withConfig({componentId:"gl04vs-1"})(["width: ","px;box-sizing: border-box;background-color: ",";border-radius: 4px;padding: 2px 5px;box-shadow: 0 0 0 1px ",",0 1px 10px ",";// This is needed for removing tooltip delay when user moves mouse pointer\n// from one toolbar icon to other. Basically once tooltips are on, we need to\n// let the user hover around to quickly read all of the actions\n&:hover "," "," {opacity: 1;}"],309,t=>Object(Wt.c)(t).field,t=>Object(Wt.c)(t).line,t=>Object(Wt.c)(t).line,Yn.b,Yn.a);var ko=t=>{const e=t.editorState,n=t.language,o=t.onChange;return c.a.createElement(vo,null,c.a.createElement(po,{Icon:xo,onClick:()=>o(to(e,Gn.e)),tooltip:eo(n)}),c.a.createElement(po,{Icon:Oo,onClick:()=>o(to(e,Gn.d)),tooltip:no(n)}),c.a.createElement(po,{Icon:So,onClick:()=>o(to(e,Gn.f)),tooltip:oo(n)}),c.a.createElement(Ve.c,null),c.a.createElement(po,{Icon:bo,onClick:()=>o(mn(e,"columns","before")),tooltip:ro(n)}),c.a.createElement(po,{Icon:fo,onClick:()=>o(mn(e,"columns","after")),tooltip:io(n)}),c.a.createElement(po,{Icon:Eo,onClick:()=>o(Q(e,"columns")),tooltip:so(n)}),c.a.createElement(Ve.c,null),c.a.createElement(po,{Icon:mo,onClick:()=>o(mn(e,"rows","before")),tooltip:co(n)}),c.a.createElement(po,{Icon:go,onClick:()=>o(mn(e,"rows","after")),tooltip:ao(n)}),c.a.createElement(po,{Icon:yo,onClick:()=>o(Q(e,"rows")),tooltip:lo(n)}),c.a.createElement(Ve.c,null),c.a.createElement(po,{Icon:Co,onClick:()=>o(Xn(e)||e),tooltip:uo(n)}))};const jo=20,wo=h.a.div.withConfig({componentId:"cbkhz6-0"})(["position: relative;width: ","px;height: ","px;cursor: pointer;color: rgba(0, 0, 0, 0.5);border-radius: 2px;text-align: center;line-height: 2px;font-size: 16px;box-sizing: border-box;border: 1px solid transparent;",'&:hover {opacity: 1;}&::after {content: "','";}'],jo,14,t=>t.pressed?"\n    background-color: #E0E0E0;\n    border-color: rgba(0, 0, 0, 0.3);\n  ":"\n    background-color: #FAFAFA;\n    border-color: rgba(0, 0, 0, 0.2);\n    opacity: 0.9;\n  ","…"),To=h.a.div.withConfig({componentId:"cbkhz6-1"})(["position: absolute;left: 50%;transform: translateX(-50%);bottom: ","px;"],16),Io=t=>{const e={};if(!t||!document.documentElement)return e;const n=t.left-154.5,o=t.left+154.5-document.documentElement.clientWidth;return n<0?e.left=-n+jo+2:o>0&&(e.left=-o+jo-2),e},Ro=t=>{t.preventDefault(),t.stopPropagation()};class Ao extends s.Component{constructor(t){super(t),this.containerElem=null,this.setContainerRef=(t=>this.containerElem=t),this.onResize=(t=>{this.hideToolbar(),this.state.tooltipPosition&&this.updateForCurrentSelection()}),this.onDocumentClick=(t=>{this.state.isToolbarActive&&this.containerElem&&(this.containerElem.contains(t.target)||this.hideToolbar())}),this.onNativeSelectionChange=(()=>{this.updateForCurrentSelection()}),this.updateForCurrentSelection=(()=>{const t=window.getSelection();if(!t.rangeCount)return void this.hideActionButton();const e=t.getRangeAt(0).commonAncestorContainer;if(!this.props.rteDomRef.contains(e))return void this.hideActionButton();const n=Ln(e);if(!n)return void this.hideActionButton();const o=Mn(n,t.anchorNode);if(!o)return void this.hideActionButton();const r=Mn(n,t.focusNode);r?this.updateActionButtonPosition(o,r):this.hideActionButton()}),this.updateActionButtonPosition=((t,e)=>{const n=t.getBoundingClientRect(),o=e.getBoundingClientRect(),r={top:Math.min(n.top,o.top),left:Math.max(n.right,o.right)-jo};Un()(this.state.tooltipPosition,r)||this.setState({tooltipPosition:r}),this.hideToolbar()}),this.hideActionButton=(()=>{this.hideToolbar(),this.state.tooltipPosition&&this.setState({tooltipPosition:null})}),this.hideToolbar=(()=>{this.state.isToolbarActive&&this.setState({isToolbarActive:!1})}),this.onActionButtonClick=(t=>{this.setState(t=>({isToolbarActive:!t.isToolbarActive})),Ro(t)}),this.state={isToolbarActive:!1,tooltipPosition:null},this.api={hideActionButton:this.hideActionButton}}componentDidMount(){const t=this.props.onSetApi;document.addEventListener("selectionchange",this.onNativeSelectionChange),document.addEventListener("click",this.onDocumentClick),window.addEventListener("resize",this.onResize),t&&t(this.api)}componentWillUnmount(){const t=this.props.onSetApi;document.removeEventListener("selectionchange",this.onNativeSelectionChange),document.removeEventListener("click",this.onDocumentClick),window.removeEventListener("resize",this.onResize),t&&t(null)}componentWillReceiveProps(t){const e=t.editorState.getSelection(),n=this.props.editorState.getSelection();e.getHasFocus()&&Object(k.v)(o.RichUtils.getCurrentBlockType(t.editorState))?e!==n&&this.hideToolbar():this.hideActionButton()}render(){const t=!this.props.readOnly&&this.state.isToolbarActive,e=this.state.tooltipPosition;return c.a.createElement("div",{ref:this.setContainerRef},c.a.createElement(Hn.b,{targetPosition:e},c.a.createElement(wo,{onMouseDown:Ro,onMouseMove:Ro,onClick:this.onActionButtonClick,pressed:t},t?c.a.createElement(To,{style:Io(e)},c.a.createElement(ko,{onChange:this.props.onChange,editorState:this.props.editorState,language:this.props.language})):null)))}}var Bo=n("./src/reddit/components/RichTextEditor/editorStateTransforms.ts");function Ko(){return new Map}const Mo=c.a.createContext(Ko());function Lo(t){class e extends c.a.Component{constructor(){super(...arguments),this.elementRef=null,this.updateElementRef=(t=>{const e=this.props.registry;this.elementRef=t,t?e.set(this.props.entityKey,t):e.delete(this.props.entityKey)})}componentWillReceiveProps(t){const e=this.props.registry;this.props.entityKey!==t.entityKey&&this.elementRef&&(e.get(this.props.entityKey)===this.elementRef&&e.delete(this.props.entityKey),e.set(t.entityKey,this.elementRef))}render(){return c.a.createElement("span",{ref:this.updateElementRef},c.a.createElement(t,Object.assign({},this.props)))}}return t=>c.a.createElement(Mo.Consumer,null,n=>c.a.createElement(e,Object.assign({},t,{registry:n})))}var Do=n("./src/reddit/components/RichTextEditor/emotes/decorator.m.less"),No=n.n(Do);const Fo={strategy:function(t,e,n){t.findEntityRanges(t=>{const e=t.getEntity();return!!e&&n.getEntity(e).getType()===L.a.EMOTE},e)},component:Lo(t=>{var e=t.contentState.getEntity(t.entityKey).getData();const n=e.id,o=e.height,r=e.width,i=e.url;return c.a.createElement("span",{className:No.a.emote,title:`:${n}:`,style:{backgroundImage:`url(${i})`,height:o,width:r}},t.children)})},Po=()=>Fo;var _o=n("./src/higherOrderComponents/makeAsync.tsx"),Uo=Object(_o.a)({ErrorComponent:()=>null,LoadingComponent:()=>null,getComponent:()=>n.e("EmotesTooltip").then(n.bind(null,"./src/reddit/components/RichTextEditor/emotes/tooltip.tsx")).then(t=>t.default)});const Ho=new Set([L.a.LINK]);var zo=n("./src/reddit/components/RichTextEditor/entity/link/helpers.tsx");const Vo=h.a.a.withConfig({componentId:"dl26ew-0"})(["color: ",";text-decoration: underline;"],t=>Object(Wt.c)(t).linkText),Wo={strategy:zo.a,component:Lo(t=>{const e=t.contentState.getEntity(t.entityKey).getData().url;return c.a.createElement(Vo,{href:e},t.children)})},$o=()=>Wo;var qo=n("./src/lib/linkMatchers/index.ts"),Zo=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],o=!0,r=!1,i=void 0;try{for(var s,c=t[Symbol.iterator]();!(o=(s=c.next()).done)&&(n.push(s.value),!e||n.length!==e);o=!0);}catch(a){r=!0,i=a}finally{try{!o&&c.return&&c.return()}finally{if(r)throw i}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();const Go=(t,e)=>{if(e.getType()===k.f)return[];return(t.match(e.getText())||[]).filter(t=>((t,{index:e,lastIndex:n})=>{for(let o=e;o<n;o++)if(t.getInlineStyleAt(o).contains(k.k.MONOSPACE))return!1;return!0})(e,t))},Yo=(t,e,n,r)=>{const i=t.getBlockForKey(e),s=o.SelectionState.createEmpty(e),c=[],a=new Set;let l=t;const d=(t,e,o)=>{let r=null;for(let s=t;s<e;s++){const t=i.getEntityAt(s),e=t&&l.getEntity(t);if(e){if(e.getType()!==n)return;r||a.has(t)||(r=t)}}if(r){l.getEntity(r).getData().url!==o&&(l=l.mergeEntityData(r,{url:o}))}return r||(t=>(l=l.createEntity(n,"MUTABLE",{url:t})).getLastCreatedEntityKey())(o)},u=(t,e,n)=>{const r=s.merge({anchorOffset:t,focusOffset:e});l=o.Modifier.applyEntity(l,r,n)},p=(t,e)=>u(t,e,null),h=l.getBlockForKey(e);Go(r,h).forEach(({index:t,lastIndex:e,url:n})=>{const o=d(t,e,n);o&&(u(t,e,o),a.add(o),c.push([t,e]))});let g=0;return h.findEntityRanges(t=>{const e=t.getEntity();return!!e&&l.getEntity(e).getType()===n},(t,e)=>{if(g>=c.length)return void p(t,e);var n=Zo(c[g],2);const o=n[0],r=n[1];e<=o?p(t,e):(t<o&&p(t,o-1),e>r&&p(r,e),g++)}),l},Jo=(t,e)=>{const n=t.getCurrentContent(),r=e.getCurrentContent();if(n===r)return t;const i=n.getBlockMap(),s=r.getBlockMap();let c=n;return i.forEach((t,e)=>{if(e){if(t===s.get(e))return;c=Yo(c,e,L.a.SUBREDDIT_LINK,qo.d),c=Yo(c,e,L.a.USER_LINK,qo.g)}}),t.getCurrentContent()===c?t:(c=c.merge({selectionAfter:t.getCurrentContent().getSelectionAfter(),selectionBefore:t.getCurrentContent().getSelectionBefore()}),o.EditorState.set(t,{currentContent:c}))};var Xo=t=>{return!!t.getCurrentContent().getBlockMap().filter(t=>!!t&&t.getType()===k.a).size};const Qo=" ".repeat(4),tr=new RegExp("^ {1,4}|\\t"),er=new Set([k.b.CODE_BLOCK]),nr=(t,e)=>{const n=e.getCurrentContent(),r=e.getSelection(),i=t.shiftKey;let s=n,c=r.getAnchorOffset(),a=r.getFocusOffset();if(Object(G.a)(n,r,(t,e)=>{const n=t.getType();if("paragraph"===n||!er.has(n))return!1;let l=null;const d=t.getText(),u=o.SelectionState.createEmpty(e);if(i){const t=d.match(tr);if(t){const e=t[0].length;s=V.b(s,u.merge({focusOffset:e}),""),l=-e}}else s=V.a(s,r.isCollapsed()?r:u,Qo),l=4;null!==l&&(e===r.getAnchorKey()&&(c+=l),e===r.getFocusKey()&&(a+=l))}),s!==n)return s=s.merge({selectionAfter:r.merge({anchorOffset:c,focusOffset:a})}),t.preventDefault(),o.EditorState.push(e,s,i?"remove-range":"insert-characters")},or=t=>(t=>{const e=t.getSelection(),n=t.getCurrentContent();if(!e.isCollapsed())return et(t);if(0===e.getStartOffset()){const o=n.getBlockForKey(e.getEndKey());if(Object(k.v)(o.getType()))return t;{const e=n.getBlockBefore(o.getKey());if(e&&Object(k.v)(e.getType()))return t}}})(t)||(t=>{const e=t.getSelection(),n=t.getCurrentContent();if(e.isCollapsed()&&0===e.getStartOffset()){const r=n.getBlockForKey(e.getEndKey());if(Object(k.o)(r.getType()))return Object(K.c)(t,r.getKey());if(Object(k.u)(r.getType())){const e=n.getBlockBefore(r.getKey());return o.EditorState.forceSelection(t,Object(M.b)(e))}}})(t),rr=t=>(t=>{const e=t.getSelection(),n=t.getCurrentContent();if(!e.isCollapsed())return et(t);{const o=n.getBlockForKey(e.getEndKey());if(e.getEndOffset()===o.getLength()){if(Object(k.v)(o.getType()))return t;{const e=n.getBlockAfter(o.getKey());if(e&&Object(k.v)(e.getType()))return t}}}})(t)||(t=>{const e=t.getSelection(),n=t.getCurrentContent();if(!e.isCollapsed())return;const o=n.getBlockForKey(e.getEndKey());if(e.getEndOffset()===o.getLength()){if(Object(k.o)(o.getType()))return Object(K.c)(t,o.getKey());{const o=n.getBlockAfter(e.getEndKey());if(o&&Object(k.o)(o.getType()))return Object(K.c)(t,o.getKey())}}})(t),ir=t=>{const e=t.getSelection();if(!e.isCollapsed())return!1;const n=o.RichUtils.getCurrentBlockType(t);if(!k.c.includes(n))return!1;if(e.getFocusOffset()>0){if("\n"===t.getCurrentContent().getBlockForKey(e.getFocusKey()).getText()[e.getFocusOffset()-1])return!1}return!0};var sr=n("./src/lib/memoizeByReference/index.ts");const cr=Object(sr.a)(t=>{const e=t.getSelection();if(!e.isCollapsed())return;const n=e.getStartOffset(),o=t.getCurrentContent(),r=o.getBlockForKey(e.getFocusKey());if(r.getType()!==k.n)return;const i=r.getText();if(i.startsWith("1.")&&2===n)return k.i.ORDERED;if(i.startsWith("*")&&1===n){const t=o.getBlockBefore(r.getKey());if(t&&t.getType()===k.n&&t.getText().startsWith("* "))return;return k.i.UNORDERED}}),ar=t=>{const e=cr(t);if(!e)return t;const n=Object(Bo.a)(t);let r=o.Modifier.replaceText(n.getCurrentContent(),n.getSelection().merge({anchorOffset:0}),"");return r=o.Modifier.setBlockType(r,r.getSelectionAfter(),e),o.EditorState.push(n,r,Z.b)};var lr=n("./src/reddit/components/RichTextEditor/helpers/styles.ts"),dr=n("./src/reddit/components/RichTextEditor/spoiler/helpers.ts");const ur=h.a.span.withConfig({componentId:"s1fc73uu-0"})(["background: #545452;color: #FFFFFF;padding: 0 4px;margin: 0 3px;caret-color: #FFFFFF;border-radius: 2px;"]),pr=()=>({strategy:dr.a,component:t=>c.a.createElement(ur,null,c.a.createElement("span",null),t.children,c.a.createElement("span",null))});var hr=n("./src/reddit/components/FocusableContent/index.tsx"),gr=n("./src/reddit/constants/componentSizes.ts"),mr=n("./src/reddit/contexts/InsideOverlay.tsx"),fr=n("./node_modules/lodash/debounce.js"),br=n.n(fr),yr=n("./src/reddit/actions/subredditAutocomplete.ts"),Er=n("./src/reddit/constants/zIndex.ts"),Or=n("./src/reddit/helpers/name/index.ts"),xr=n("./src/reddit/selectors/subredditAutocomplete.ts"),Sr=function(t,e){var n={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(n[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(t);r<o.length;r++)e.indexOf(o[r])<0&&(n[o[r]]=t[o[r]])}return n};const Cr=h()(t=>{t.isFocused;var e=Sr(t,["isFocused"]);return c.a.createElement("div",Object.assign({},e))}).withConfig({componentId:"s3o3y8s-0"})(["padding: 12px 16px;cursor: pointer;background-color: ",";color: ",";"],t=>t.isFocused?Object(Wt.c)(t).button:"inherit",t=>t.isFocused?Object(Wt.c)(t).lightText:Object(Wt.c)(t).bodyText);class vr extends s.Component{constructor(t){super(t),this.mouseDown=!1,this.onMouseUp=(()=>{this.mouseDown&&(this.props.onEntrySelect(this.props.entry),this.mouseDown=!1)}),this.onMouseDown=(t=>{this.mouseDown=!0,t.preventDefault()}),this.onMouseOver=(()=>{this.props.onEntryFocus(this.props.entry)}),this.mouseDown=!1}componentDidUpdate(){this.mouseDown=!1}render(){return c.a.createElement(Cr,{isFocused:this.props.isFocused,onMouseDown:this.onMouseDown,onMouseUp:this.onMouseUp,onMouseOver:this.onMouseOver},this.props.children)}}const kr=Object(l.c)({subredditSuggestions:(t,e)=>{const n=Object(xr.e)(t,e);return n?n.subreddits:[]}}),jr=Object(a.b)(kr,(t,e)=>({onGetSubredditAutocomplete:e=>{t(yr.d(e))}})),wr=h.a.div.withConfig({componentId:"s19idreq-0"})(["min-width: 240px;border-radius: 4px;overflow: hidden;background-color: ",";box-shadow: 0 0 0 1px ",",0px 2px 3px 2px ",";z-index: ",";"],t=>Object(Wt.c)(t).body,t=>Object(Wt.c)(t).line,t=>Object(Wt.c)(t).line,Er.g);var Tr=jr(class extends s.Component{constructor(t){super(t),this.api=null,this.onEntrySelect=(t=>{this.props.onSelect(this.props.subredditSuggestions[t].name)}),this.onEntryFocus=(t=>{this.setState({selectedSuggestionIndex:t})}),this.moveUp=(()=>{if(this.props.subredditSuggestions.length>1){let t=this.state.selectedSuggestionIndex-1;return t=t<0?this.props.subredditSuggestions.length-1:t,this.setState({selectedSuggestionIndex:t}),!0}return!1}),this.moveDown=(()=>{if(this.props.subredditSuggestions.length>1){const t=(this.state.selectedSuggestionIndex+1)%this.props.subredditSuggestions.length;return this.setState({selectedSuggestionIndex:t}),!0}return!1}),this.selectCurrent=(()=>{if(this.props.subredditSuggestions.length){const t=this.props.subredditSuggestions[this.state.selectedSuggestionIndex];return t&&this.props.onSelect(t.name),!0}return!1}),this.state={selectedSuggestionIndex:0},this.requestSubredditAutocomplete=br()(this.requestSubredditAutocomplete.bind(this),200,{maxWait:200}),this.api={moveUp:this.moveUp,moveDown:this.moveDown,selectCurrent:this.selectCurrent}}componentDidMount(){this.requestSubredditAutocomplete(this.props.substring),this.props.onDropdownApi(this.api)}componentWillUnmount(){this.props.onDropdownApi(null)}componentWillReceiveProps(t){t.substring!==this.props.substring&&(this.requestSubredditAutocomplete(t.substring),this.setState({selectedSuggestionIndex:0}))}requestSubredditAutocomplete(t){this.props.onGetSubredditAutocomplete(t)}render(){return this.props.subredditSuggestions.length?c.a.createElement(wr,{className:this.props.className},this.props.subredditSuggestions.map((t,e)=>c.a.createElement(vr,{"data-redditstyle":!0,entry:e,isFocused:e===this.state.selectedSuggestionIndex,key:t.name,onEntrySelect:this.onEntrySelect,onEntryFocus:this.onEntryFocus},Object(Or.b)(t.name)))):null}});const Ir=h.a.div.withConfig({componentId:"s1oyowv0-0"})(["box-sizing: border-box;margin: 4px 8px;padding: 2px 0 2px 12px;line-height: 21px;position: relative;&:before {content: '';position: absolute;top: 0;left: 0;bottom: 0;width: 4px;border-radius: 4px;background-color: ",";}blockquote ~ blockquote {padding-top: 8px;}"],t=>Object(Qt.g)(Object(Wt.c)(t).bodyText,.1)),Rr=Object(D.Map)({[k.e]:{element:"blockquote",wrapper:c.a.createElement(Ir,null)}}),Ar=h.a.div.withConfig({componentId:"f0y7ez-0"})(["","margin: 15px 0;padding: 8px;background: ",";color: #222;"],O.bodyFontMono,t=>"rgba(238, 238, 238, 0.8)"),Br=Object(D.Map)({[k.f]:{element:"code",wrapper:c.a.createElement(Ar,null)}});var Kr=n("./node_modules/bowser/src/bowser.js"),Mr=n.n(Kr),Lr=n("./node_modules/lodash/includes.js"),Dr=n.n(Lr),Nr=n("./src/reddit/components/RichTextEditor/DragController/helpers.ts");const Fr=h.a.div.withConfig({componentId:"s49qsbb-0"})(["input,textarea,[contenteditable] {",";};"],t=>t.hideCaret?"caret-color: transparent":""),Pr=h.a.div.withConfig({componentId:"s49qsbb-1"})(["display: block;height: 2px;border-radius: 1px;margin: 0 16px;background: ",";transform: translateY(-50%);"],t=>Object(Wt.c)(t).button),_r=h()(Hn.b).withConfig({componentId:"s49qsbb-2"})(["left: 0px;right: 0px;pointer-events: none;transition: top .2s;"]);class Ur extends s.Component{constructor(t){super(t),this.dragCount=0,this.setContainerRef=(t=>this.containerRef=t),this.preventDocumentDrop=(t=>{!!function t(e){return e.draggable?e:e.parentElement?t(e.parentElement):null}(t.target)||(t.preventDefault(),t.stopPropagation())}),this.onDragOver=(t=>{const e=Dr()(t.dataTransfer.types,Vt);if(!e){if(!Object(Nr.c)(t.dataTransfer)||!this.props.allowMedia)return}if(!e&&!Object(Nr.c)(t.dataTransfer))return;t.preventDefault();try{t.dataTransfer.dropEffect=e?"move":"copy"}catch(i){}const n=this.props.editorState;let o=null;const r=Object(Nr.b)(n,t);if(r){const t=this.containerRef.getBoundingClientRect().left;o={top:r.clientY,left:t}}Un()(o,this.state.point)||this.setState({point:o})}),this.onDragEnter=(t=>{this.dragCount++}),this.onDragLeave=(t=>{this.dragCount--,0===this.dragCount&&this.state.point&&this.setState({point:null})}),this.onDrop=(t=>{const e=()=>{this.dragCount=0,this.setState({point:null})},n=Mr.a.msie?null:t.dataTransfer.getData(Vt),o=Object(Nr.a)(t.dataTransfer);if(!(n||o.length&&this.props.allowMedia))return void e();const r=this.props.editorState,i=Object(Nr.b)(r,t);if(!i)return void e();t.preventDefault(),t.stopPropagation();const s=i.isBefore?M.a.before:M.a.after;n?this.props.onBlockMove(n,i.blockKey,s):setTimeout(()=>{this.props.onFilesDrop(o,i.blockKey,s)}),e()}),this.state={point:null}}componentDidMount(){document.addEventListener("drop",this.preventDocumentDrop),document.addEventListener("dragover",this.preventDocumentDrop)}componentWillUnmount(){document.removeEventListener("drop",this.preventDocumentDrop),document.removeEventListener("dragover",this.preventDocumentDrop)}render(){const t=this.props.children,e=this.state.point,n=c.a.Children.only(t);return c.a.createElement(Fr,{innerRef:this.setContainerRef,onDragOver:this.onDragOver,onDragEnter:this.onDragEnter,onDragLeave:this.onDragLeave,onDrop:this.onDrop,hideCaret:!!e},c.a.createElement("div",null,n),c.a.createElement(_r,{targetPosition:e},c.a.createElement(Pr,null)))}}var Hr=n("./node_modules/draft-js/lib/DraftPasteProcessor.js"),zr=n.n(Hr),Vr=n("./node_modules/draft-js/lib/getEntityKeyForSelection.js"),Wr=n.n(Vr),$r=n("./node_modules/draft-js/lib/splitTextIntoTextBlocks.js"),qr=n.n($r),Zr=n("./src/reddit/components/RichTextEditor/entity/cloneEntitiesInFragment.ts"),Gr=n("./src/reddit/components/RichTextEditor/entity/applyEntityToContentBlock.ts");var Yr=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],o=!0,r=!1,i=void 0;try{for(var s,c=t[Symbol.iterator]();!(o=(s=c.next()).done)&&(n.push(s.value),!e||n.length!==e);o=!0);}catch(a){r=!0,i=a}finally{try{!o&&c.return&&c.return()}finally{if(r)throw i}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();function Jr(t,e,n){const r=Object(o.convertFromHTML)(e,void 0,n);if(r){const e=r.contentBlocks,n=r.entityMap;if(e){const r=o.BlockMapBuilder.createFromArray(function(t){return t.map(t=>Object(k.r)(t.getType())?T(t):t)}(e));return[t.set("entityMap",n),r]}}return[t,null]}function Xr(t,e,n){const r=qr()(e),i=n&&1===r.length?n:o.CharacterMetadata.create(),s=zr.a.processText(r,i).map(t=>t.merge({type:k.n}));return o.BlockMapBuilder.createFromArray(s)}const Qr=t=>{if(!t)return null;const e=document.createElement("div");e.innerHTML=t;const n=e.querySelector("[data-reddit-rtjson]");return n&&n.getAttribute("data-reddit-rtjson")},ti=t=>{if(Et())return{text:window.clipboardData.getData("text"),html:null};{const e=t.clipboardData.getData("text/html");return{text:t.clipboardData.getData("text/plain"),html:e}}};function ei(t,e,n){var r=ti(n);const i=r.text,s=r.html,c=function(t,e,n,o){const r={text:e,html:n,rtjson:o,fragment:null},i=t.getClipboard();return i&&n&&function(t,e,n,o){return-1!==e.indexOf(o)||1===t.size&&t.first().getText()===n}(i,n,e,t.getEditorKey())&&(r.fragment=i),r}(e,i,s,s&&Qr(s));e.getClipboard()&&!c.fragment&&e.setClipboard(null);const a=t.getCurrentContent(),l=t.getSelection(),d=t.getCurrentInlineStyle(),u=e.props.blockRenderMap;let p=null,h=a;if(!(p=function(t,e,n){const o=t.getBlockForKey(e.getStartKey()),r=t.getBlockForKey(e.getEndKey());if(o.getType()===k.f||r.getType()===k.f)return Xr(0,n).map(t=>t.merge({type:k.f,depth:0}))}(h,l,c.text))&&c.fragment){p=c.fragment;var g=Object(Zr.b)(h,p),m=Yr(g,2);h=m[0],p=m[1],p=kt(p)}if(!p&&c.rtjson&&(p=function(t){const e=JSON.parse(t);return Object(o.convertFromRaw)(e).getBlockMap()}(c.rtjson)),!p&&c.html){var f=Jr(h,c.html,u),b=Yr(f,2);h=b[0],p=b[1]}if(!p&&c.text){const t=function(t,e,n){return o.CharacterMetadata.create({style:n,entity:Wr()(t,e)})}(h,l,d);var y=function(t,e){let n=t,o=e;return e.forEach(t=>{const e=t.getText(),r=qo.c.match(e);if(!r)return;let i=t;r.forEach(({index:t,lastIndex:e,url:r})=>{const s=(n=n.createEntity(L.a.LINK,"MUTABLE",{url:r})).getLastCreatedEntityKey();i=Object(Gr.a)(i,t,e,s),o=o.set(i.getKey(),i)})}),[n,o]}(h,p=Xr(0,c.text,t)),E=Yr(y,2);h=E[0],p=E[1]}if(p)return h=function(t,e,n){let o=lt(t,e,n)||jt(t,e,n);return o||(o=V.c(t,e,n))}(h,l,p),o.EditorState.push(t,h,Z.d)}var ni=n("./src/reddit/components/RichTextEditor/entity/getSelectionEntityInfo.ts");const oi=Object(Zt.e)("postCreation.linkDetailsPopup.changeButton"),ri=Object(Zt.e)("postCreation.linkDetailsPopup.removeButton"),ii=h.a.div.withConfig({componentId:"s1cfl11n-0"})(["background-color: ",";padding: 10px;cursor: default;font-size: 14px;white-space: nowrap;box-shadow: 0 0 0 1px ",",0 1px 10px ",";"],t=>Object(Wt.c)(t).body,t=>Object(Wt.c)(t).line,t=>Object(Wt.c)(t).line),si=h.a.a.withConfig({componentId:"s1cfl11n-1"})(["max-width: 370px;display: inline-block;vertical-align: bottom;text-overflow: ellipsis;overflow: hidden;color: ",";text-decoration: none;&:hover {text-decoration: underline;}"],t=>Object(Wt.c)(t).linkText),ci=h.a.a.withConfig({componentId:"s1cfl11n-2"})(["color: ",";cursor: pointer;&:hover {text-decoration: underline;}"],t=>Object(Wt.c)(t).linkText);var ai=t=>c.a.createElement("div",null,c.a.createElement(ii,{onMouseDown:t=>t.preventDefault()},c.a.createElement(si,{href:t.url,target:"_blank"},t.url),c.a.createElement("span",null," – "),c.a.createElement(ci,{onClick:()=>t.onStartEdit(),role:"button"},oi(t.language)),c.a.createElement("span",null," | "),c.a.createElement(ci,{onClick:()=>t.onRemove(),role:"button"},ri(t.language)))),li=n("./src/reddit/controls/Input/index.tsx");const di=Object(Zt.e)("postCreation.linkEditorPopup.insertButton"),ui=Object(Zt.e)("postCreation.linkEditorPopup.applyButton"),pi=Object(Zt.e)("postCreation.linkEditorPopup.textLabel"),hi=Object(Zt.e)("postCreation.linkEditorPopup.linkLabel"),gi=Object(Zt.e)("postCreation.linkEditorPopup.textInputPlaceholder"),mi=Object(Zt.e)("postCreation.linkEditorPopup.linkInputPlaceholder"),fi=Object(Zt.e)("postCreation.linkEditorPopup.invalidLinkHint"),bi=h.a.form.withConfig({componentId:"s19xhsdu-0"})(["background-color: ",";padding: 10px;display: flex;flex-flow: column nowrap;min-width: 350px;box-shadow: 0 0 0 1px ",",0 1px 10px ",";"],t=>Object(Wt.c)(t).body,t=>Object(Wt.c)(t).line,t=>Object(Wt.c)(t).line),yi=h()(t=>c.a.createElement("div",Object.assign({},t),t.children)).withConfig({componentId:"s19xhsdu-1"})(["outline: none;font-size: 12px;"]),Ei=h()(li.a).withConfig({componentId:"s19xhsdu-2"})(["display: inline-block;line-height: 28px;border-radius: 2px;color: ",";background-color: ",";margin: 0px 0px 4px 5px;font-size: 12px;border: 1px solid ",";;flex-grow: 1;"],t=>Object(Wt.c)(t).bodyText,t=>Object(Wt.c)(t).field,t=>Object(Wt.c)(t).line),Oi=h.a.label.withConfig({componentId:"s19xhsdu-3"})(["display: flex;align-items: baseline;"]),xi=h.a.div.withConfig({componentId:"s19xhsdu-4"})(["display: flex;flex-flow: row-reverse nowrap;justify-content: space-between;"]),Si=h.a.span.withConfig({componentId:"s19xhsdu-5"})(["color: ",";padding-top: 3px;align-self: flex-start;"],ne.a.warning),Ci=h()(oe.f).withConfig({componentId:"s19xhsdu-6"})(["line-height: 20px;min-width: 100px;align-self: flex-end;"]),vi=t=>{t&&(t.focus(),t.select())},ki=/ /g,ji=t=>t.replace(ki,"%20");class wi extends s.Component{constructor(t){super(t),this.focused=!1,this.focusLostTimer=0,this.textInputElementRef=null,this.urlInputElementRef=null,this.onEdited=(()=>{const t=this.state.url.trim(),e=ji(t),n=Object(qo.f)(e);if(!n)return this.setState({isInvalidUrl:!0}),void(this.urlInputElementRef&&this.urlInputElementRef.focus());const o=n.url;this.props.onEdited(o,this.state.displayText.trim()||t)}),this.onFocus=(()=>{this.focused=!0}),this.onBlur=(()=>{this.focused=!1,this.focusLostTimer=window.setTimeout(()=>{this.focused||this.props.onFocusLost()},0)}),this.onClick=(t=>{t.stopPropagation()}),this.handleUrlChange=(t=>{const e=t.target.value;let n=this.state.isInvalidUrl;n&&Object(qo.e)(qo.c,e)&&(n=!1),this.setState({url:e,isInvalidUrl:n})}),this.handleDisplayTextChange=(t=>{this.setState({displayText:t.target.value})}),this.handleSubmit=(t=>{this.onEdited(),t.preventDefault()}),this.state={url:t.url,displayText:t.displayText,isInvalidUrl:!1}}componentDidMount(){Object(qo.e)(qo.c,this.state.displayText)?vi(this.textInputElementRef):vi(this.urlInputElementRef)}componentWillUnmount(){this.focusLostTimer&&clearTimeout(this.focusLostTimer)}render(){var t=this.props;const e=t.language,n=t.isInsertMode;return c.a.createElement(yi,{tabIndex:0,onClick:this.onClick,onBlur:this.onBlur,onFocus:this.onFocus},c.a.createElement(bi,{onSubmit:this.handleSubmit},c.a.createElement(Oi,null,pi(e),":",c.a.createElement(Ei,{innerRef:t=>this.textInputElementRef=t,type:"text",placeholder:gi(e),value:this.state.displayText,onChange:this.handleDisplayTextChange})),c.a.createElement(Oi,null,hi(e),":",c.a.createElement(Ei,{innerRef:t=>this.urlInputElementRef=t,type:"text",placeholder:mi(e),value:this.state.url,onChange:this.handleUrlChange})),c.a.createElement(xi,null,c.a.createElement(Ci,{type:"submit",disabled:this.state.isInvalidUrl},n?di(e):ui(e)),this.state.isInvalidUrl?c.a.createElement(Si,null,fi(e)):null)))}}function Ti(t,e,n){const o=t.getCurrentContent(),r={text:"",url:""};if(e.isCollapsed())return r;if(n)r.text=n.entityText,r.url=o.getEntity(n.entityKey).getData().url;else{r.text=function(t,e){if(t.getStartKey()!==t.getEndKey())throw new Error("Selection must be in a single block");return t.isCollapsed()?"":e.getBlockForKey(t.getStartKey()).getText().slice(t.getStartOffset(),t.getEndOffset())}(e,t.getCurrentContent());const n=Object(qo.e)(qo.c,r.text);n&&(r.url=n.url)}return r}function Ii(t,e){return o.EditorState.set(t,{currentContent:o.Modifier.removeInlineStyle(t.getCurrentContent(),e,k.k.HIGHLIGHT)})}class Ri extends s.Component{constructor(t){super(t),this.api=null,this.updateTooltipPosition=null,this.lastEditorSelectionClientRect=null,this.editLinkInSelection=(t=>{const e=this.props.editorState;let n=t,r=e;const i=e.getCurrentContent();if(!Object(zo.e)(i,t))return!1;const s=Object(ni.a)(i,t);if(s){if(i.getEntity(s.entityKey).getType()!==L.a.LINK)return!1;n=s.entitySelection}else this.isEditorFocused()&&(this.lastEditorSelectionClientRect=function(){const t=window.getSelection();if(!t.rangeCount)return null;const e=Object(o.getVisibleSelectionRect)(window);return e||(!e&&t.focusNode&&t.focusNode===t.anchorNode?t.focusNode.getBoundingClientRect():null)}());return this.state.linkSelection&&(r=Ii(e,this.state.linkSelection)),r=function(t,e){return o.EditorState.set(t,{currentContent:o.Modifier.applyInlineStyle(t.getCurrentContent(),e,k.k.HIGHLIGHT)})}(e,n),this.props.onChange(r,()=>{this.setState({linkSelection:n,linkEntity:s})}),!0}),this.hidePopup=(()=>{this.interruptLinkEditing(),this.hideDetailsPopup()}),this.showDetailsPopup=(()=>{this.state.isDetailsPopupActive||this.setState({isDetailsPopupActive:!0})}),this.hideDetailsPopup=(()=>{this.state.isDetailsPopupActive&&this.setState({isDetailsPopupActive:!1})}),this.updatePosition=(()=>{if(!this.updateTooltipPosition)return;const t=this.props.editorState,e=t.getCurrentContent();let n;if(this.state.linkSelection){const t=Object(ni.a)(e,this.state.linkSelection);if(t){const e=this.props.entityElementRegistry.get(t.entityKey);n=e&&e.getBoundingClientRect()}else this.lastEditorSelectionClientRect&&(n=this.lastEditorSelectionClientRect)}else{const e=Object(zo.b)(t);if(e){const t=this.props.entityElementRegistry.get(e.entityKey);n=t&&t.getBoundingClientRect()}}n&&(this.updateTooltipPosition({left:n.left,top:n.bottom}),this.lastEditorSelectionClientRect=null)}),this.handleLink=((t,e)=>{const n=this.state.linkSelection,r=this.props.editorState;let i=r;n&&(n.isCollapsed()||(i=Ii(r,n)),void 0!==t&&(i=Object(zo.h)(i,n,t,e)),this.setState({linkSelection:null,linkEntity:null}),i!==r&&(i=o.EditorState.forceSelection(i,i.getSelection()),this.props.onChange(i)))}),this.onLinkEdited=((t,e)=>{this.handleLink(t,e)}),this.interruptLinkEditing=(()=>this.handleLink()),this.isEditorFocused=(()=>this.props.editorState.getSelection().getHasFocus()),this.onStartEditFocusedLink=(()=>{const t=this.props.editorState,e=Object(zo.b)(t);e&&this.editLinkInSelection(e.entitySelection)}),this.onRemoveFocusedLink=(()=>{const t=this.props.editorState,e=Object(zo.b)(t);e&&this.props.onChange(Object(zo.h)(t,e.entitySelection,""))}),this.renderEditorPopup=(()=>{var t=this.state;const e=t.linkSelection,n=t.linkEntity,o=this.props.editorState;if(!e)return null;var r=Ti(o,e,n);const i=r.text,s=r.url;return c.a.createElement(wi,{url:s,displayText:i,isInsertMode:!n,onEdited:this.onLinkEdited,onFocusLost:this.interruptLinkEditing,language:this.props.language})}),this.renderDetailsPopup=(()=>{const t=Object(zo.b)(this.props.editorState);return t&&this.isEditorFocused()&&this.state.isDetailsPopupActive?c.a.createElement(ai,{url:t.url,onStartEdit:this.onStartEditFocusedLink,onRemove:this.onRemoveFocusedLink,language:this.props.language}):null}),this.state={isDetailsPopupActive:!1,linkSelection:null,linkEntity:null},this.api={editLinkInSelection:this.editLinkInSelection,hidePopup:this.hidePopup}}componentDidMount(){const t=this.props.onSetApi;this.api&&t&&t(this.api)}componentWillUnmount(){this.props.onSetApi&&this.props.onSetApi(null)}componentDidUpdate(t,e){e.linkSelection===this.state.linkSelection&&t.editorState===this.props.editorState||(this.showDetailsPopup(),this.updatePosition())}render(){return c.a.createElement(Hn.b,{onSetPositionUpdater:t=>this.updateTooltipPosition=t,trianglePlacement:Hn.a.Above},this.renderEditorPopup()||this.renderDetailsPopup())}}const Ai=h.a.ol.withConfig({componentId:"s1amux7z-0"})(["margin: 4px 0px 4px 20px;& > li {margin: 0.4em 0;}"]),Bi=Object(D.Map)({[k.i.ORDERED]:{element:"li",aliasedElements:["li"],wrapper:c.a.createElement(Ai,null)}}),Ki=h.a.div.withConfig({componentId:"f0967h-0"})(["&:first-child {div:first-child {padding-top: 0;}}& > div {padding: 0.25em 0;}"]),Mi=Object(D.Map)({[k.n]:{element:"div",aliasedElements:["p"],wrapper:c.a.createElement(Ki,null)}});var Li=n("./src/reddit/components/RichTextEditor/RTEState/index.tsx");const Di=Object(sr.a)(()=>({[k.k.SUPERSCRIPT]:{position:"relative",top:"-0.4em",fontSize:"0.7em",lineHeight:"0.7em"},[k.k.HIGHLIGHT]:{backgroundColor:"#b8e0f9"},[k.k.UNDERLINE]:{textDecoration:"none"},[k.k.MONOSPACE]:{backgroundColor:"rgba(238, 238, 238, 0.8)",caretColor:"#000",color:"#FF006D",fontFamily:O.CODE_FONT_FAMILY,padding:"0.1em 0.2em",fontSize:"0.8em",borderRadius:"3px"}})),Ni=Object(p.css)(["margin-top: 1.4em;margin-bottom: 8px;"]),Fi=h.a.div.withConfig({componentId:"h8tvjb-0"})(["",";",""],Ni,O.titleFontH1),Pi=h.a.div.withConfig({componentId:"h8tvjb-1"})(["",";",""],Ni,O.titleFontH2),_i=h.a.div.withConfig({componentId:"h8tvjb-2"})(["",";",""],Ni,O.titleFontH3),Ui=h.a.div.withConfig({componentId:"h8tvjb-3"})(["",";",""],Ni,O.titleFontH4),Hi=h.a.div.withConfig({componentId:"h8tvjb-4"})(["",";",""],Ni,O.titleFontH5),zi=h.a.div.withConfig({componentId:"h8tvjb-5"})(["",";",""],Ni,O.titleFontH6),Vi=t=>({component:e=>c.a.createElement(t,null,c.a.createElement(o.EditorBlock,Object.assign({},e))),editable:!0}),Wi={[k.g.H1]:Vi(Fi),[k.g.H2]:Vi(Pi),[k.g.H3]:Vi(_i),[k.g.H4]:Vi(Ui),[k.g.H5]:Vi(Hi),[k.g.H6]:Vi(zi)},$i=["italic normal 1em 'Noto Sans'","italic bold 1em 'Noto Sans'","normal bold 1em 'Noto Sans'"],qi=()=>{const t=document.fonts;t&&t.load&&$i.forEach(e=>t.load(e))},Zi=h.a.ul.withConfig({componentId:"s8mqzck-0"})(["margin: 4px 0;& > li {margin: 0.4em 0;}"]),Gi=Object(D.Map)({[k.i.UNORDERED]:{element:"li",aliasedElements:["li"],wrapper:c.a.createElement(Zi,null)}});var Yi=n("./node_modules/lodash/dropRightWhile.js"),Ji=n.n(Yi),Xi=n("./node_modules/lodash/flatMap.js"),Qi=n.n(Xi),ts=n("./node_modules/lodash/reduceRight.js"),es=n.n(ts),ns=n("./node_modules/lodash/trimEnd.js"),os=n.n(ns),rs=n("./node_modules/lodash/trimStart.js"),is=n.n(rs),ss=n("./src/lib/forEachGroup/index.ts");function cs(t,e){const n=[],o=t.withMutations(t=>{for(;t.size&&e(t.first());)n.push(t.first()),t.shift()});return{popped:n,stack:o}}var as=n("./src/lib/linkMatchers/customLinks.ts"),ls=n("./src/lib/unicodeUtils/index.ts"),ds=n("./src/reddit/models/RichTextJson/nodeMakers.ts");const us={BOLD:Gn.j.bold,ITALIC:Gn.j.italic,MONOSPACE:Gn.j.monospace,STRIKETHROUGH:Gn.j.strikethrough,SUBSCRIPT:Gn.j.subscript,SUPERSCRIPT:Gn.j.superscript,UNDERLINE:Gn.j.underline};var ps=(t,e)=>hs(t.getBlockMap(),t,e);const hs=(t,e,n)=>{const o=[];let r=t.toStack();for(;r.size;){const t=r.first(),l=t.getType();switch(r=r.shift(),l){case k.g.H1:case k.g.H2:case k.g.H3:case k.g.H4:case k.g.H5:case k.g.H6:o.push(ys(t,e));break;case k.e:{var i=cs(r,t=>t.getType()===k.e);const n=i.popped;r=i.stack,o.push(Es([t,...n],e));break}case k.f:{var s=cs(r,t=>t.getType()===k.f);const e=s.popped;r=s.stack,o.push(Os([t,...e]));break}case k.i.ORDERED:case k.i.UNORDERED:{var c=cs(r,t=>t.getType()===l);const n=c.popped;r=c.stack,o.push(xs([t,...n],e));break}case k.l:{var a=cs(r,t=>Object(k.v)(t.getType()));const n=a.popped;r=a.stack,o.push(Ss([t,...n],e));break}case k.a:{const e=r.first();n&&o.push(Cs(t,e,n)),r=r.shift();break}case k.n:default:o.push(fs(t,e))}}return o},gs=(t,e)=>{const n=[],o=Object(ls.b)(t);return Object(ss.a)(e,{keyFn:t=>t.getStyle()},(e,r,i,s)=>{if(r.isEmpty())return;const c=t.slice(i,s),a=i+(c.length-is()(c).length),l=s-(c.length-os()(c).length),d=l-a,u=o[a],p=o[l]-u;d>0&&n.push([(t=>t.reduce((t,e)=>e===k.k.UNDERLINE||e===k.k.SUBSCRIPT?t:t|(us[e]||0)|0,0))(r),u,p])}),n.length?n:null},ms=(t,e)=>{const n=t.getText(),o=t.getCharacterList(),r=[],i=k.d.includes(t.getType()),s=k.c.includes(t.getType());let c=0;return Object(ss.a)(o,{keyFn:(t,o)=>{const r=t.getEntity();return i&&t.getStyle().contains(k.k.SPOILER)?"spoiler":Object(L.b)(r,e)?`link-${t.getEntity()}`:"\n"===n[o]?s?"linebreak":"skip":r&&e.getEntity(r).getType()===L.a.EMOTE?`emote-${c++}`:"text"}},(t,i,s,c)=>{const a=n.slice(s,c),l=o.slice(s,c).toList();if("text"===i){const t=gs(a,l);r.push(Object(ds.s)(a,t))}else if("spoiler"===i)r.push(Object(ds.n)(a));else if(i.startsWith("link-")){const n=e.getEntity(t.getEntity());r.push(((t,e,n)=>{const o=t.getData().url,r="/"===e[0];if(t.getType()===L.a.SUBREDDIT_LINK){const t=e.replace(as.d,"");return Object(ds.o)(t,r)}if(t.getType()===L.a.USER_LINK){const t=e.replace(as.d,"");return Object(ds.t)(t,r)}const i=gs(e,n);return Object(ds.i)(e,o,i)})(n,a,l))}else if("linebreak"===i)r.push(Object(ds.h)());else if(i.startsWith("emote-")){const n=e.getEntity(t.getEntity()).getData();r.push(Object(ds.e)(n.fullId))}}),r},fs=(t,e)=>Object(ds.l)(ms(t,e)),bs=t=>"text"===t.e?Object(ds.m)(t.t):"link"===t.e?Object(ds.i)(t.t,t.u,null):t.e===Gn.x?t.c.map(bs):t.e===Gn.n?Object(ds.m)(""):t,ys=(t,e)=>Object(ds.f)(k.m[t.getType()],((t,e)=>es()(Qi()(ms(t,e),bs),([t,...e],n)=>{if(!t)return[n];const o=e.length?e:[];return t&&"raw"===n.e&&"raw"===t.e?[Object(ds.m)(n.t+t.t),...o]:[n,t,...o]},[]))(t,e)),Es=(t,e)=>Object(ds.c)(Ji()(t.map(t=>((t,e)=>t.getText().trim().length?fs(t,e):ds.a)(t,e)),t=>t===ds.a)),Os=t=>Object(ds.d)(t.map(t=>Object(ds.m)(t.getText()))),xs=(t,e)=>{if(!t.length)return Object(ds.k)([],!1);const n=t[0].getDepth();let o=null;const r=[];let i=[];const s=()=>null!==o||i.length,c=()=>{const t=[];null!==o&&(t.push(o),o=null),i.length&&(t.push(xs(i,e)),i=[]),r.push(Object(ds.j)(t))};return t.forEach(t=>{t.getDepth()>n?i.push(t):(s()&&c(),o=Object(ds.l)(ms(t,e)))}),s()&&c(),Object(ds.k)(r,t[0].getType()===k.i.ORDERED)},Ss=(t,e)=>{const n=[...t].sort(W.b),o=n[0];const r=Object(W.g)(o).colCount,i=P()(n,r),s=i[0].map(t=>{const n=Object(W.g)(t).alignment;return Object(ds.q)(ms(t,e),n)}),c=i.slice(1).map(t=>t.map(t=>Object(ds.p)(ms(t,e))));return Object(ds.r)(s,c)},Cs=(t,e,n)=>{const o=Object(K.g)(t);if(!o)throw new Error("Invalid atomic block!");const r=o.uploadInfo,i=o.mediaAsset,s=o.makeGif,c=e.getText();if(r){const t=n[r.uploadKey],e=t&&t.metadata.mimetype||"";var a=Object(K.e)(o,n);const i=a.assetId,l=a.thumbnailAssetId;return Object(Ut.j)(e)?Object(ds.b)(i,c):Object(Ut.k)(e)?Object(ds.g)(i,c):Object(ds.u)(i,c,l,s)}{const t=i.assetId;switch(i.type){case K.a.AnimatedImage:return Object(ds.b)(t,c);case K.a.Image:return Object(ds.g)(t,c);case K.a.Video:return Object(ds.u)(t,c);default:throw new Error("Invalid media type")}}};var vs,ks=n("./src/reddit/constants/elementIds.ts");!function(t){t.Up="up",t.Down="down"}(vs||(vs={}));var js=t=>{const e=window.getSelection().focusNode;if(!e||!e.parentElement)return;const n=document.getElementById(ks.d),o=n||document.documentElement;if(!o)return;const r=window.innerHeight;var i=e.parentElement.getBoundingClientRect();const s=i.bottom,c=i.top,a=n?0:gr.j+gr.D;t===vs.Up&&c<a?o.scrollBy(0,c-a):t===vs.Down&&s>r&&o.scrollBy(0,s-r)},ws=(t,e,n)=>{const o={url:n};return t.createEntity(e,"MUTABLE",o)},Ts=n("./node_modules/lodash/maxBy.js"),Is=n.n(Ts);const Rs=(t,e)=>{if(!e)return(t=>{const e=t.id;switch(t.e){case Gn.m:return{assetId:e,type:K.a.Image};case Gn.a:return{assetId:e,type:K.a.AnimatedImage};case Gn.C:return{assetId:e,type:K.a.Video}}})(t);const n=e.id;switch(e.e){case Gn.s:{const t=e.s;return{assetId:n,type:K.a.Image,imageUrl:t.u,width:t.x,height:t.y}}case Gn.r:{const t=e.s;return{assetId:n,type:K.a.AnimatedImage,imageUrl:t.gif,posterUrl:t.p,dashUrl:t.mp4,width:t.x,height:t.y}}case Gn.t:{const t=e.isGif,o=e.dashUrl,r=e.hlsUrl,i=e.p,s=e.x,c=e.y;let a;if(i){a=Is()(i,t=>t.x).u}return{assetId:n,type:K.a.Video,isGif:t,dashUrl:o,hlsUrl:r,posterUrl:a,width:s,height:c}}}};var As=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],o=!0,r=!1,i=void 0;try{for(var s,c=t[Symbol.iterator]();!(o=(s=c.next()).done)&&(n.push(s.value),!e||n.length!==e);o=!0);}catch(a){r=!0,i=a}finally{try{!o&&c.return&&c.return()}finally{if(r)throw i}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();const Bs=Object.keys(us),Ks=(t,e,n)=>{switch(e.e){case Gn.u:return Ps(t,e.c,k.b.UNSTYLED);case Gn.k:const r=k.h[e.l];return Ps(t,e.c||[],r);case Gn.p:return Ds(t,e);case Gn.b:return Ms(t,e);case Gn.c:return void e.c.forEach(e=>Ps(t,[e],k.b.CODE_BLOCK));case Gn.z:return Ls(t,e);case Gn.m:case Gn.a:case Gn.C:return void t.blocks.push(...function(t,e){const n=t.id,r=t.c,i=Gn.D(e,n),s=Rs(t,i);return[new o.ContentBlock({key:Object(o.genKey)(),type:k.a,data:Object(D.Map)({mediaAsset:s})}),Object(M.g)(Object(o.genKey)(),r).merge({type:k.j})]}(e,n))}},Ms=(t,e)=>{e&&e.c&&e.c.length&&e.c.forEach(e=>e.e===Gn.u?Ps(t,e.c,k.b.BLOCK_QUOTE):Ks(t,e))},Ls=(t,e)=>{const n=e.h,o=e.c,r=n.length;[n,...o].forEach((e,o)=>e.forEach((e,i)=>{var s=e.c;const c=void 0===s?[]:s,a={alignment:n[i].a,colCount:r,colIndex:i,rowIndex:o};Ps(t,c,k.b.TABLE_CELL,a)}))},Ds=(t,e,n=0)=>{const o=e.o?k.b.ORDERED_LIST:k.b.UNORDERED_LIST;e.c.forEach(e=>{const r=e.c;if(!r||!r.length)return;var i=As(r,2);const s=i[0],c=i[1],a=s.e===Gn.u?s.c:[];Ps(t,a,o,void 0,n),c&&c.e===Gn.p&&Ds(t,c,n+1)})},Ns={[Gn.y]:["r/","/r/"],[Gn.B]:["u/","/user/"],[Gn.v]:["p/",""],[Gn.g]:["c/",""]},Fs={[Gn.y]:L.a.SUBREDDIT_LINK,[Gn.B]:L.a.USER_LINK,[Gn.v]:L.a.POST_LINK,[Gn.g]:L.a.COMMENT_LINK},Ps=(t,e,n,r={},i,s=!1)=>{const c=t.content;var a=_s(e,c);const l=a.charList,d=a.text,u=a.updatedContent,p=new o.ContentBlock({key:Object(o.genKey)(),characterList:Object(D.List)(l),data:Object(D.fromJS)(r),depth:i,text:d,type:n});t.content=u||c,s?t.blocks.unshift(p):t.blocks.push(p)},_s=(t,e)=>{let n=e,o="";const r=[];if(t.forEach(t=>{const e=Us(t,n);n=e.updatedContent||n,o+=e.text,r.push(...e.charList)}),o.length!==r.length)throw new Error("Characters length mismatch!");return{charList:r,text:o,updatedContent:n!==e?n:void 0}},Us=(t,e)=>{switch(t.e){case Gn.A:{const e=t.t,n=t.f;return{charList:Hs(e,n),text:e}}case Gn.x:{const n=t.c,r=_s(n,e);return r.charList=r.charList.map(t=>(t=>o.CharacterMetadata.create({style:t.getStyle().add(k.k.SPOILER),entity:t.getEntity()}))(t)),r}case Gn.v:case Gn.g:case Gn.w:{const e=t.t;return{charList:Hs(e),text:e}}case Gn.y:case Gn.B:{var n=As(Ns[t.e],2);const o=n[0],r=n[1],i=(t.l?"/":"")+o+t.t,s=r+t.t,c=ws(e,Fs[t.e],s),a=c.getLastCreatedEntityKey();return{charList:Hs(i,void 0,a),text:i,updatedContent:c}}case Gn.o:{const n=t.t,o=t.u,r=t.f,i=ws(e,L.a.LINK,o),s=i.getLastCreatedEntityKey();return{charList:Hs(n,r,s),text:n,updatedContent:i}}default:return{text:"",charList:Hs("")}}},Hs=(t,e,n=null)=>{const r=o.CharacterMetadata.create({entity:n}),i=Array(t.length).fill(r),s=Object(ls.a)(t);return e&&e.forEach(t=>{var e=As(t,3);const r=e[0],c=e[1],a=e[2],l=(t=>{const e=Bs.filter(e=>!!(us[e]&t));return Object(D.OrderedSet)(e)})(r),d=c+a,u=o.CharacterMetadata.create({entity:n,style:l});i.fill(u,s[c],s[d])}),i},zs=t=>{t.blocks.length&&(t.blocks[0].getType()===k.b.TABLE_CELL&&Ps(t,[],k.b.UNSTYLED,void 0,void 0,!0),t.blocks[t.blocks.length-1].getType()===k.b.TABLE_CELL&&Ps(t,[],k.b.UNSTYLED))};var Vs=(t,e)=>{const n="string"==typeof t?JSON.parse(t):t;if(!n||!n.document||!n.document.length)return null;const r={blocks:[],content:o.ContentState.createFromText("")};n.document.forEach(t=>{Ks(r,t,e)}),0===r.blocks.length&&Ps(r,[],k.b.UNSTYLED),zs(r);const i=o.BlockMapBuilder.createFromArray(r.blocks),s=o.SelectionState.createEmpty(i.first().getKey());return r.content.merge({blockMap:i,selectionBefore:s,selectionAfter:s})},Ws=n("./src/reddit/constants/keycodes.ts"),$s=n("./src/reddit/selectors/economics.ts");n.d(e,"a",function(){return Xs});var qs=function(t,e){var n={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(n[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(t);r<o.length;r++)e.indexOf(o[r])<0&&(n[o[r]]=t[o[r]])}return n};Object(Li.b)({draftToRTFJson:ps,getMediaCount:K.f,getPendingThumbnailUploads:K.h,isAllMediaUploaded:K.k});const Zs="handled",Gs="not-handled",Ys=/^\s*$/,Js=20,Xs=h()(hr.a).withConfig({componentId:"s17rln7v-0"})(["background: ",";"],t=>Object(Wt.c)(t).post),Qs=h()(t=>{t.noBorder,t.customPlaceholder,t.initialHeight,t.initialMinHeight;var e=qs(t,["noBorder","customPlaceholder","initialHeight","initialMinHeight"]);return c.a.createElement("div",Object.assign({},e))}).withConfig({componentId:"s17rln7v-1"})(["."," {/* Resize handle has rendering issues in Chrome if background-color is not set */background-color: ",";color: ",";font-family: ",";height: ",";min-height: ","px;overflow: ",";padding: ",";resize: ",";/* Styles for custom placeholder */","}"," {/* Remove 0.1px width border to fix Safari cursor rendering problem. */border-left: none;}."," {/* There is an old scrolling bug in Draft.js when splitting long blocks* https://github.com/facebook/draft-js/issues/304\n* this line is a known workaround for that and can be safely removed when bug is fixed*/overflow: auto;}"],ln.a,t=>Object(Wt.c)(t).body,t=>Object(Wt.c)(t).bodyText,O.BODY_FONT_FAMILY,t=>t.initialHeight?`${t.initialHeight}px`:"unset",t=>`${t.initialHeight||t.initialMinHeight||gr.z}`,t=>t.initialHeight?"auto":"hidden",t=>t.noBorder?"0":`${gr.A}px ${gr.B}px`,t=>t.noBorder?"inherit":"vertical",t=>t.customPlaceholder?`\n      .public-DraftStyleDefault-block[data-offset-key="${t.customPlaceholder.blockKey}-0-0"]::after {\n        content: '${t.customPlaceholder.text}';\n        color: ${Object(Wt.c)(t).actionIcon};\n        position: absolute;\n        top: 0;\n        left: 0;\n        bottom: 0;\n        cursor: text;\n      }\n    `:"",".DraftEditor-editorContainer",ln.c),tc=Object(a.b)(()=>{const t=(()=>Object(l.a)(t=>t.uploads,(t,e)=>Object(v.e)(v.b.RTE_MEDIA,e.rteState.editorKey),(t,e)=>i()(t,t=>t.key.startsWith(e))))();return Object(l.c)({editorUploads:t,emotesEnabled:E.d.spEmotes,userHasEmotes:(t,e)=>!!e.destSubreddit&&e.destSubreddit.id&&Object($s.o)(t,e.destSubreddit.id)})},t=>({onFetchEmotes:e=>t(Object(b.c)(e)),onTrackMediaDrop:e=>t((t,n)=>x.l(n(),e)),retryUpload:e=>t(y.a(e)),startUploads:(e,n,o)=>t(y.b(e,n,o))}));class ec extends s.Component{constructor(t){super(t),this.blockRenderMap=o.DefaultDraftBlockRenderMap.merge(Rr,Br,Pn,Bi,Mi,Gi,hn),this.editorHeight=null,this.editorRef=null,this.editorRootStyleMutationObserver=null,this.linksControllerApi=null,this.subredditDropdownApi=null,this.tableToolbarControllerApi=null,this.emotesTooltipApi=null,this.updateSubredditDropdownPosition=null,this.isJustAutocompleteSelected=!1,this.isJustLinkified=!1,this.isMouseDown=!1,this.isJustConvertedToList=!1,this.needSyncScroll=null,this.transforms={[j.BREAK_HEADER_ENTITY]:Bo.b,[j.INSERT_LINE_BREAK]:Bo.e,[j.REDUCE_LIST_INDENT]:Bo.f,[j.RESET_CURRENT_AND_PREVIOUS_BLOCKS]:Bo.g,[j.REMOVE_EXTRA_LIST_ITEM]:Bo.h,[R.d]:rr,[R.b]:or,[R.f]:Bo.d,[R.c]:t=>Object(Bo.c)(k.k.BOLD,t),[R.e]:t=>Object(Bo.c)(k.k.ITALIC,t),[R.g]:t=>Object(Bo.c)(k.k.UNDERLINE,t)},this.setContainerRef=(t=>{const e=this.props.domRef;e&&e(t),this.setState({containerRef:t})}),this.setFocusableContentRef=(t=>this.setState({focusableContentRef:t})),this.rteStateChanged=((t,e)=>{const n=Object.assign({},this.props.rteState,{isBound:!0,editorState:t});this.props.onChange(n,e)}),this.hideTooltips=(()=>{this.emotesTooltipApi&&this.emotesTooltipApi.closeTooltip(),this.tableToolbarControllerApi&&this.tableToolbarControllerApi.hideActionButton(),this.linksControllerApi&&this.linksControllerApi.hidePopup(),this.suppressAutocompleteForFocusedLink()}),this.onEditorStyleChanged=(()=>{if(!this.editorRef)return;const t=this.editorRef.refs.editor,e=t.style.height?Number.parseInt(t.style.height):null;this.editorHeight!==e&&(this.hideTooltips(),this.editorHeight=e,e&&this.props.onEditorResize&&this.props.onEditorResize(e))}),this.insertValidatedMedia=(()=>{const t=this.props.editorUploads;var e=this.state;const n=e.editorState,o=e.mediaToInsert;if(!o)return;const r=o.files,i=o.blockKey,s=o.insertionMode,c=r.map(e=>t.find(t=>t.file===e)).filter(Boolean);this.setState({mediaToInsert:null});const a=c.filter(t=>!!t.metadata.mimetype);a.length&&this.onChange(Object(K.j)(n,a,i,s))}),this.focus=(()=>this.editorRef&&this.editorRef.focus()),this.blur=(()=>this.editorRef&&this.editorRef.blur()),this.isFocused=(()=>this.state.editorState.getSelection().getHasFocus()),this.setEditorRef=(t=>this.editorRef=t),this.setSubredditDropdownApi=(t=>this.subredditDropdownApi=t),this.setLinksControllerApi=(t=>this.linksControllerApi=t),this.setTableToolbarControllerApi=(t=>this.tableToolbarControllerApi=t),this.setEmotesTooltipApi=(t=>this.emotesTooltipApi=t),this.setSubredditDropdownPositionUpdater=(t=>this.updateSubredditDropdownPosition=t),this.getEditorState=(()=>this.state.editorState),this.setEditorState=((t,e)=>{const n=this.state.editorState.getCurrentContent()!==t.getCurrentContent();n&&this.props.readOnly||(this.setState({editorState:t},e),this.rteStateChanged(t,n))}),this.toolbarSetState=(t=>{const e=t.getInlineStyleOverride();let n=t;n.getSelection().getHasFocus()||(n=o.EditorState.forceSelection(n,n.getSelection()),e&&(n=o.EditorState.setInlineStyleOverride(n,e))),this.onChange(n)}),this.onChange=((t,e)=>{let n=t;n=Rn(n,this.state.editorState),n=Dt(n),n=Jo(n,this.state.editorState),n=Object(lr.d)(n,this.state.editorState),this.state.shouldShowFtuMessage&&this.state.editorState.getCurrentContent()!==t.getCurrentContent()&&this.setState({shouldShowFtuMessage:!1}),this.setEditorState(n,e);let o=this.state.suppressAutocompleteForLink;if(o){const e=Object(zo.c)(t);e&&e.entityKey===o||(o=null)}this.setState({suppressAutocompleteForLink:o}),this.isJustAutocompleteSelected=!1,this.isJustLinkified=!1,this.isMouseDown=!1,this.isJustConvertedToList=!1}),this.onFocus=(()=>{var t=this.props;const e=t.enableFtuMessage,n=t.onFocus;e&&this.setState({shouldShowFtuMessage:!0}),n&&n()}),this.handleBeforeInput=(t=>{const e=this.state.editorState;if(this.isMouseDown)return Zs;if(Lt(e,t))return Zs;let n=function(t,e){const n=t.getSelection(),r=n.getFocusOffset();if(!n.isCollapsed()||0===r)return;const i=n.getFocusKey(),s=t.getCurrentContent(),c=s.getBlockForKey(i),a=c.getEntityAt(r-1),l=c.getEntityAt(r);if(!a||l&&l===a)return;const d=s.getEntity(a),u=Ho.has(d.getType());if("MUTABLE"===d.getMutability()&&u){const r=o.Modifier.insertText(s,n,e,t.getCurrentInlineStyle());return o.EditorState.push(t,r,"insert-characters")}}(e,t)||e;return(n=kn(n,t)||n)!==e?(this.onChange(n),Zs):Gs}),this.keyBindingFN=(t=>{const e=this.state.editorState,n=this.props.submitOnEnter,r=e.getSelection();if(t.metaKey&&t.keyCode===Ws.a.K)return j.OPEN_LINK_TOOLTIP;if(t.keyCode===Ws.a.Space){if(cr(e))return j.CONVERT_TO_LIST_ON_SPACE;if(Object(zo.d)(e))return j.LINKIFY_ON_SPACE}else if(t.keyCode===Ws.a.Enter){if(t.ctrlKey||t.metaKey||n&&!t.shiftKey)return j.SUBMIT;if(t.shiftKey&&ir(e))return j.INSERT_LINE_BREAK;{const t=this.enterKeyBinding(e);if(t)return t}}else if(t.keyCode===Ws.a.Backspace){if(this.isJustLinkified||this.isJustConvertedToList)return R.h;if(r.isCollapsed()){const t=e.getCurrentContent(),n=r.getEndKey(),o=r.getStartOffset(),i=t.getBlockForKey(n),s=i.getType();if((Object(k.s)(s)||Object(k.q)(s)||Object(k.p)(s))&&0===o&&i.getLength()>0){const e=t.getBlockBefore(n);if(!e||e.getType()!==s)return j.MAKE_PLAIN_BLOCK}}}return Object(o.getDefaultKeyBinding)(t)}),this.handleKeyCommand=(t=>{const e=this.state.editorState;let n=t,r=null;const i=t=>{let e=t;if(r){var n=r;const t=n.selection,o=n.url;e=Object(zo.f)(e,t,o)}return this.onChange(e),this.isJustLinkified=!!r,Zs};if(n===j.SUBMIT)this.props.onSubmit();else{if(n===j.CONVERT_TO_LIST_ON_SPACE){const t=i(ar(e));return this.isJustConvertedToList=!0,t}if(n===j.LINKIFY_ON_SPACE)return r=Object(zo.d)(e),i(Object(Bo.a)(e));if(n===j.LINKIFY_ON_ENTER&&(r=Object(zo.d)(e),!(n=this.enterKeyBinding(e,!1))))return i(Object(Bo.d)(e))}if(n===j.OPEN_LINK_TOOLTIP)return this.onToolbarLinkButtonClick(),Zs;if(n===j.MAKE_PLAIN_BLOCK){return i(Object(Bo.i)(k.n,e))}if(n===j.EXEC_TABLE_ON_ENTER_HANDLER)return i(this.tableOnEnterHandler.handle(e));const s=this.transforms[n];if(s){const t=s(e);if(t)return i(t)}const c=o.RichUtils.handleKeyCommand(e,n);return c?i(c):Gs}),this.handleOnTab=(t=>{if(this.subredditDropdownApi&&this.subredditDropdownApi.selectCurrent())return void t.preventDefault();const e=this.state.editorState;let n=xn(t,e);if(n=n||nr(t,e))return void this.onChange(n);const r=o.RichUtils.onTab(t,e,2);this.onChange(r)}),this.handleOnUpArrow=(t=>{if(this.subredditDropdownApi&&this.subredditDropdownApi.moveUp())return void t.preventDefault();const e=Sn(t,this.state.editorState)||Kt(t,this.state.editorState);e&&this.onChange(e),this.needSyncScroll=vs.Up}),this.handleOnDownArrow=(t=>{if(this.subredditDropdownApi&&this.subredditDropdownApi.moveDown())return void t.preventDefault();const e=Cn(t,this.state.editorState)||Mt(t,this.state.editorState);e&&this.onChange(e),this.needSyncScroll=vs.Down}),this.handleReturn=(t=>{const e=At(this.state.editorState);return e?(this.onChange(e),t.preventDefault(),Zs):this.subredditDropdownApi&&this.subredditDropdownApi.selectCurrent()?(t.preventDefault(),Zs):Gs}),this.suppressAutocompleteForFocusedLink=(()=>{const t=Object(zo.c)(this.state.editorState);t&&this.state.suppressAutocompleteForLink!==t.entityKey&&this.setState({suppressAutocompleteForLink:t.entityKey})}),this.handleEscape=(t=>{this.suppressAutocompleteForFocusedLink()}),this.handleOnCopy=(t=>{this.editorRef&&St(this.state.editorState,this.editorRef,t)}),this.handleOnCut=(t=>{const e=this.state.editorState;if(!this.editorRef)return;if(!St(e,this.editorRef,t))return;const n=at(e)||Rt(e)||Object(K.d)(e);n&&this.onChange(n)}),this.handleOnPaste=(t=>{const e=this.state.editorState;if(!this.editorRef)return;if(this.handleFilesPaste(t,e),t.isPropagationStopped())return;const n=ei(e,this.editorRef,t);n&&this.onChange(n)}),this.handleFilesPaste=((t,e)=>{const n=t.clipboardData.files;if(n&&n.length){const o=Array.from(n),r=e.getSelection().getEndKey();this.insertMediaFiles({files:o,blockKey:r,insertionMode:M.a.after,filesSource:f.FileSource.Clipboard}),t.stopPropagation()}}),this.handleOnMouseDown=(t=>{this.isMouseDown=!0}),this.handleOnMouseUp=(t=>{this.isMouseDown=!1}),this.handleDroppedFiles=((t,e)=>Zs),this.handleDrop=((t,e,n)=>Zs),this.handlePastedText=((t,e)=>Zs),this.onSubredditSuggestionSelected=(t=>{this.onChange(Object(zo.g)(this.state.editorState,t)),this.isJustAutocompleteSelected=!0}),this.onToolbarEmoteButtonClick=(t=>{this.emotesTooltipApi&&this.emotesTooltipApi.toggleTooltip(t)}),this.onToolbarLinkButtonClick=(()=>{if(!this.linksControllerApi)return;const t=this.state.editorState;this.linksControllerApi.editLinkInSelection(t.getSelection())||Object(m.b)(void 0,"Current selection cannot be edited by link editor!")}),this.onToolbarFtuTooltipClick=(()=>{this.setState({shouldShowFtuMessage:!1})}),this.handleSwitchToMarkdownMode=(()=>{const t=this.state.editorState,e=this.props.onSwitchEditorMode,n=Li.a.toRichTextJSON(Object.assign({},this.props.rteState,{isBound:!0,editorState:t}));e&&e(C.h.MARKDOWN,n),this.state.confirmModalOpen&&this.toggleConfirmModal()}),this.onToolbarMarkdownSwitchClick=(()=>{const t=this.state.editorState;t&&Xo(t)?this.setState({confirmModalOpen:!0}):this.handleSwitchToMarkdownMode()}),this.toggleConfirmModal=(()=>{this.setState({confirmModalOpen:!this.state.confirmModalOpen})}),this.onToolbarOverflowMenuClick=(()=>{this.setState({shouldShowFtuMessage:!1})}),this.insertMediaFiles=(async t=>{this.setState({mediaToInsert:t});const e=t.files,n=t.filesSource,o=e.slice(0,Js);await this.props.startUploads(o,n,this.props.rteState.editorKey),this.insertValidatedMedia()}),this.onRetryUpload=(t=>{this.props.retryUpload(t)}),this.onFilesSelect=(t=>{const e=this.state.editorState.getSelection().getEndKey();this.insertMediaFiles({files:t,blockKey:e,insertionMode:M.a.after,filesSource:f.FileSource.FileSelector})}),this.onFilesDrop=((t,e,n)=>{this.props.onTrackMediaDrop(t),this.insertMediaFiles({files:t,blockKey:e,insertionMode:n,filesSource:f.FileSource.DragAndDrop})}),this.onBlockMove=((t,e,n)=>{const o=this.state.editorState,r=Object(K.m)(o,t,e,n);r&&this.onChange(r)}),this.getAtomicBlocksRenderConfig=(()=>({component:an,props:{getEditorState:this.getEditorState,onChange:this.onChange,onRetryUpload:this.onRetryUpload,rteFocusableContentRef:this.state.focusableContentRef}})),this.blockRendererFn=(t=>{const e=t.getType();return e===k.a?this.getAtomicBlocksRenderConfig():e in Wi?Wi[e]:void 0}),this.renderToolbar=(t=>c.a.createElement(Ve.b,Object.assign({},t))),this.entityElementRegistry=Ko(),this.tableOnEnterHandler=new vn;const e=t.noBorder,n=t.initialHeight,r=t.initialMinHeight,i=t.rteState;let s;i.isBound?s=i.editorState:Object(Gn.E)(i.initialRTJSON)?s=this.createInitialState(i.editorKey):(s=o.EditorState.createWithContent(Vs(i.initialRTJSON,i.mediaMetadataMap),this.editorDecorators()),s=this.moveSelectionToEnd(s)),this.state={noBorder:e,containerRef:null,confirmModalOpen:!1,editorState:s,focusableContentRef:null,inited:!1,initialHeight:n,initialMinHeight:r,mediaToInsert:null,shouldShowFtuMessage:!1,suppressAutocompleteForLink:null}}editorDecorators(){return new o.CompositeDecorator([Po(),pr(),$o()])}moveSelectionToEnd(t){const e=t.getCurrentContent().getBlockMap(),n=e.last().getKey(),r=e.last().getLength(),i=new o.SelectionState({anchorKey:n,anchorOffset:r,focusKey:n,focusOffset:r});return o.EditorState.acceptSelection(t,i)}createInitialState(t){return o.EditorState.createWithContent(o.ContentState.createFromBlockArray([new o.ContentBlock({key:`${t}_initial`})]),this.editorDecorators())}componentDidMount(){if(this.props.rteRef&&this.props.rteRef(this),g.a.write(qi),this.rteStateChanged(this.state.editorState,!1),this.editorRef){const t=this.editorRef.refs.editor;t.addEventListener("scroll",this.hideTooltips),this.editorRootStyleMutationObserver=new MutationObserver(this.onEditorStyleChanged),this.editorRootStyleMutationObserver.observe(t,{attributes:!0,attributeFilter:["style"]})}const t=this.props.destSubreddit;this.props.emotesEnabled&&t&&t.id&&this.props.onFetchEmotes(t.id)}componentDidUpdate(t,e){const n=this.getLinkForAutocomplete();if(n&&this.updateSubredditDropdownPosition){const t=this.entityElementRegistry.get(n.entityKey);if(t){var o=t.getBoundingClientRect();const e=o.left,n=o.bottom;this.updateSubredditDropdownPosition({left:e,top:n})}}this.needSyncScroll&&(js(this.needSyncScroll),this.needSyncScroll=null)}componentWillUnmount(){if(this.props.rteRef&&this.props.rteRef(null),this.insertValidatedMedia=(()=>{}),this.editorRef){this.editorRef.refs.editor.removeEventListener("scroll",this.hideTooltips)}this.editorRootStyleMutationObserver&&(this.editorRootStyleMutationObserver.disconnect(),this.editorRootStyleMutationObserver=null)}componentWillReceiveProps(t){t.rteState!==this.props.rteState&&t.rteState.isBound&&t.rteState.editorState!==this.state.editorState&&this.setState({editorState:t.rteState.editorState})}shouldComponentUpdate(t,e){if(e!==this.state)return!0;if(!(t.rteState.isBound&&t.rteState.editorState===this.state.editorState))return!0;return!u()(t,this.props,(t,e,n)=>"rteState"===n||void 0)}enterKeyBinding(t,e=!0){const n=t.getCurrentContent(),o=t.getSelection(),r=o.getStartKey(),i=o.getEndKey(),s=o.getEndOffset(),c=n.getBlockForKey(r).getType(),a=n.getBlockForKey(i),l=a.getType(),d=s===a.getText().length;if(c===k.l||l===k.l)return j.EXEC_TABLE_ON_ENTER_HANDLER;if(o.isCollapsed()){if(e&&Object(zo.d)(t))return j.LINKIFY_ON_ENTER;if(Object(k.r)(l)&&d)return j.BREAK_HEADER_ENTITY;if(Object(k.s)(l)){if(Ys.test(a.getText()))return a.getDepth()>0?j.REDUCE_LIST_INDENT:j.REMOVE_EXTRA_LIST_ITEM}else if(l===k.e){const t=n.getBlockBefore(i);if(t&&t.getType()===k.e&&Ys.test(t.getText())&&Ys.test(a.getText()))return j.RESET_CURRENT_AND_PREVIOUS_BLOCKS}else if(l===k.f){const t=n.getBlockBefore(i),e=n.getBlockAfter(i);if(!a.getText()&&t&&t.getType()===k.f&&!t.getText()&&(!e||e.getType()!==k.f))return j.RESET_CURRENT_AND_PREVIOUS_BLOCKS}}}getLinkForAutocomplete(){var t=this.state;const e=t.editorState,n=t.suppressAutocompleteForLink;if(!this.isJustAutocompleteSelected&&e.getSelection().getHasFocus()){const t=Object(zo.c)(e);if(t&&t.entityKey!==n)return t}}renderSubredditDropdown(){const t=this.getLinkForAutocomplete();return t?c.a.createElement(Hn.b,{onSetPositionUpdater:this.setSubredditDropdownPositionUpdater},c.a.createElement(Tr,{onDropdownApi:this.setSubredditDropdownApi,substring:t.subredditName,onSelect:this.onSubredditSuggestionSelected})):null}render(){var t=this.props;const e=t.className;var n=t.allowMedia;const r=void 0!==n&&n,i=t.dataTestId,s=t.destSubreddit,a=t.userHasEmotes,l=t.hideToolbar,d=t.rteState,u=t.isOverlay,p=t.language,h=t.placeholderText;var g=t.toolbarPosition;const m=void 0===g?"top":g;var f=t.renderToolbar;const b=void 0===f?this.renderToolbar:f,y=d.editorKey;var E=this.state;const O=E.containerRef,x=E.editorState,C=E.mediaToInsert,v=E.shouldShowFtuMessage,k=E.confirmModalOpen,j=this.props.readOnly||!!C,T=w(x),R=T?{text:h,blockKey:T}:null,A=b({allowMedia:r,destSubreddit:s,editorKey:y,editorState:x,isOverlay:!!u,language:p,onChange:this.toolbarSetState,onFilesSelect:this.onFilesSelect,trackOnClick:this.props.trackToolbarClick,readOnly:j,onFtuTooltipClick:this.onToolbarFtuTooltipClick,onEmoteButtonClick:a?this.onToolbarEmoteButtonClick:void 0,onLinkButtonClick:this.onToolbarLinkButtonClick,onMarkdownButtonClick:this.onToolbarMarkdownSwitchClick,onOverflowMenuClick:this.onToolbarOverflowMenuClick,shouldShowFtuMessage:v});return c.a.createElement("div",{className:e,ref:this.setContainerRef},c.a.createElement(Xs,{noBorder:this.props.noBorder,isFocused:this.isFocused(),innerRef:this.setFocusableContentRef,"data-redditstyle":!0},!l&&"top"===m&&A,O&&c.a.createElement(Ao,{editorState:x,readOnly:j,language:p,onChange:this.onChange,onSetApi:this.setTableToolbarControllerApi,rteDomRef:O}),c.a.createElement(Qs,{noBorder:this.props.noBorder,"data-test-id":i,initialHeight:this.props.initialHeight,initialMinHeight:this.props.initialMinHeight,onCopyCapture:this.handleOnCopy,onCutCapture:this.handleOnCut,onPasteCapture:this.handleOnPaste,onMouseDown:this.handleOnMouseDown,onMouseUp:this.handleOnMouseUp,customPlaceholder:R},c.a.createElement(Ur,{allowMedia:r&&!j,onBlockMove:this.onBlockMove,onFilesDrop:this.onFilesDrop,editorState:x,onChange:this.onChange},c.a.createElement(Mo.Provider,{value:this.entityElementRegistry},c.a.createElement(o.Editor,{readOnly:j,ref:this.setEditorRef,blockRendererFn:this.blockRendererFn,blockRenderMap:this.blockRenderMap,editorKey:y,editorState:x,keyBindingFn:this.keyBindingFN,handleBeforeInput:this.handleBeforeInput,handleKeyCommand:this.handleKeyCommand,handlePastedText:this.handlePastedText,handleDroppedFiles:this.handleDroppedFiles,handleDrop:this.handleDrop,onBlur:this.props.onBlur,onChange:this.onChange,onFocus:this.onFocus,onTab:this.handleOnTab,onUpArrow:this.handleOnUpArrow,onDownArrow:this.handleOnDownArrow,onEscape:this.handleEscape,spellCheck:!0,handleReturn:this.handleReturn,customStyleMap:Di()})))),!l&&"bottom"===m&&A,c.a.createElement(Ri,{editorState:x,entityElementRegistry:this.entityElementRegistry,language:p,onSetApi:this.setLinksControllerApi,onChange:this.onChange}),a&&s&&c.a.createElement(Uo,{editorState:x,onChange:this.onChange,onSetApi:this.setEmotesTooltipApi,subreddit:s}),this.renderSubredditDropdown()),k&&c.a.createElement(I.a,{toggleModal:this.toggleConfirmModal,onConfirm:this.handleSwitchToMarkdownMode,actionText:"continue",cancelActionText:"cancel",headerText:Object(S.c)("Switch to Markdown"),modalText:Object(S.c)("Switching to markdown will remove any images, gifs or videos from your post."),trackClick:()=>{}}))}}e.b=tc(Object(mr.b)(t=>c.a.createElement(ec,Object.assign({key:t.rteState.editorKey},t))))},"./src/reddit/components/RichTextEditor/media/MediaBlock/Toolbar/index.m.less":function(t,e,n){t.exports={container:"_3hDtN0e5U4EpahGe25ye-b",content:"_3wXzBVn-uBvRcixZwQWkNX"}},"./src/reddit/components/RichTextEditor/media/helpers.ts":function(t,e,n){"use strict";n.d(e,"a",function(){return o}),n.d(e,"g",function(){return m}),n.d(e,"o",function(){return f}),n.d(e,"j",function(){return b}),n.d(e,"l",function(){return y}),n.d(e,"n",function(){return E}),n.d(e,"c",function(){return O}),n.d(e,"d",function(){return x}),n.d(e,"k",function(){return C}),n.d(e,"f",function(){return v}),n.d(e,"i",function(){return k}),n.d(e,"h",function(){return j}),n.d(e,"m",function(){return w}),n.d(e,"b",function(){return T}),n.d(e,"e",function(){return R});var o,r=n("./node_modules/draft-js/lib/Draft.js"),i=n("./node_modules/immutable/dist/immutable.js"),s=n("./node_modules/lodash/flatten.js"),c=n.n(s),a=n("./node_modules/lodash/last.js"),l=n.n(a),d=n("./src/reddit/helpers/media/index.ts"),u=n("./src/reddit/models/Upload/index.ts"),p=n("./src/reddit/components/RichTextEditor/constants/editorChangeTypes.ts"),h=n("./src/reddit/components/RichTextEditor/helpers/common.ts"),g=n("./src/reddit/components/RichTextEditor/styleAndBlockTypes.ts");!function(t){t[t.Image=0]="Image",t[t.AnimatedImage=1]="AnimatedImage",t[t.Video=2]="Video"}(o||(o={}));const m=t=>{if(!Object(g.o)(t.getType()))return;const e=t.getData(),n=e.get("mediaAsset"),o=e.get("uploadInfo");if(!n&&!o)return;const r=e.get("thumbnail");return{makeGif:e.get("makeGif"),thumbnail:r,uploadInfo:o,mediaAsset:n}},f=(t,e,n)=>{let o=t.getCurrentContent();const s=o.getBlockForKey(e),c=m(s),a=c&&c.uploadInfo;if(!a)throw new Error("Block must contain `uploadInfo` data");if(n.makeGif===c.makeGif&&n.thumbnail===c.thumbnail)return t;const l=Object(i.Map)(n),d=o.getBlockMap().toKeyedSeq().filter(t=>{const e=m(t);return!!e&&!!e.uploadInfo&&e.uploadInfo.uploadKey===a.uploadKey}).map(t=>t.mergeIn(["data"],l));return o=(o=o.mergeIn(["blockMap"],d)).merge({selectionAfter:t.getSelection()}),r.EditorState.push(t,o,p.a)},b=(t,e,n,o)=>{let s=t.getCurrentContent();const a=c()(e.map(t=>{const e=Object(d.f)(t.metadata.mimetype),n=(t=>{if(t&&t.metadata.videoFirstFrameUrl)return{url:t.metadata.videoFirstFrameUrl,time:0}})(t);return[new r.ContentBlock({key:Object(r.genKey)(),type:g.a,data:Object(i.Map)({uploadInfo:{mediaType:e,uploadKey:t.key},thumbnail:n})}),new r.ContentBlock({key:Object(r.genKey)(),type:g.j})]}));s=Object(h.f)(s,n,a,o);const u=r.EditorState.push(t,s,p.d),m=l()(a);return r.EditorState.forceSelection(u,Object(h.b)(m,!0))};function y(t,e){return t.isCollapsed()&&t.getStartKey()===e&&0===t.getStartOffset()&&0===t.getEndOffset()}function E(t,e){const n=t.getCurrentContent().getBlockAfter(e);return r.EditorState.forceSelection(t,Object(h.b)(n,!0))}const O=(t,e,n=!0)=>{let o=t.getCurrentContent();const i=o.getBlockAfter(e);o=Object(h.h)(o,e),i&&Object(g.u)(i.getType())&&(o=Object(h.h)(o,i.getKey()));let s=n?r.EditorState.push(t,o,p.e):r.EditorState.set(t,{currentContent:o});return s=r.EditorState.forceSelection(s,o.getSelectionAfter())},x=t=>{let e=t.getCurrentContent();const n=t.getSelection();e=r.Modifier.removeRange(e,n,"forward");let o=r.EditorState.push(t,e,p.e);return o=r.EditorState.forceSelection(o,e.getSelectionAfter())},S=t=>t.getBlockMap().toSeq().filter(t=>!!t&&!!m(t)),C=(t,e)=>t.getBlockMap().toSeq().filter(t=>{const n=m(t),o=n&&n.uploadInfo&&n.uploadInfo.uploadKey;return!(!o||e[o]&&e[o].url)}).isEmpty(),v=t=>{const e=S(t),n={gifvideo:0,image:0,video:0,total:0};return e.forEach(t=>{const e=m(t);let r;r=e.makeGif?"gifvideo":e.uploadInfo&&"video"===e.uploadInfo.mediaType||e.mediaAsset&&e.mediaAsset.type===o.Video?"video":"image",n[r]++,n.total++}),n},k=t=>!S(t).isEmpty(),j=(t,e)=>{const n=S(t).map(t=>{const n=m(t),o=n.uploadInfo,r=n.thumbnail;if(!o||!r)return;const i=I(n),s=e[i];return s&&s.url?void 0:Object.assign({},r,{uploadKey:i})}).filter(Boolean).toArray();return n.length?n:void 0},w=(t,e,n,o)=>{let i=t.getCurrentContent();const s=i.getBlockForKey(e),c=i.getBlockAfter(e);if(e===n||n===c.getKey())return;const a=i.getBlockMap().remove(e).remove(c.getKey());i=i.set("blockMap",a),i=Object(h.f)(i,n,[s,c],o);const l=r.EditorState.push(t,i,p.d);return r.EditorState.forceSelection(l,Object(h.b)(c,!0))},T=(t,e,n=h.a.after)=>{const o=Object(h.g)(),i=Object(h.f)(t.getCurrentContent(),e,[o],n),s=r.EditorState.push(t,i,p.d);return r.EditorState.forceSelection(s,r.SelectionState.createEmpty(o.getKey()))},I=t=>t.thumbnail&&t.uploadInfo?`${t.uploadInfo.uploadKey}-thumbnail-${t.thumbnail.time}`:"",R=(t,e)=>{let n="",o="";if(t.uploadInfo){const r=e[t.uploadInfo.uploadKey];r&&r.url&&(n=Object(u.c)(r.url));const i=e[I(t)];i&&i.url&&(o=Object(u.c)(i.url))}return{assetId:n,thumbnailAssetId:o}}},"./src/reddit/components/RichTextEditor/spoiler/helpers.ts":function(t,e,n){"use strict";n.d(e,"b",function(){return i}),n.d(e,"a",function(){return s});var o=n("./src/lib/forEachGroup/index.ts"),r=n("./src/reddit/components/RichTextEditor/styleAndBlockTypes.ts");const i=t=>t.getStyle().has(r.k.SPOILER);function s(t,e,n){const r=t.getCharacterList();Object(o.a)(r,{keyFn:i},(t,n,o,r)=>{n&&e(o,r)})}},"./src/reddit/components/RichTextEditor/table/helpers.ts":function(t,e,n){"use strict";n.d(e,"a",function(){return a}),n.d(e,"g",function(){return l}),n.d(e,"m",function(){return u}),n.d(e,"n",function(){return p}),n.d(e,"j",function(){return h}),n.d(e,"l",function(){return g}),n.d(e,"f",function(){return m}),n.d(e,"k",function(){return f}),n.d(e,"c",function(){return b}),n.d(e,"h",function(){return y}),n.d(e,"b",function(){return E}),n.d(e,"i",function(){return O}),n.d(e,"e",function(){return x}),n.d(e,"o",function(){return S}),n.d(e,"d",function(){return C});var o=n("./node_modules/draft-js/lib/Draft.js"),r=n("./node_modules/immutable/dist/immutable.js"),i=n("./src/reddit/models/RichTextJson/index.ts"),s=n("./src/reddit/components/RichTextEditor/helpers/sliceContiguousBlocks.ts"),c=n("./src/reddit/components/RichTextEditor/styleAndBlockTypes.ts");const a={[i.e]:"left",[i.f]:"right",[i.d]:"center"},l=t=>{const e=t.getData();return{colIndex:e.get("colIndex"),rowIndex:e.get("rowIndex"),colCount:e.get("colCount"),alignment:e.get("alignment")}},d=["data"],u=(t,e)=>t.mergeIn(d,e),p=(t,e,n)=>t.merge({text:t.getText().slice(e,n),characterList:t.getCharacterList().slice(e,n)}),h=(t,e,n="",r)=>{const i=e.map(t=>t.getText()).join(n),s=n?r||o.CharacterMetadata.create():null,c=[];return e.forEach(t=>{c.push(...t.getCharacterList().toArray()),s&&e.length>1&&c.push(s)}),t.merge({text:i,characterList:c})},g=(t,e)=>{const n=[];for(let i=0;i<e;i++)for(let e=0;e<t;e++)n.push(new o.ContentBlock({key:Object(o.genKey)(),type:c.l,data:Object(r.Map)({colCount:t,colIndex:e,rowIndex:i})}));return n},m=(t,e)=>({minCol:Math.min(t.colIndex,e.colIndex),minRow:Math.min(t.rowIndex,e.rowIndex),maxCol:Math.max(t.colIndex,e.colIndex),maxRow:Math.max(t.rowIndex,e.rowIndex)}),f=(t,e)=>{var n=m(t,e);const o=n.minCol,r=n.minRow,i=n.maxCol,s=n.maxRow;return(t,e)=>r<=t&&t<=s&&o<=e&&e<=i},b=(t,e)=>t.rowIndex<e.rowIndex?-1:t.rowIndex>e.rowIndex?1:t.colIndex-e.colIndex,y=(t,e)=>t===e||!(!t||!e)&&0===b(t,e),E=(t,e)=>b(l(t),l(e)),O=t=>{if(Object(c.v)(t.getType())){return 0===l(t).rowIndex}return!1},x=(t,e,n)=>{const o=(e,n)=>{if(e){const o=Object(s.a)(t,e);return o&&n&&-1!==o.blocks.indexOf(n)?[o,o]:[o,n?Object(s.a)(t,n):null]}return n?o(n,null).reverse():[null,null]};return o(Object(c.v)(e.getType())?e:null,Object(c.v)(n.getType())?n:null)},S=(t,e,n,o=!1)=>{const r={isBackward:o};return e&&(r.anchorKey=e.getKey(),r.anchorOffset=o?e.getLength():0),n&&(r.focusKey=n.getKey(),r.focusOffset=o?0:n.getLength()),t.merge(r)},C=t=>{if(!t.length)return[];const e=t[0].length;return t.map((t,n)=>t.map((t,o)=>u(t,{rowIndex:n,colIndex:o,colCount:e})))}},"./src/reddit/components/ThumbnailSelector/index.tsx":function(t,e,n){"use strict";var o=n("./node_modules/lodash/debounce.js"),r=n.n(o),i=n("./node_modules/lodash/range.js"),s=n.n(i),c=n("./node_modules/react/index.js"),a=n.n(c),l=n("./bundled-modules/styled-components/styled-components.min.js"),d=n.n(l),u=n("./src/app/strings/index.ts"),p=n("./src/higherOrderComponents/asModal.tsx"),h=n("./src/reddit/controls/Button/index.tsx"),g=n("./src/reddit/helpers/media/index.ts"),m=n("./src/reddit/helpers/styles/mixins/loading.ts"),f=n("./src/reddit/icons/svgs/Close/index.tsx"),b=n("./src/reddit/layout/row/Inline/index.tsx"),y=n("./src/reddit/models/Theme/NewColorSystem/index.ts");const E=10,O=Object(u.e)("postCreation.cancel"),x=Object(u.e)("postCreation.select"),S=Object(u.e)("postCreation.mediaInput.chooseThumbnail"),C=Object(p.a)(d.a.div.withConfig({componentId:"s6nhzjr-0"})(["box-sizing: border-box;max-width: 80vw;border-radius: 4px;background-color: ",";border: 1px solid ",";box-shadow: 0 0 0 1px ",",0px 2px 3px 2px ",";"],t=>Object(y.c)(t).body,t=>Object(y.c)(t).line,t=>Object(y.c)(t).line,t=>Object(y.c)(t).line)),v=d()(b.a).withConfig({componentId:"s6nhzjr-1"})(["font-size: 16px;padding: 8px 16px;"]),k=d()(f.a).withConfig({componentId:"s6nhzjr-2"})(["height: 16px;width: 16px;padding: 4px;fill: ",";"],t=>Object(y.c)(t).actionIcon),j=d.a.div.withConfig({componentId:"s6nhzjr-3"})(["cursor: pointer;margin-left: auto;"]),w=d.a.div.withConfig({componentId:"s6nhzjr-4"})(["padding: 8px 0;border-bottom: 1px solid ",";border-top: 1px solid ",';display: flex;overflow-x: scroll;max-width: 600px;&:after {content: "";flex: 0 0 4px}'],t=>Object(y.c)(t).line,t=>Object(y.c)(t).line),T=d.a.img.withConfig({componentId:"s6nhzjr-5"})(["max-width: 100%;max-height: 100%;border-radius: 4px;"]),I=d()(t=>a.a.createElement("div",{className:t.className,onClick:t.onClick,ref:t.elementRef},t.thumbnail.url&&a.a.createElement(T,{src:t.thumbnail.url}))).withConfig({componentId:"s6nhzjr-6"})(["display: flex;flex: 0 0 auto;align-items: center;justify-content: center;height: 100px;width: 178px;margin: 4px;cursor: pointer;border-radius: 4px;border: ",";",";"],t=>t.isSelected?`3px solid ${Object(y.c)(t).active}`:`3px solid ${Object(y.c)(t).line}`,m.c),R=d()(b.a).withConfig({componentId:"s6nhzjr-7"})(["padding: 16px 10px;justify-content: flex-end;"]),A=h.f,B=d()(h.i).withConfig({componentId:"s6nhzjr-8"})(["margin-right: 10px;"]),K=(t,e)=>{if(1===t)return[0];const n=s()(0,e,e/(t-1));return n.push(e),n.map(t=>+t.toFixed(2))};e.a=class extends a.a.Component{constructor(t){super(t),this.isThumbnailsAreGenerating=!1,this.setSelectedElementRef=(t=>this.selectedElement=t),this.setThumbnails=r()(t=>this.setState({thumbnails:t}),100),this.scrollIntoView=(()=>{this.selectedElement&&this.selectedElement.scrollIntoView({})}),this.setSelected=(t=>{this.setState({selectedIndex:t})}),this.onSelectButton=(()=>{const t=this.state.selectedIndex,e=this.state.thumbnails[t];this.props.onSelect({time:e.time,url:e.url})});var e=this.props,n=e.thumbnailsCount;const o=void 0===n?E:n,i=e.selected,s=e.videoDuration,c=K(o,s).map(t=>({time:t,url:i&&i.time===t?i.url:void 0})),a=i?c.findIndex(t=>i.time===t.time):-1;this.state={thumbnails:c,selectedIndex:a}}componentDidMount(){this.scrollIntoView(),this.props.isOpen&&this.generateVideoThumbnails()}componentDidUpdate(t){this.props.isOpen&&!t.isOpen&&(this.scrollIntoView(),this.generateVideoThumbnails())}async generateVideoThumbnails(){const t=this.state.thumbnails;if(this.isThumbnailsAreGenerating||!t.find(t=>!t.url))return;this.isThumbnailsAreGenerating=!0;const e=document.createElement("video"),n=document.createElement("canvas");await Object(g.m)(e,this.props.videoSource);let o=0;e.currentTime=t[o].time,await Object(g.d)(e,n,e=>(t[o].url=e.dataUrl,o++,this.setThumbnails(t),o<t.length?t[o].time:null)),this.setState({thumbnails:t}),this.isThumbnailsAreGenerating=!1}render(){if(!this.props.isOpen)return null;var t=this.state;const e=t.selectedIndex,n=t.thumbnails;return a.a.createElement(C,{withOverlay:!0},a.a.createElement(v,null,S(this.props.language),a.a.createElement(j,{onClick:this.props.onToggleModal},a.a.createElement(k,null))),a.a.createElement(w,null,n.map((t,n)=>a.a.createElement(I,{key:n,elementRef:n===e?this.setSelectedElementRef:void 0,gradientType:"posts",isLoading:!t.url,onClick:()=>this.setSelected(n),isSelected:n===e,thumbnail:t}))),a.a.createElement(R,null,a.a.createElement(B,{onClick:this.props.onToggleModal},O(this.props.language)),a.a.createElement(A,{onClick:this.onSelectButton},x(this.props.language))))}}},"./src/reddit/icons/svgs/FormattingHyperlink/index.tsx":function(t,e,n){"use strict";var o=n("./node_modules/react/index.js"),r=n.n(o),i=n("./bundled-modules/styled-components/styled-components.min.js"),s=n.n(i),c=n("./src/reddit/models/Theme/NewColorSystem/index.ts");e.a=s()(t=>r.a.createElement("svg",{className:t.className,viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},r.a.createElement("path",{d:"M17.15,2.86a6.33,6.33,0,1,0-9,9A1,1,0,0,0,9.6,10.4a4.39,4.39,0,1,1,4.92.83,7.41,7.41,0,0,1,.14,1.44c0,.23,0,.46,0,.68a6.33,6.33,0,0,0,2.51-10.5Z"}),r.a.createElement("path",{d:"M10.4,8.19a1,1,0,0,0,0,1.41,4.39,4.39,0,1,1-4.92-.83,7.41,7.41,0,0,1-.14-1.44c0-.23,0-.46,0-.68a6.33,6.33,0,1,0,6.44,1.54A1,1,0,0,0,10.4,8.19Z"}))).withConfig({componentId:"s12c5p38-0"})(["fill: ",";"],t=>Object(c.c)(t).actionIcon)},"./src/reddit/icons/svgs/ImagePost/index.tsx":function(t,e,n){"use strict";var o=n("./node_modules/react/index.js"),r=n.n(o),i=n("./bundled-modules/styled-components/styled-components.min.js"),s=n.n(i),c=n("./src/reddit/models/Theme/NewColorSystem/index.ts");e.a=s()(t=>r.a.createElement("svg",{className:t.className,viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},r.a.createElement("path",{d:"M16,2H4A2,2,0,0,0,2,4V16a2,2,0,0,0,2,2H16a2,2,0,0,0,2-2V4A2,2,0,0,0,16,2Zm0,14H10.14a.49.49,0,0,1,.05-.48l3.15-4.26a.5.5,0,0,1,.38-.2.53.53,0,0,1,.4.17L16,13.35ZM4,13.51,7.26,8.82a.54.54,0,0,1,.42-.21.5.5,0,0,1,.41.23l2.85,4.34L8.84,16H4Zm10.4-7.1a1.7,1.7,0,1,1-1.7-1.7A1.7,1.7,0,0,1,14.4,6.41Z"}))).withConfig({componentId:"s16s0p0w-0"})(["fill: ",";"],t=>Object(c.c)(t).actionIcon)},"./src/reddit/icons/svgs/ThumbnailSelect/index.tsx":function(t,e,n){"use strict";var o=n("./node_modules/react/index.js"),r=n.n(o),i=n("./bundled-modules/styled-components/styled-components.min.js"),s=n.n(i),c=n("./src/reddit/models/Theme/NewColorSystem/index.ts");e.a=s()(t=>r.a.createElement("svg",{className:t.className,viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},r.a.createElement("g",{fill:"none",fillRule:"evenodd"},r.a.createElement("path",{d:"M0 0h20v20H0z"}),r.a.createElement("path",{fill:"#A5A4A4",d:"M6 3h8c1.1046 0 2 .8954 2 2v10c0 1.1046-.8954 2-2 2H6c-1.1046 0-2-.8954-2-2V5c0-1.1046.8954-2 2-2zm11 1c1.1046 0 2 .8954 2 2v8c0 1.1046-.8954 2-2 2V4zM3 4v12h-.6667C1.597 16 1 15.1734 1 14.1538V5.8462C1 4.8266 1.597 4 2.3333 4H3z"})))).withConfig({componentId:"s1xqute9-0"})(["fill: ",";"],t=>Object(c.c)(t).actionIcon)},"./src/reddit/icons/svgs/Video/index.tsx":function(t,e,n){"use strict";var o=n("./node_modules/react/index.js"),r=n.n(o);e.a=(t=>r.a.createElement("svg",{className:t.className,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20"},r.a.createElement("g",{transform:"translate(3, 4)"},r.a.createElement("path",{d:"M15.4927,2.1514 C15.1797,1.9734 14.7947,1.9784 14.4857,2.1644 L11.9997,3.6554 L11.9997,2.0004 C11.9997,0.8974 11.1027,0.0004 9.9997,0.0004 L1.9997,0.0004 C0.8967,0.0004 -0.0003,0.8974 -0.0003,2.0004 L-0.0003,10.0004 C-0.0003,11.1034 0.8967,12.0004 1.9997,12.0004 L9.9997,12.0004 C11.1027,12.0004 11.9997,11.1034 11.9997,10.0004 L11.9997,8.3664 L14.4907,9.8394 C14.6477,9.9324 14.8237,9.9784 14.9997,9.9784 C15.1707,9.9784 15.3417,9.9344 15.4957,9.8474 C15.8077,9.6694 15.9997,9.3384 15.9997,8.9784 L15.9997,3.0214 C15.9997,2.6614 15.8057,2.3284 15.4927,2.1514"}))))},"./src/reddit/selectors/editorContent.ts":function(t,e,n){"use strict";n.d(e,"a",function(){return r});var o=n("./src/reddit/actions/postCreation/constants.ts");const r=(t,e)=>t.creations.api.editor.converting.pending[e||o.l]}}]);
//# sourceMappingURL=ChatMessageInput~RichTextEditor.ec25ae02e7f95c3326c6.js.map